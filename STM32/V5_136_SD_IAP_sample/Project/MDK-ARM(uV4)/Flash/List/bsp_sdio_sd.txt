; generated by Component: ARM Compiler 5.04 update 1 (build 49) Tool: ArmCC [5040049]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\flash\obj\bsp_sdio_sd.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=.\flash\obj\bsp_sdio_sd.d --cpu=Cortex-M4.fp --apcs=interwork -O0 --diag_suppress=870 -I..\..\Libraries\CMSIS\Include -I..\..\Libraries\CMSIS\Device\ST\STM32F4xx\Include -I..\..\Libraries\STM32F4xx_StdPeriph_Driver\inc -I..\..\User\bsp_stm32f4xx\inc -I..\..\User\bsp_stm32f4xx -I..\..\User -I..\..\User\fonts -I..\..\fatfs\src -D__MICROLIB -DSTM32F40_41xxx -DUSE_STDPERIPH_DRIVER -DSTM32F40XX --omf_browse=.\flash\obj\bsp_sdio_sd.crf ..\..\User\bsp_stm32f4xx\src\bsp_sdio_sd.c]
                          THUMB

                          AREA ||i.CmdError||, CODE, READONLY, ALIGN=1

                  CmdError PROC
;;;2061     */
;;;2062   static SD_Error CmdError(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2063   {
;;;2064     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2065     uint32_t timeout;
;;;2066   
;;;2067     timeout = SDIO_CMD0TIMEOUT; /*!< 10000 */
000004  f44f3480          MOV      r4,#0x10000
;;;2068   
;;;2069     while ((timeout > 0) && (SDIO_GetFlagStatus(SDIO_FLAG_CMDSENT) == RESET))
000008  e000              B        |L1.12|
                  |L1.10|
;;;2070     {
;;;2071       timeout--;
00000a  1e64              SUBS     r4,r4,#1
                  |L1.12|
00000c  b124              CBZ      r4,|L1.24|
00000e  2080              MOVS     r0,#0x80              ;2069
000010  f7fffffe          BL       SDIO_GetFlagStatus
000014  2800              CMP      r0,#0                 ;2069
000016  d0f8              BEQ      |L1.10|
                  |L1.24|
;;;2072     }
;;;2073   
;;;2074     if (timeout == 0)
000018  b914              CBNZ     r4,|L1.32|
;;;2075     {
;;;2076       errorstatus = SD_CMD_RSP_TIMEOUT;
00001a  2503              MOVS     r5,#3
;;;2077       return(errorstatus);
00001c  4628              MOV      r0,r5
                  |L1.30|
;;;2078     }
;;;2079   
;;;2080     /*!< Clear all the static flags */
;;;2081     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2082   
;;;2083     return(errorstatus);
;;;2084   }
00001e  bd70              POP      {r4-r6,pc}
                  |L1.32|
000020  f24050ff          MOV      r0,#0x5ff             ;2081
000024  f7fffffe          BL       SDIO_ClearFlag
000028  4628              MOV      r0,r5                 ;2083
00002a  e7f8              B        |L1.30|
;;;2085   
                          ENDP


                          AREA ||i.CmdResp1Error||, CODE, READONLY, ALIGN=2

                  CmdResp1Error PROC
;;;2127     */
;;;2128   static SD_Error CmdResp1Error(uint8_t cmd)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2129   {
000004  4606              MOV      r6,r0
;;;2130     SD_Error errorstatus = SD_OK;
000006  2700              MOVS     r7,#0
;;;2131     uint32_t status;
;;;2132     uint32_t response_r1;
;;;2133   
;;;2134     status = SDIO->STA;
000008  4848              LDR      r0,|L2.300|
00000a  6805              LDR      r5,[r0,#0]
;;;2135   
;;;2136     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
00000c  e001              B        |L2.18|
                  |L2.14|
;;;2137     {
;;;2138       status = SDIO->STA;
00000e  4847              LDR      r0,|L2.300|
000010  6805              LDR      r5,[r0,#0]
                  |L2.18|
000012  f0050045          AND      r0,r5,#0x45           ;2136
000016  2800              CMP      r0,#0                 ;2136
000018  d0f9              BEQ      |L2.14|
;;;2139     }
;;;2140   
;;;2141     if (status & SDIO_FLAG_CTIMEOUT)
00001a  f0050004          AND      r0,r5,#4
00001e  b130              CBZ      r0,|L2.46|
;;;2142     {
;;;2143       errorstatus = SD_CMD_RSP_TIMEOUT;
000020  2703              MOVS     r7,#3
;;;2144       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000022  2004              MOVS     r0,#4
000024  f7fffffe          BL       SDIO_ClearFlag
;;;2145       return(errorstatus);
000028  4638              MOV      r0,r7
                  |L2.42|
;;;2146     }
;;;2147     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2148     {
;;;2149       errorstatus = SD_CMD_CRC_FAIL;
;;;2150       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2151       return(errorstatus);
;;;2152     }
;;;2153   
;;;2154     /*!< Check response received is of desired command */
;;;2155     if (SDIO_GetCommandResponse() != cmd)
;;;2156     {
;;;2157       errorstatus = SD_ILLEGAL_CMD;
;;;2158       return(errorstatus);
;;;2159     }
;;;2160   
;;;2161     /*!< Clear all the static flags */
;;;2162     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2163   
;;;2164     /*!< We have received response, retrieve it for analysis  */
;;;2165     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2166   
;;;2167     if ((response_r1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2168     {
;;;2169       return(errorstatus);
;;;2170     }
;;;2171   
;;;2172     if (response_r1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2173     {
;;;2174       return(SD_ADDR_OUT_OF_RANGE);
;;;2175     }
;;;2176   
;;;2177     if (response_r1 & SD_OCR_ADDR_MISALIGNED)
;;;2178     {
;;;2179       return(SD_ADDR_MISALIGNED);
;;;2180     }
;;;2181   
;;;2182     if (response_r1 & SD_OCR_BLOCK_LEN_ERR)
;;;2183     {
;;;2184       return(SD_BLOCK_LEN_ERR);
;;;2185     }
;;;2186   
;;;2187     if (response_r1 & SD_OCR_ERASE_SEQ_ERR)
;;;2188     {
;;;2189       return(SD_ERASE_SEQ_ERR);
;;;2190     }
;;;2191   
;;;2192     if (response_r1 & SD_OCR_BAD_ERASE_PARAM)
;;;2193     {
;;;2194       return(SD_BAD_ERASE_PARAM);
;;;2195     }
;;;2196   
;;;2197     if (response_r1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2198     {
;;;2199       return(SD_WRITE_PROT_VIOLATION);
;;;2200     }
;;;2201   
;;;2202     if (response_r1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2203     {
;;;2204       return(SD_LOCK_UNLOCK_FAILED);
;;;2205     }
;;;2206   
;;;2207     if (response_r1 & SD_OCR_COM_CRC_FAILED)
;;;2208     {
;;;2209       return(SD_COM_CRC_FAILED);
;;;2210     }
;;;2211   
;;;2212     if (response_r1 & SD_OCR_ILLEGAL_CMD)
;;;2213     {
;;;2214       return(SD_ILLEGAL_CMD);
;;;2215     }
;;;2216   
;;;2217     if (response_r1 & SD_OCR_CARD_ECC_FAILED)
;;;2218     {
;;;2219       return(SD_CARD_ECC_FAILED);
;;;2220     }
;;;2221   
;;;2222     if (response_r1 & SD_OCR_CC_ERROR)
;;;2223     {
;;;2224       return(SD_CC_ERROR);
;;;2225     }
;;;2226   
;;;2227     if (response_r1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2228     {
;;;2229       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2230     }
;;;2231   
;;;2232     if (response_r1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2233     {
;;;2234       return(SD_STREAM_READ_UNDERRUN);
;;;2235     }
;;;2236   
;;;2237     if (response_r1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2238     {
;;;2239       return(SD_STREAM_WRITE_OVERRUN);
;;;2240     }
;;;2241   
;;;2242     if (response_r1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2243     {
;;;2244       return(SD_CID_CSD_OVERWRITE);
;;;2245     }
;;;2246   
;;;2247     if (response_r1 & SD_OCR_WP_ERASE_SKIP)
;;;2248     {
;;;2249       return(SD_WP_ERASE_SKIP);
;;;2250     }
;;;2251   
;;;2252     if (response_r1 & SD_OCR_CARD_ECC_DISABLED)
;;;2253     {
;;;2254       return(SD_CARD_ECC_DISABLED);
;;;2255     }
;;;2256   
;;;2257     if (response_r1 & SD_OCR_ERASE_RESET)
;;;2258     {
;;;2259       return(SD_ERASE_RESET);
;;;2260     }
;;;2261   
;;;2262     if (response_r1 & SD_OCR_AKE_SEQ_ERROR)
;;;2263     {
;;;2264       return(SD_AKE_SEQ_ERROR);
;;;2265     }
;;;2266     return(errorstatus);
;;;2267   }
00002a  e8bd81f0          POP      {r4-r8,pc}
                  |L2.46|
00002e  f0050001          AND      r0,r5,#1              ;2147
000032  b128              CBZ      r0,|L2.64|
000034  2701              MOVS     r7,#1                 ;2149
000036  2001              MOVS     r0,#1                 ;2150
000038  f7fffffe          BL       SDIO_ClearFlag
00003c  4638              MOV      r0,r7                 ;2151
00003e  e7f4              B        |L2.42|
                  |L2.64|
000040  f7fffffe          BL       SDIO_GetCommandResponse
000044  42b0              CMP      r0,r6                 ;2155
000046  d002              BEQ      |L2.78|
000048  2710              MOVS     r7,#0x10              ;2157
00004a  4638              MOV      r0,r7                 ;2158
00004c  e7ed              B        |L2.42|
                  |L2.78|
00004e  f24050ff          MOV      r0,#0x5ff             ;2162
000052  f7fffffe          BL       SDIO_ClearFlag
000056  2000              MOVS     r0,#0                 ;2165
000058  f7fffffe          BL       SDIO_GetResponse
00005c  4604              MOV      r4,r0                 ;2165
00005e  4834              LDR      r0,|L2.304|
000060  4020              ANDS     r0,r0,r4              ;2167
000062  b908              CBNZ     r0,|L2.104|
000064  4638              MOV      r0,r7                 ;2169
000066  e7e0              B        |L2.42|
                  |L2.104|
000068  f0044000          AND      r0,r4,#0x80000000     ;2172
00006c  b108              CBZ      r0,|L2.114|
00006e  201c              MOVS     r0,#0x1c              ;2174
000070  e7db              B        |L2.42|
                  |L2.114|
000072  f0044080          AND      r0,r4,#0x40000000     ;2177
000076  b108              CBZ      r0,|L2.124|
000078  2009              MOVS     r0,#9                 ;2179
00007a  e7d6              B        |L2.42|
                  |L2.124|
00007c  f0045000          AND      r0,r4,#0x20000000     ;2182
000080  b108              CBZ      r0,|L2.134|
000082  200a              MOVS     r0,#0xa               ;2184
000084  e7d1              B        |L2.42|
                  |L2.134|
000086  f0045080          AND      r0,r4,#0x10000000     ;2187
00008a  b108              CBZ      r0,|L2.144|
00008c  200b              MOVS     r0,#0xb               ;2189
00008e  e7cc              B        |L2.42|
                  |L2.144|
000090  f0046000          AND      r0,r4,#0x8000000      ;2192
000094  b108              CBZ      r0,|L2.154|
000096  200c              MOVS     r0,#0xc               ;2194
000098  e7c7              B        |L2.42|
                  |L2.154|
00009a  f0046080          AND      r0,r4,#0x4000000      ;2197
00009e  b108              CBZ      r0,|L2.164|
0000a0  200d              MOVS     r0,#0xd               ;2199
0000a2  e7c2              B        |L2.42|
                  |L2.164|
0000a4  f0047080          AND      r0,r4,#0x1000000      ;2202
0000a8  b108              CBZ      r0,|L2.174|
0000aa  200e              MOVS     r0,#0xe               ;2204
0000ac  e7bd              B        |L2.42|
                  |L2.174|
0000ae  f4040000          AND      r0,r4,#0x800000       ;2207
0000b2  b108              CBZ      r0,|L2.184|
0000b4  200f              MOVS     r0,#0xf               ;2209
0000b6  e7b8              B        |L2.42|
                  |L2.184|
0000b8  f4040080          AND      r0,r4,#0x400000       ;2212
0000bc  b108              CBZ      r0,|L2.194|
0000be  2010              MOVS     r0,#0x10              ;2214
0000c0  e7b3              B        |L2.42|
                  |L2.194|
0000c2  f4041000          AND      r0,r4,#0x200000       ;2217
0000c6  b108              CBZ      r0,|L2.204|
0000c8  2011              MOVS     r0,#0x11              ;2219
0000ca  e7ae              B        |L2.42|
                  |L2.204|
0000cc  f4041080          AND      r0,r4,#0x100000       ;2222
0000d0  b108              CBZ      r0,|L2.214|
0000d2  2012              MOVS     r0,#0x12              ;2224
0000d4  e7a9              B        |L2.42|
                  |L2.214|
0000d6  f4042000          AND      r0,r4,#0x80000        ;2227
0000da  b108              CBZ      r0,|L2.224|
0000dc  2013              MOVS     r0,#0x13              ;2229
0000de  e7a4              B        |L2.42|
                  |L2.224|
0000e0  f4042080          AND      r0,r4,#0x40000        ;2232
0000e4  b108              CBZ      r0,|L2.234|
0000e6  2014              MOVS     r0,#0x14              ;2234
0000e8  e79f              B        |L2.42|
                  |L2.234|
0000ea  f4043000          AND      r0,r4,#0x20000        ;2237
0000ee  b108              CBZ      r0,|L2.244|
0000f0  2015              MOVS     r0,#0x15              ;2239
0000f2  e79a              B        |L2.42|
                  |L2.244|
0000f4  f4043080          AND      r0,r4,#0x10000        ;2242
0000f8  b108              CBZ      r0,|L2.254|
0000fa  2016              MOVS     r0,#0x16              ;2244
0000fc  e795              B        |L2.42|
                  |L2.254|
0000fe  f4044000          AND      r0,r4,#0x8000         ;2247
000102  b108              CBZ      r0,|L2.264|
000104  2017              MOVS     r0,#0x17              ;2249
000106  e790              B        |L2.42|
                  |L2.264|
000108  f4044080          AND      r0,r4,#0x4000         ;2252
00010c  b108              CBZ      r0,|L2.274|
00010e  2018              MOVS     r0,#0x18              ;2254
000110  e78b              B        |L2.42|
                  |L2.274|
000112  f4045000          AND      r0,r4,#0x2000         ;2257
000116  b108              CBZ      r0,|L2.284|
000118  2019              MOVS     r0,#0x19              ;2259
00011a  e786              B        |L2.42|
                  |L2.284|
00011c  f0040008          AND      r0,r4,#8              ;2262
000120  b108              CBZ      r0,|L2.294|
000122  201a              MOVS     r0,#0x1a              ;2264
000124  e781              B        |L2.42|
                  |L2.294|
000126  4638              MOV      r0,r7                 ;2266
000128  e77f              B        |L2.42|
;;;2268   
                          ENDP

00012a  0000              DCW      0x0000
                  |L2.300|
                          DCD      0x40012c34
                  |L2.304|
                          DCD      0xfdffe008

                          AREA ||i.CmdResp2Error||, CODE, READONLY, ALIGN=2

                  CmdResp2Error PROC
;;;2301     */
;;;2302   static SD_Error CmdResp2Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2303   {
;;;2304     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2305     uint32_t status;
;;;2306   
;;;2307     status = SDIO->STA;
000004  4810              LDR      r0,|L3.72|
000006  6804              LDR      r4,[r0,#0]
;;;2308   
;;;2309     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000008  e001              B        |L3.14|
                  |L3.10|
;;;2310     {
;;;2311       status = SDIO->STA;
00000a  480f              LDR      r0,|L3.72|
00000c  6804              LDR      r4,[r0,#0]
                  |L3.14|
00000e  f0040045          AND      r0,r4,#0x45           ;2309
000012  2800              CMP      r0,#0                 ;2309
000014  d0f9              BEQ      |L3.10|
;;;2312     }
;;;2313   
;;;2314     if (status & SDIO_FLAG_CTIMEOUT)
000016  f0040004          AND      r0,r4,#4
00001a  b128              CBZ      r0,|L3.40|
;;;2315     {
;;;2316       errorstatus = SD_CMD_RSP_TIMEOUT;
00001c  2503              MOVS     r5,#3
;;;2317       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001e  2004              MOVS     r0,#4
000020  f7fffffe          BL       SDIO_ClearFlag
;;;2318       return(errorstatus);
000024  4628              MOV      r0,r5
                  |L3.38|
;;;2319     }
;;;2320     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2321     {
;;;2322       errorstatus = SD_CMD_CRC_FAIL;
;;;2323       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2324       return(errorstatus);
;;;2325     }
;;;2326   
;;;2327     /*!< Clear all the static flags */
;;;2328     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2329   
;;;2330     return(errorstatus);
;;;2331   }
000026  bd70              POP      {r4-r6,pc}
                  |L3.40|
000028  f0040001          AND      r0,r4,#1              ;2320
00002c  b128              CBZ      r0,|L3.58|
00002e  2501              MOVS     r5,#1                 ;2322
000030  2001              MOVS     r0,#1                 ;2323
000032  f7fffffe          BL       SDIO_ClearFlag
000036  4628              MOV      r0,r5                 ;2324
000038  e7f5              B        |L3.38|
                  |L3.58|
00003a  f24050ff          MOV      r0,#0x5ff             ;2328
00003e  f7fffffe          BL       SDIO_ClearFlag
000042  4628              MOV      r0,r5                 ;2330
000044  e7ef              B        |L3.38|
;;;2332   
                          ENDP

000046  0000              DCW      0x0000
                  |L3.72|
                          DCD      0x40012c34

                          AREA ||i.CmdResp3Error||, CODE, READONLY, ALIGN=2

                  CmdResp3Error PROC
;;;2273     */
;;;2274   static SD_Error CmdResp3Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2275   {
;;;2276     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2277     uint32_t status;
;;;2278   
;;;2279     status = SDIO->STA;
000004  480b              LDR      r0,|L4.52|
000006  6804              LDR      r4,[r0,#0]
;;;2280   
;;;2281     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000008  e001              B        |L4.14|
                  |L4.10|
;;;2282     {
;;;2283       status = SDIO->STA;
00000a  480a              LDR      r0,|L4.52|
00000c  6804              LDR      r4,[r0,#0]
                  |L4.14|
00000e  f0040045          AND      r0,r4,#0x45           ;2281
000012  2800              CMP      r0,#0                 ;2281
000014  d0f9              BEQ      |L4.10|
;;;2284     }
;;;2285   
;;;2286     if (status & SDIO_FLAG_CTIMEOUT)
000016  f0040004          AND      r0,r4,#4
00001a  b128              CBZ      r0,|L4.40|
;;;2287     {
;;;2288       errorstatus = SD_CMD_RSP_TIMEOUT;
00001c  2503              MOVS     r5,#3
;;;2289       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001e  2004              MOVS     r0,#4
000020  f7fffffe          BL       SDIO_ClearFlag
;;;2290       return(errorstatus);
000024  4628              MOV      r0,r5
                  |L4.38|
;;;2291     }
;;;2292     /*!< Clear all the static flags */
;;;2293     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2294     return(errorstatus);
;;;2295   }
000026  bd70              POP      {r4-r6,pc}
                  |L4.40|
000028  f24050ff          MOV      r0,#0x5ff             ;2293
00002c  f7fffffe          BL       SDIO_ClearFlag
000030  4628              MOV      r0,r5                 ;2294
000032  e7f8              B        |L4.38|
;;;2296   
                          ENDP

                  |L4.52|
                          DCD      0x40012c34

                          AREA ||i.CmdResp6Error||, CODE, READONLY, ALIGN=2

                  CmdResp6Error PROC
;;;2339     */
;;;2340   static SD_Error CmdResp6Error(uint8_t cmd, uint16_t *prca)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2341   {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
;;;2342     SD_Error errorstatus = SD_OK;
000008  f04f0800          MOV      r8,#0
;;;2343     uint32_t status;
;;;2344     uint32_t response_r1;
;;;2345   
;;;2346     status = SDIO->STA;
00000c  4822              LDR      r0,|L5.152|
00000e  6805              LDR      r5,[r0,#0]
;;;2347   
;;;2348     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000010  e001              B        |L5.22|
                  |L5.18|
;;;2349     {
;;;2350       status = SDIO->STA;
000012  4821              LDR      r0,|L5.152|
000014  6805              LDR      r5,[r0,#0]
                  |L5.22|
000016  f0050045          AND      r0,r5,#0x45           ;2348
00001a  2800              CMP      r0,#0                 ;2348
00001c  d0f9              BEQ      |L5.18|
;;;2351     }
;;;2352   
;;;2353     if (status & SDIO_FLAG_CTIMEOUT)
00001e  f0050004          AND      r0,r5,#4
000022  b138              CBZ      r0,|L5.52|
;;;2354     {
;;;2355       errorstatus = SD_CMD_RSP_TIMEOUT;
000024  f04f0803          MOV      r8,#3
;;;2356       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000028  2004              MOVS     r0,#4
00002a  f7fffffe          BL       SDIO_ClearFlag
;;;2357       return(errorstatus);
00002e  4640              MOV      r0,r8
                  |L5.48|
;;;2358     }
;;;2359     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2360     {
;;;2361       errorstatus = SD_CMD_CRC_FAIL;
;;;2362       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2363       return(errorstatus);
;;;2364     }
;;;2365   
;;;2366     /*!< Check response received is of desired command */
;;;2367     if (SDIO_GetCommandResponse() != cmd)
;;;2368     {
;;;2369       errorstatus = SD_ILLEGAL_CMD;
;;;2370       return(errorstatus);
;;;2371     }
;;;2372   
;;;2373     /*!< Clear all the static flags */
;;;2374     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2375   
;;;2376     /*!< We have received response, retrieve it.  */
;;;2377     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2378   
;;;2379     if (SD_ALLZERO == (response_r1 & (SD_R6_GENERAL_UNKNOWN_ERROR | SD_R6_ILLEGAL_CMD | SD_R6_COM_CRC_FAILED)))
;;;2380     {
;;;2381       *prca = (uint16_t) (response_r1 >> 16);
;;;2382       return(errorstatus);
;;;2383     }
;;;2384   
;;;2385     if (response_r1 & SD_R6_GENERAL_UNKNOWN_ERROR)
;;;2386     {
;;;2387       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2388     }
;;;2389   
;;;2390     if (response_r1 & SD_R6_ILLEGAL_CMD)
;;;2391     {
;;;2392       return(SD_ILLEGAL_CMD);
;;;2393     }
;;;2394   
;;;2395     if (response_r1 & SD_R6_COM_CRC_FAILED)
;;;2396     {
;;;2397       return(SD_COM_CRC_FAILED);
;;;2398     }
;;;2399   
;;;2400     return(errorstatus);
;;;2401   }
000030  e8bd81f0          POP      {r4-r8,pc}
                  |L5.52|
000034  f0050001          AND      r0,r5,#1              ;2359
000038  b130              CBZ      r0,|L5.72|
00003a  f04f0801          MOV      r8,#1                 ;2361
00003e  2001              MOVS     r0,#1                 ;2362
000040  f7fffffe          BL       SDIO_ClearFlag
000044  4640              MOV      r0,r8                 ;2363
000046  e7f3              B        |L5.48|
                  |L5.72|
000048  f7fffffe          BL       SDIO_GetCommandResponse
00004c  42b0              CMP      r0,r6                 ;2367
00004e  d003              BEQ      |L5.88|
000050  f04f0810          MOV      r8,#0x10              ;2369
000054  4640              MOV      r0,r8                 ;2370
000056  e7eb              B        |L5.48|
                  |L5.88|
000058  f24050ff          MOV      r0,#0x5ff             ;2374
00005c  f7fffffe          BL       SDIO_ClearFlag
000060  2000              MOVS     r0,#0                 ;2377
000062  f7fffffe          BL       SDIO_GetResponse
000066  4604              MOV      r4,r0                 ;2377
000068  f4044060          AND      r0,r4,#0xe000         ;2379
00006c  b918              CBNZ     r0,|L5.118|
00006e  0c20              LSRS     r0,r4,#16             ;2381
000070  8038              STRH     r0,[r7,#0]            ;2381
000072  4640              MOV      r0,r8                 ;2382
000074  e7dc              B        |L5.48|
                  |L5.118|
000076  f4045000          AND      r0,r4,#0x2000         ;2385
00007a  b108              CBZ      r0,|L5.128|
00007c  2013              MOVS     r0,#0x13              ;2387
00007e  e7d7              B        |L5.48|
                  |L5.128|
000080  f4044080          AND      r0,r4,#0x4000         ;2390
000084  b108              CBZ      r0,|L5.138|
000086  2010              MOVS     r0,#0x10              ;2392
000088  e7d2              B        |L5.48|
                  |L5.138|
00008a  f4044000          AND      r0,r4,#0x8000         ;2395
00008e  b108              CBZ      r0,|L5.148|
000090  200f              MOVS     r0,#0xf               ;2397
000092  e7cd              B        |L5.48|
                  |L5.148|
000094  4640              MOV      r0,r8                 ;2400
000096  e7cb              B        |L5.48|
;;;2402   
                          ENDP

                  |L5.152|
                          DCD      0x40012c34

                          AREA ||i.CmdResp7Error||, CODE, READONLY, ALIGN=2

                  CmdResp7Error PROC
;;;2090     */
;;;2091   static SD_Error CmdResp7Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2092   {
;;;2093     SD_Error errorstatus = SD_OK;
000002  2600              MOVS     r6,#0
;;;2094     uint32_t status;
;;;2095     uint32_t timeout = SDIO_CMD0TIMEOUT;
000004  f44f3580          MOV      r5,#0x10000
;;;2096   
;;;2097     status = SDIO->STA;
000008  480f              LDR      r0,|L6.72|
00000a  6804              LDR      r4,[r0,#0]
;;;2098   
;;;2099     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)) && (timeout > 0))
00000c  e002              B        |L6.20|
                  |L6.14|
;;;2100     {
;;;2101       timeout--;
00000e  1e6d              SUBS     r5,r5,#1
;;;2102       status = SDIO->STA;
000010  480d              LDR      r0,|L6.72|
000012  6804              LDR      r4,[r0,#0]
                  |L6.20|
000014  f0040045          AND      r0,r4,#0x45           ;2099
000018  b908              CBNZ     r0,|L6.30|
00001a  2d00              CMP      r5,#0                 ;2099
00001c  d1f7              BNE      |L6.14|
                  |L6.30|
;;;2103     }
;;;2104   
;;;2105     if ((timeout == 0) || (status & SDIO_FLAG_CTIMEOUT))
00001e  b115              CBZ      r5,|L6.38|
000020  f0040004          AND      r0,r4,#4
000024  b128              CBZ      r0,|L6.50|
                  |L6.38|
;;;2106     {
;;;2107       /*!< Card is not V2.0 complient or card does not support the set voltage range */
;;;2108       errorstatus = SD_CMD_RSP_TIMEOUT;
000026  2603              MOVS     r6,#3
;;;2109       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000028  2004              MOVS     r0,#4
00002a  f7fffffe          BL       SDIO_ClearFlag
;;;2110       return(errorstatus);
00002e  4630              MOV      r0,r6
                  |L6.48|
;;;2111     }
;;;2112   
;;;2113     if (status & SDIO_FLAG_CMDREND)
;;;2114     {
;;;2115       /*!< Card is SD V2.0 compliant */
;;;2116       errorstatus = SD_OK;
;;;2117       SDIO_ClearFlag(SDIO_FLAG_CMDREND);
;;;2118       return(errorstatus);
;;;2119     }
;;;2120     return(errorstatus);
;;;2121   }
000030  bd70              POP      {r4-r6,pc}
                  |L6.50|
000032  f0040040          AND      r0,r4,#0x40           ;2113
000036  b128              CBZ      r0,|L6.68|
000038  2600              MOVS     r6,#0                 ;2116
00003a  2040              MOVS     r0,#0x40              ;2117
00003c  f7fffffe          BL       SDIO_ClearFlag
000040  4630              MOV      r0,r6                 ;2118
000042  e7f5              B        |L6.48|
                  |L6.68|
000044  4630              MOV      r0,r6                 ;2120
000046  e7f3              B        |L6.48|
;;;2122   
                          ENDP

                  |L6.72|
                          DCD      0x40012c34

                          AREA ||i.DMA2_Stream3_IRQHandler||, CODE, READONLY, ALIGN=1

                  DMA2_Stream3_IRQHandler PROC
;;;3029     */
;;;3030   void DMA2_Stream3_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;3031   {
;;;3032     /* Process DMA2 Stream3 or DMA2 Stream6 Interrupt Sources */
;;;3033     SD_ProcessDMAIRQ();
000002  f7fffffe          BL       SD_ProcessDMAIRQ
;;;3034   }
000006  bd10              POP      {r4,pc}
;;;3035   
                          ENDP


                          AREA ||i.FindSCR||, CODE, READONLY, ALIGN=2

                  FindSCR PROC
;;;2681     */
;;;2682   static SD_Error FindSCR(uint16_t rca, uint32_t *pscr)
000000  e92d41fc          PUSH     {r2-r8,lr}
;;;2683   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
;;;2684     uint32_t index = 0;
000008  2600              MOVS     r6,#0
;;;2685     SD_Error errorstatus = SD_OK;
00000a  2400              MOVS     r4,#0
;;;2686     uint32_t tempscr[2] = {0, 0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
;;;2687   
;;;2688     /*!< Set Block Size To 8 Bytes */
;;;2689     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2690     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)8;
000012  2008              MOVS     r0,#8
000014  495b              LDR      r1,|L8.388|
000016  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2691     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000018  2010              MOVS     r0,#0x10
00001a  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2692     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001c  2040              MOVS     r0,#0x40
00001e  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2693     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000020  2000              MOVS     r0,#0
000022  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2694     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000024  f44f6080          MOV      r0,#0x400
000028  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2695     SDIO_SendCommand(&SDIO_CmdInitStructure);
00002a  4608              MOV      r0,r1
00002c  f7fffffe          BL       SDIO_SendCommand
;;;2696   
;;;2697     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000030  2010              MOVS     r0,#0x10
000032  f7fffffe          BL       CmdResp1Error
000036  4604              MOV      r4,r0
;;;2698   
;;;2699     if (errorstatus != SD_OK)
000038  b114              CBZ      r4,|L8.64|
;;;2700     {
;;;2701       return(errorstatus);
00003a  4620              MOV      r0,r4
                  |L8.60|
;;;2702     }
;;;2703   
;;;2704     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2705     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2706     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2707     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2708     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2709     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2710     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2711   
;;;2712     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2713   
;;;2714     if (errorstatus != SD_OK)
;;;2715     {
;;;2716       return(errorstatus);
;;;2717     }
;;;2718     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;2719     SDIO_DataInitStructure.SDIO_DataLength = 8;
;;;2720     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_8b;
;;;2721     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;2722     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;2723     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;2724     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;2725   
;;;2726   
;;;2727     /*!< Send ACMD51 SD_APP_SEND_SCR with argument as 0 */
;;;2728     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;2729     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_SEND_SCR;
;;;2730     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2731     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2732     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2733     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2734   
;;;2735     errorstatus = CmdResp1Error(SD_CMD_SD_APP_SEND_SCR);
;;;2736   
;;;2737     if (errorstatus != SD_OK)
;;;2738     {
;;;2739       return(errorstatus);
;;;2740     }
;;;2741   
;;;2742     while (!(SDIO->STA & (SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;2743     {
;;;2744       if (SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET)
;;;2745       {
;;;2746         *(tempscr + index) = SDIO_ReadData();
;;;2747         index++;
;;;2748       }
;;;2749     }
;;;2750   
;;;2751     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;2752     {
;;;2753       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;2754       errorstatus = SD_DATA_TIMEOUT;
;;;2755       return(errorstatus);
;;;2756     }
;;;2757     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;2758     {
;;;2759       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;2760       errorstatus = SD_DATA_CRC_FAIL;
;;;2761       return(errorstatus);
;;;2762     }
;;;2763     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;2764     {
;;;2765       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;2766       errorstatus = SD_RX_OVERRUN;
;;;2767       return(errorstatus);
;;;2768     }
;;;2769     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;2770     {
;;;2771       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2772       errorstatus = SD_START_BIT_ERR;
;;;2773       return(errorstatus);
;;;2774     }
;;;2775   
;;;2776     /*!< Clear all the static flags */
;;;2777     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2778   
;;;2779     *(pscr + 1) = ((tempscr[0] & SD_0TO7BITS) << 24) | ((tempscr[0] & SD_8TO15BITS) << 8) | ((tempscr[0] & SD_16TO23BITS) >> 8) | ((tempscr[0] & SD_24TO31BITS) >> 24);
;;;2780   
;;;2781     *(pscr) = ((tempscr[1] & SD_0TO7BITS) << 24) | ((tempscr[1] & SD_8TO15BITS) << 8) | ((tempscr[1] & SD_16TO23BITS) >> 8) | ((tempscr[1] & SD_24TO31BITS) >> 24);
;;;2782   
;;;2783     return(errorstatus);
;;;2784   }
00003c  e8bd81fc          POP      {r2-r8,pc}
                  |L8.64|
000040  4851              LDR      r0,|L8.392|
000042  8800              LDRH     r0,[r0,#0]            ;2705  ; RCA
000044  0400              LSLS     r0,r0,#16             ;2705
000046  494f              LDR      r1,|L8.388|
000048  6008              STR      r0,[r1,#0]            ;2705  ; SDIO_CmdInitStructure
00004a  2037              MOVS     r0,#0x37              ;2706
00004c  6048              STR      r0,[r1,#4]            ;2706  ; SDIO_CmdInitStructure
00004e  2040              MOVS     r0,#0x40              ;2707
000050  6088              STR      r0,[r1,#8]            ;2707  ; SDIO_CmdInitStructure
000052  2000              MOVS     r0,#0                 ;2708
000054  60c8              STR      r0,[r1,#0xc]          ;2708  ; SDIO_CmdInitStructure
000056  f44f6080          MOV      r0,#0x400             ;2709
00005a  6108              STR      r0,[r1,#0x10]         ;2709  ; SDIO_CmdInitStructure
00005c  4608              MOV      r0,r1                 ;2710
00005e  f7fffffe          BL       SDIO_SendCommand
000062  2037              MOVS     r0,#0x37              ;2712
000064  f7fffffe          BL       CmdResp1Error
000068  4604              MOV      r4,r0                 ;2712
00006a  b10c              CBZ      r4,|L8.112|
00006c  4620              MOV      r0,r4                 ;2716
00006e  e7e5              B        |L8.60|
                  |L8.112|
000070  f04f30ff          MOV      r0,#0xffffffff        ;2718
000074  4945              LDR      r1,|L8.396|
000076  6008              STR      r0,[r1,#0]            ;2718  ; SDIO_DataInitStructure
000078  2008              MOVS     r0,#8                 ;2719
00007a  6048              STR      r0,[r1,#4]            ;2719  ; SDIO_DataInitStructure
00007c  2030              MOVS     r0,#0x30              ;2720
00007e  6088              STR      r0,[r1,#8]            ;2720  ; SDIO_DataInitStructure
000080  2002              MOVS     r0,#2                 ;2721
000082  60c8              STR      r0,[r1,#0xc]          ;2721  ; SDIO_DataInitStructure
000084  2000              MOVS     r0,#0                 ;2722
000086  6108              STR      r0,[r1,#0x10]         ;2722  ; SDIO_DataInitStructure
000088  2001              MOVS     r0,#1                 ;2723
00008a  6148              STR      r0,[r1,#0x14]         ;2723  ; SDIO_DataInitStructure
00008c  4608              MOV      r0,r1                 ;2724
00008e  f7fffffe          BL       SDIO_DataConfig
000092  2000              MOVS     r0,#0                 ;2728
000094  493b              LDR      r1,|L8.388|
000096  6008              STR      r0,[r1,#0]            ;2728  ; SDIO_CmdInitStructure
000098  2033              MOVS     r0,#0x33              ;2729
00009a  6048              STR      r0,[r1,#4]            ;2729  ; SDIO_CmdInitStructure
00009c  2040              MOVS     r0,#0x40              ;2730
00009e  6088              STR      r0,[r1,#8]            ;2730  ; SDIO_CmdInitStructure
0000a0  2000              MOVS     r0,#0                 ;2731
0000a2  60c8              STR      r0,[r1,#0xc]          ;2731  ; SDIO_CmdInitStructure
0000a4  f44f6080          MOV      r0,#0x400             ;2732
0000a8  6108              STR      r0,[r1,#0x10]         ;2732  ; SDIO_CmdInitStructure
0000aa  4608              MOV      r0,r1                 ;2733
0000ac  f7fffffe          BL       SDIO_SendCommand
0000b0  2033              MOVS     r0,#0x33              ;2735
0000b2  f7fffffe          BL       CmdResp1Error
0000b6  4604              MOV      r4,r0                 ;2735
0000b8  b10c              CBZ      r4,|L8.190|
0000ba  4620              MOV      r0,r4                 ;2739
0000bc  e7be              B        |L8.60|
                  |L8.190|
0000be  e009              B        |L8.212|
                  |L8.192|
0000c0  f44f1000          MOV      r0,#0x200000          ;2744
0000c4  f7fffffe          BL       SDIO_GetFlagStatus
0000c8  b120              CBZ      r0,|L8.212|
0000ca  f7fffffe          BL       SDIO_ReadData
0000ce  f84d0026          STR      r0,[sp,r6,LSL #2]     ;2746
0000d2  1c76              ADDS     r6,r6,#1              ;2747
                  |L8.212|
0000d4  482e              LDR      r0,|L8.400|
0000d6  6800              LDR      r0,[r0,#0]            ;2742
0000d8  f240612a          MOV      r1,#0x62a             ;2742
0000dc  4008              ANDS     r0,r0,r1              ;2742
0000de  2800              CMP      r0,#0                 ;2742
0000e0  d0ee              BEQ      |L8.192|
0000e2  2008              MOVS     r0,#8                 ;2751
0000e4  f7fffffe          BL       SDIO_GetFlagStatus
0000e8  b128              CBZ      r0,|L8.246|
0000ea  2008              MOVS     r0,#8                 ;2753
0000ec  f7fffffe          BL       SDIO_ClearFlag
0000f0  2404              MOVS     r4,#4                 ;2754
0000f2  4620              MOV      r0,r4                 ;2755
0000f4  e7a2              B        |L8.60|
                  |L8.246|
0000f6  2002              MOVS     r0,#2                 ;2757
0000f8  f7fffffe          BL       SDIO_GetFlagStatus
0000fc  b128              CBZ      r0,|L8.266|
0000fe  2002              MOVS     r0,#2                 ;2759
000100  f7fffffe          BL       SDIO_ClearFlag
000104  2402              MOVS     r4,#2                 ;2760
000106  4620              MOV      r0,r4                 ;2761
000108  e798              B        |L8.60|
                  |L8.266|
00010a  2020              MOVS     r0,#0x20              ;2763
00010c  f7fffffe          BL       SDIO_GetFlagStatus
000110  b128              CBZ      r0,|L8.286|
000112  2020              MOVS     r0,#0x20              ;2765
000114  f7fffffe          BL       SDIO_ClearFlag
000118  2406              MOVS     r4,#6                 ;2766
00011a  4620              MOV      r0,r4                 ;2767
00011c  e78e              B        |L8.60|
                  |L8.286|
00011e  f44f7000          MOV      r0,#0x200             ;2769
000122  f7fffffe          BL       SDIO_GetFlagStatus
000126  b130              CBZ      r0,|L8.310|
000128  f44f7000          MOV      r0,#0x200             ;2771
00012c  f7fffffe          BL       SDIO_ClearFlag
000130  2407              MOVS     r4,#7                 ;2772
000132  4620              MOV      r0,r4                 ;2773
000134  e782              B        |L8.60|
                  |L8.310|
000136  f24050ff          MOV      r0,#0x5ff             ;2777
00013a  f7fffffe          BL       SDIO_ClearFlag
00013e  9800              LDR      r0,[sp,#0]            ;2779
000140  0600              LSLS     r0,r0,#24             ;2779
000142  9900              LDR      r1,[sp,#0]            ;2779
000144  f401417f          AND      r1,r1,#0xff00         ;2779
000148  ea402001          ORR      r0,r0,r1,LSL #8       ;2779
00014c  9900              LDR      r1,[sp,#0]            ;2779
00014e  f401017f          AND      r1,r1,#0xff0000       ;2779
000152  ea402011          ORR      r0,r0,r1,LSR #8       ;2779
000156  9900              LDR      r1,[sp,#0]            ;2779
000158  ea406011          ORR      r0,r0,r1,LSR #24      ;2779
00015c  6068              STR      r0,[r5,#4]            ;2779
00015e  9801              LDR      r0,[sp,#4]            ;2781
000160  0600              LSLS     r0,r0,#24             ;2781
000162  9901              LDR      r1,[sp,#4]            ;2781
000164  f401417f          AND      r1,r1,#0xff00         ;2781
000168  ea402001          ORR      r0,r0,r1,LSL #8       ;2781
00016c  9901              LDR      r1,[sp,#4]            ;2781
00016e  f401017f          AND      r1,r1,#0xff0000       ;2781
000172  ea402011          ORR      r0,r0,r1,LSR #8       ;2781
000176  9901              LDR      r1,[sp,#4]            ;2781
000178  ea406011          ORR      r0,r0,r1,LSR #24      ;2781
00017c  6028              STR      r0,[r5,#0]            ;2781
00017e  4620              MOV      r0,r4                 ;2783
000180  e75c              B        |L8.60|
;;;2785   
                          ENDP

000182  0000              DCW      0x0000
                  |L8.388|
                          DCD      SDIO_CmdInitStructure
                  |L8.392|
                          DCD      ||RCA||
                  |L8.396|
                          DCD      SDIO_DataInitStructure
                  |L8.400|
                          DCD      0x40012c34

                          AREA ||i.IsCardProgramming||, CODE, READONLY, ALIGN=2

                  IsCardProgramming PROC
;;;2522     */
;;;2523   static SD_Error IsCardProgramming(uint8_t *pstatus)
000000  b57c              PUSH     {r2-r6,lr}
;;;2524   {
000002  4604              MOV      r4,r0
;;;2525     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;2526     __IO uint32_t respR1 = 0, status = 0;
000006  2000              MOVS     r0,#0
000008  9001              STR      r0,[sp,#4]
00000a  9000              STR      r0,[sp,#0]
;;;2527   
;;;2528     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
00000c  485f              LDR      r0,|L9.396|
00000e  8800              LDRH     r0,[r0,#0]  ; RCA
000010  0400              LSLS     r0,r0,#16
000012  495f              LDR      r1,|L9.400|
000014  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2529     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
000016  200d              MOVS     r0,#0xd
000018  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2530     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001a  2040              MOVS     r0,#0x40
00001c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2531     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00001e  2000              MOVS     r0,#0
000020  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2532     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000022  f44f6080          MOV      r0,#0x400
000026  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2533     SDIO_SendCommand(&SDIO_CmdInitStructure);
000028  4608              MOV      r0,r1
00002a  f7fffffe          BL       SDIO_SendCommand
;;;2534   
;;;2535     status = SDIO->STA;
00002e  4859              LDR      r0,|L9.404|
000030  6800              LDR      r0,[r0,#0]
000032  9000              STR      r0,[sp,#0]
;;;2536     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000034  e002              B        |L9.60|
                  |L9.54|
;;;2537     {
;;;2538       status = SDIO->STA;
000036  4857              LDR      r0,|L9.404|
000038  6800              LDR      r0,[r0,#0]
00003a  9000              STR      r0,[sp,#0]
                  |L9.60|
00003c  9800              LDR      r0,[sp,#0]            ;2536
00003e  f0000045          AND      r0,r0,#0x45           ;2536
000042  2800              CMP      r0,#0                 ;2536
000044  d0f7              BEQ      |L9.54|
;;;2539     }
;;;2540   
;;;2541     if (status & SDIO_FLAG_CTIMEOUT)
000046  9800              LDR      r0,[sp,#0]
000048  f0000004          AND      r0,r0,#4
00004c  b128              CBZ      r0,|L9.90|
;;;2542     {
;;;2543       errorstatus = SD_CMD_RSP_TIMEOUT;
00004e  2503              MOVS     r5,#3
;;;2544       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000050  2004              MOVS     r0,#4
000052  f7fffffe          BL       SDIO_ClearFlag
;;;2545       return(errorstatus);
000056  4628              MOV      r0,r5
                  |L9.88|
;;;2546     }
;;;2547     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2548     {
;;;2549       errorstatus = SD_CMD_CRC_FAIL;
;;;2550       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2551       return(errorstatus);
;;;2552     }
;;;2553   
;;;2554     status = (uint32_t)SDIO_GetCommandResponse();
;;;2555   
;;;2556     /*!< Check response received is of desired command */
;;;2557     if (status != SD_CMD_SEND_STATUS)
;;;2558     {
;;;2559       errorstatus = SD_ILLEGAL_CMD;
;;;2560       return(errorstatus);
;;;2561     }
;;;2562   
;;;2563     /*!< Clear all the static flags */
;;;2564     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2565   
;;;2566   
;;;2567     /*!< We have received response, retrieve it for analysis  */
;;;2568     respR1 = SDIO_GetResponse(SDIO_RESP1);
;;;2569   
;;;2570     /*!< Find out card status */
;;;2571     *pstatus = (uint8_t) ((respR1 >> 9) & 0x0000000F);
;;;2572   
;;;2573     if ((respR1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2574     {
;;;2575       return(errorstatus);
;;;2576     }
;;;2577   
;;;2578     if (respR1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2579     {
;;;2580       return(SD_ADDR_OUT_OF_RANGE);
;;;2581     }
;;;2582   
;;;2583     if (respR1 & SD_OCR_ADDR_MISALIGNED)
;;;2584     {
;;;2585       return(SD_ADDR_MISALIGNED);
;;;2586     }
;;;2587   
;;;2588     if (respR1 & SD_OCR_BLOCK_LEN_ERR)
;;;2589     {
;;;2590       return(SD_BLOCK_LEN_ERR);
;;;2591     }
;;;2592   
;;;2593     if (respR1 & SD_OCR_ERASE_SEQ_ERR)
;;;2594     {
;;;2595       return(SD_ERASE_SEQ_ERR);
;;;2596     }
;;;2597   
;;;2598     if (respR1 & SD_OCR_BAD_ERASE_PARAM)
;;;2599     {
;;;2600       return(SD_BAD_ERASE_PARAM);
;;;2601     }
;;;2602   
;;;2603     if (respR1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2604     {
;;;2605       return(SD_WRITE_PROT_VIOLATION);
;;;2606     }
;;;2607   
;;;2608     if (respR1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2609     {
;;;2610       return(SD_LOCK_UNLOCK_FAILED);
;;;2611     }
;;;2612   
;;;2613     if (respR1 & SD_OCR_COM_CRC_FAILED)
;;;2614     {
;;;2615       return(SD_COM_CRC_FAILED);
;;;2616     }
;;;2617   
;;;2618     if (respR1 & SD_OCR_ILLEGAL_CMD)
;;;2619     {
;;;2620       return(SD_ILLEGAL_CMD);
;;;2621     }
;;;2622   
;;;2623     if (respR1 & SD_OCR_CARD_ECC_FAILED)
;;;2624     {
;;;2625       return(SD_CARD_ECC_FAILED);
;;;2626     }
;;;2627   
;;;2628     if (respR1 & SD_OCR_CC_ERROR)
;;;2629     {
;;;2630       return(SD_CC_ERROR);
;;;2631     }
;;;2632   
;;;2633     if (respR1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2634     {
;;;2635       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2636     }
;;;2637   
;;;2638     if (respR1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2639     {
;;;2640       return(SD_STREAM_READ_UNDERRUN);
;;;2641     }
;;;2642   
;;;2643     if (respR1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2644     {
;;;2645       return(SD_STREAM_WRITE_OVERRUN);
;;;2646     }
;;;2647   
;;;2648     if (respR1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2649     {
;;;2650       return(SD_CID_CSD_OVERWRITE);
;;;2651     }
;;;2652   
;;;2653     if (respR1 & SD_OCR_WP_ERASE_SKIP)
;;;2654     {
;;;2655       return(SD_WP_ERASE_SKIP);
;;;2656     }
;;;2657   
;;;2658     if (respR1 & SD_OCR_CARD_ECC_DISABLED)
;;;2659     {
;;;2660       return(SD_CARD_ECC_DISABLED);
;;;2661     }
;;;2662   
;;;2663     if (respR1 & SD_OCR_ERASE_RESET)
;;;2664     {
;;;2665       return(SD_ERASE_RESET);
;;;2666     }
;;;2667   
;;;2668     if (respR1 & SD_OCR_AKE_SEQ_ERROR)
;;;2669     {
;;;2670       return(SD_AKE_SEQ_ERROR);
;;;2671     }
;;;2672   
;;;2673     return(errorstatus);
;;;2674   }
000058  bd7c              POP      {r2-r6,pc}
                  |L9.90|
00005a  9800              LDR      r0,[sp,#0]            ;2547
00005c  f0000001          AND      r0,r0,#1              ;2547
000060  b128              CBZ      r0,|L9.110|
000062  2501              MOVS     r5,#1                 ;2549
000064  2001              MOVS     r0,#1                 ;2550
000066  f7fffffe          BL       SDIO_ClearFlag
00006a  4628              MOV      r0,r5                 ;2551
00006c  e7f4              B        |L9.88|
                  |L9.110|
00006e  f7fffffe          BL       SDIO_GetCommandResponse
000072  9000              STR      r0,[sp,#0]            ;2554
000074  9800              LDR      r0,[sp,#0]            ;2557
000076  280d              CMP      r0,#0xd               ;2557
000078  d002              BEQ      |L9.128|
00007a  2510              MOVS     r5,#0x10              ;2559
00007c  4628              MOV      r0,r5                 ;2560
00007e  e7eb              B        |L9.88|
                  |L9.128|
000080  f24050ff          MOV      r0,#0x5ff             ;2564
000084  f7fffffe          BL       SDIO_ClearFlag
000088  2000              MOVS     r0,#0                 ;2568
00008a  f7fffffe          BL       SDIO_GetResponse
00008e  9001              STR      r0,[sp,#4]            ;2568
000090  9801              LDR      r0,[sp,#4]            ;2571
000092  f3c02043          UBFX     r0,r0,#9,#4           ;2571
000096  7020              STRB     r0,[r4,#0]            ;2571
000098  493f              LDR      r1,|L9.408|
00009a  9801              LDR      r0,[sp,#4]            ;2573
00009c  4008              ANDS     r0,r0,r1              ;2573
00009e  b908              CBNZ     r0,|L9.164|
0000a0  4628              MOV      r0,r5                 ;2575
0000a2  e7d9              B        |L9.88|
                  |L9.164|
0000a4  9801              LDR      r0,[sp,#4]            ;2578
0000a6  f0004000          AND      r0,r0,#0x80000000     ;2578
0000aa  b108              CBZ      r0,|L9.176|
0000ac  201c              MOVS     r0,#0x1c              ;2580
0000ae  e7d3              B        |L9.88|
                  |L9.176|
0000b0  9801              LDR      r0,[sp,#4]            ;2583
0000b2  f0004080          AND      r0,r0,#0x40000000     ;2583
0000b6  b108              CBZ      r0,|L9.188|
0000b8  2009              MOVS     r0,#9                 ;2585
0000ba  e7cd              B        |L9.88|
                  |L9.188|
0000bc  9801              LDR      r0,[sp,#4]            ;2588
0000be  f0005000          AND      r0,r0,#0x20000000     ;2588
0000c2  b108              CBZ      r0,|L9.200|
0000c4  200a              MOVS     r0,#0xa               ;2590
0000c6  e7c7              B        |L9.88|
                  |L9.200|
0000c8  9801              LDR      r0,[sp,#4]            ;2593
0000ca  f0005080          AND      r0,r0,#0x10000000     ;2593
0000ce  b108              CBZ      r0,|L9.212|
0000d0  200b              MOVS     r0,#0xb               ;2595
0000d2  e7c1              B        |L9.88|
                  |L9.212|
0000d4  9801              LDR      r0,[sp,#4]            ;2598
0000d6  f0006000          AND      r0,r0,#0x8000000      ;2598
0000da  b108              CBZ      r0,|L9.224|
0000dc  200c              MOVS     r0,#0xc               ;2600
0000de  e7bb              B        |L9.88|
                  |L9.224|
0000e0  9801              LDR      r0,[sp,#4]            ;2603
0000e2  f0006080          AND      r0,r0,#0x4000000      ;2603
0000e6  b108              CBZ      r0,|L9.236|
0000e8  200d              MOVS     r0,#0xd               ;2605
0000ea  e7b5              B        |L9.88|
                  |L9.236|
0000ec  9801              LDR      r0,[sp,#4]            ;2608
0000ee  f0007080          AND      r0,r0,#0x1000000      ;2608
0000f2  b108              CBZ      r0,|L9.248|
0000f4  200e              MOVS     r0,#0xe               ;2610
0000f6  e7af              B        |L9.88|
                  |L9.248|
0000f8  9801              LDR      r0,[sp,#4]            ;2613
0000fa  f4000000          AND      r0,r0,#0x800000       ;2613
0000fe  b108              CBZ      r0,|L9.260|
000100  200f              MOVS     r0,#0xf               ;2615
000102  e7a9              B        |L9.88|
                  |L9.260|
000104  9801              LDR      r0,[sp,#4]            ;2618
000106  f4000080          AND      r0,r0,#0x400000       ;2618
00010a  b108              CBZ      r0,|L9.272|
00010c  2010              MOVS     r0,#0x10              ;2620
00010e  e7a3              B        |L9.88|
                  |L9.272|
000110  9801              LDR      r0,[sp,#4]            ;2623
000112  f4001000          AND      r0,r0,#0x200000       ;2623
000116  b108              CBZ      r0,|L9.284|
000118  2011              MOVS     r0,#0x11              ;2625
00011a  e79d              B        |L9.88|
                  |L9.284|
00011c  9801              LDR      r0,[sp,#4]            ;2628
00011e  f4001080          AND      r0,r0,#0x100000       ;2628
000122  b108              CBZ      r0,|L9.296|
000124  2012              MOVS     r0,#0x12              ;2630
000126  e797              B        |L9.88|
                  |L9.296|
000128  9801              LDR      r0,[sp,#4]            ;2633
00012a  f4002000          AND      r0,r0,#0x80000        ;2633
00012e  b108              CBZ      r0,|L9.308|
000130  2013              MOVS     r0,#0x13              ;2635
000132  e791              B        |L9.88|
                  |L9.308|
000134  9801              LDR      r0,[sp,#4]            ;2638
000136  f4002080          AND      r0,r0,#0x40000        ;2638
00013a  b108              CBZ      r0,|L9.320|
00013c  2014              MOVS     r0,#0x14              ;2640
00013e  e78b              B        |L9.88|
                  |L9.320|
000140  9801              LDR      r0,[sp,#4]            ;2643
000142  f4003000          AND      r0,r0,#0x20000        ;2643
000146  b108              CBZ      r0,|L9.332|
000148  2015              MOVS     r0,#0x15              ;2645
00014a  e785              B        |L9.88|
                  |L9.332|
00014c  9801              LDR      r0,[sp,#4]            ;2648
00014e  f4003080          AND      r0,r0,#0x10000        ;2648
000152  b108              CBZ      r0,|L9.344|
000154  2016              MOVS     r0,#0x16              ;2650
000156  e77f              B        |L9.88|
                  |L9.344|
000158  9801              LDR      r0,[sp,#4]            ;2653
00015a  f4004000          AND      r0,r0,#0x8000         ;2653
00015e  b108              CBZ      r0,|L9.356|
000160  2017              MOVS     r0,#0x17              ;2655
000162  e779              B        |L9.88|
                  |L9.356|
000164  9801              LDR      r0,[sp,#4]            ;2658
000166  f4004080          AND      r0,r0,#0x4000         ;2658
00016a  b108              CBZ      r0,|L9.368|
00016c  2018              MOVS     r0,#0x18              ;2660
00016e  e773              B        |L9.88|
                  |L9.368|
000170  9801              LDR      r0,[sp,#4]            ;2663
000172  f4005000          AND      r0,r0,#0x2000         ;2663
000176  b108              CBZ      r0,|L9.380|
000178  2019              MOVS     r0,#0x19              ;2665
00017a  e76d              B        |L9.88|
                  |L9.380|
00017c  9801              LDR      r0,[sp,#4]            ;2668
00017e  f0000008          AND      r0,r0,#8              ;2668
000182  b108              CBZ      r0,|L9.392|
000184  201a              MOVS     r0,#0x1a              ;2670
000186  e767              B        |L9.88|
                  |L9.392|
000188  4628              MOV      r0,r5                 ;2673
00018a  e765              B        |L9.88|
;;;2675   
                          ENDP

                  |L9.396|
                          DCD      ||RCA||
                  |L9.400|
                          DCD      SDIO_CmdInitStructure
                  |L9.404|
                          DCD      0x40012c34
                  |L9.408|
                          DCD      0xfdffe008

                          AREA ||i.SDEnWideBus||, CODE, READONLY, ALIGN=2

                  SDEnWideBus PROC
;;;2408     */
;;;2409   static SD_Error SDEnWideBus(FunctionalState NewState)
000000  b57c              PUSH     {r2-r6,lr}
;;;2410   {
000002  4605              MOV      r5,r0
;;;2411     SD_Error errorstatus = SD_OK;
000004  2400              MOVS     r4,#0
;;;2412   
;;;2413     uint32_t scr[2] = {0, 0};
000006  2000              MOVS     r0,#0
000008  9000              STR      r0,[sp,#0]
00000a  9001              STR      r0,[sp,#4]
;;;2414   
;;;2415     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
00000c  f7fffffe          BL       SDIO_GetResponse
000010  f0007000          AND      r0,r0,#0x2000000
000014  b110              CBZ      r0,|L10.28|
;;;2416     {
;;;2417       errorstatus = SD_LOCK_UNLOCK_FAILED;
000016  240e              MOVS     r4,#0xe
;;;2418       return(errorstatus);
000018  4620              MOV      r0,r4
                  |L10.26|
;;;2419     }
;;;2420   
;;;2421     /*!< Get SCR Register */
;;;2422     errorstatus = FindSCR(RCA, scr);
;;;2423   
;;;2424     if (errorstatus != SD_OK)
;;;2425     {
;;;2426       return(errorstatus);
;;;2427     }
;;;2428   
;;;2429     /*!< If wide bus operation to be enabled */
;;;2430     if (NewState == ENABLE)
;;;2431     {
;;;2432       /*!< If requested card supports wide bus operation */
;;;2433       if ((scr[1] & SD_WIDE_BUS_SUPPORT) != SD_ALLZERO)
;;;2434       {
;;;2435         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2436         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2437         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2438         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2439         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2440         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2441         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2442   
;;;2443         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2444   
;;;2445         if (errorstatus != SD_OK)
;;;2446         {
;;;2447           return(errorstatus);
;;;2448         }
;;;2449   
;;;2450         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2451         SDIO_CmdInitStructure.SDIO_Argument = 0x2;
;;;2452         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2453         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2454         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2455         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2456         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2457   
;;;2458         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2459   
;;;2460         if (errorstatus != SD_OK)
;;;2461         {
;;;2462           return(errorstatus);
;;;2463         }
;;;2464         return(errorstatus);
;;;2465       }
;;;2466       else
;;;2467       {
;;;2468         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2469         return(errorstatus);
;;;2470       }
;;;2471     }   /*!< If wide bus operation to be disabled */
;;;2472     else
;;;2473     {
;;;2474       /*!< If requested card supports 1 bit mode operation */
;;;2475       if ((scr[1] & SD_SINGLE_BUS_SUPPORT) != SD_ALLZERO)
;;;2476       {
;;;2477         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2478         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2479         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2480         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2481         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2482         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2483         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2484   
;;;2485   
;;;2486         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2487   
;;;2488         if (errorstatus != SD_OK)
;;;2489         {
;;;2490           return(errorstatus);
;;;2491         }
;;;2492   
;;;2493         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2494         SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;2495         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2496         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2497         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2498         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2499         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2500   
;;;2501         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2502   
;;;2503         if (errorstatus != SD_OK)
;;;2504         {
;;;2505           return(errorstatus);
;;;2506         }
;;;2507   
;;;2508         return(errorstatus);
;;;2509       }
;;;2510       else
;;;2511       {
;;;2512         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2513         return(errorstatus);
;;;2514       }
;;;2515     }
;;;2516   }
00001a  bd7c              POP      {r2-r6,pc}
                  |L10.28|
00001c  493d              LDR      r1,|L10.276|
00001e  8809              LDRH     r1,[r1,#0]            ;2422  ; RCA
000020  b288              UXTH     r0,r1                 ;2422
000022  4669              MOV      r1,sp                 ;2422
000024  f7fffffe          BL       FindSCR
000028  4604              MOV      r4,r0                 ;2422
00002a  b10c              CBZ      r4,|L10.48|
00002c  4620              MOV      r0,r4                 ;2426
00002e  e7f4              B        |L10.26|
                  |L10.48|
000030  2d01              CMP      r5,#1                 ;2430
000032  d136              BNE      |L10.162|
000034  9801              LDR      r0,[sp,#4]            ;2433
000036  f4002080          AND      r0,r0,#0x40000        ;2433
00003a  2800              CMP      r0,#0                 ;2433
00003c  d02e              BEQ      |L10.156|
00003e  4835              LDR      r0,|L10.276|
000040  8800              LDRH     r0,[r0,#0]            ;2436  ; RCA
000042  0400              LSLS     r0,r0,#16             ;2436
000044  4934              LDR      r1,|L10.280|
000046  6008              STR      r0,[r1,#0]            ;2436  ; SDIO_CmdInitStructure
000048  2037              MOVS     r0,#0x37              ;2437
00004a  6048              STR      r0,[r1,#4]            ;2437  ; SDIO_CmdInitStructure
00004c  2040              MOVS     r0,#0x40              ;2438
00004e  6088              STR      r0,[r1,#8]            ;2438  ; SDIO_CmdInitStructure
000050  2000              MOVS     r0,#0                 ;2439
000052  60c8              STR      r0,[r1,#0xc]          ;2439  ; SDIO_CmdInitStructure
000054  02a8              LSLS     r0,r5,#10             ;2440
000056  6108              STR      r0,[r1,#0x10]         ;2440  ; SDIO_CmdInitStructure
000058  4608              MOV      r0,r1                 ;2441
00005a  f7fffffe          BL       SDIO_SendCommand
00005e  2037              MOVS     r0,#0x37              ;2443
000060  f7fffffe          BL       CmdResp1Error
000064  4604              MOV      r4,r0                 ;2443
000066  b10c              CBZ      r4,|L10.108|
000068  4620              MOV      r0,r4                 ;2447
00006a  e7d6              B        |L10.26|
                  |L10.108|
00006c  2002              MOVS     r0,#2                 ;2451
00006e  492a              LDR      r1,|L10.280|
000070  6008              STR      r0,[r1,#0]            ;2451  ; SDIO_CmdInitStructure
000072  2006              MOVS     r0,#6                 ;2452
000074  6048              STR      r0,[r1,#4]            ;2452  ; SDIO_CmdInitStructure
000076  2040              MOVS     r0,#0x40              ;2453
000078  6088              STR      r0,[r1,#8]            ;2453  ; SDIO_CmdInitStructure
00007a  2000              MOVS     r0,#0                 ;2454
00007c  60c8              STR      r0,[r1,#0xc]          ;2454  ; SDIO_CmdInitStructure
00007e  f44f6080          MOV      r0,#0x400             ;2455
000082  6108              STR      r0,[r1,#0x10]         ;2455  ; SDIO_CmdInitStructure
000084  4608              MOV      r0,r1                 ;2456
000086  f7fffffe          BL       SDIO_SendCommand
00008a  2006              MOVS     r0,#6                 ;2458
00008c  f7fffffe          BL       CmdResp1Error
000090  4604              MOV      r4,r0                 ;2458
000092  b10c              CBZ      r4,|L10.152|
000094  4620              MOV      r0,r4                 ;2462
000096  e7c0              B        |L10.26|
                  |L10.152|
000098  4620              MOV      r0,r4                 ;2464
00009a  e7be              B        |L10.26|
                  |L10.156|
00009c  2425              MOVS     r4,#0x25              ;2468
00009e  4620              MOV      r0,r4                 ;2469
0000a0  e7bb              B        |L10.26|
                  |L10.162|
0000a2  9801              LDR      r0,[sp,#4]            ;2475
0000a4  f4003080          AND      r0,r0,#0x10000        ;2475
0000a8  b378              CBZ      r0,|L10.266|
0000aa  481a              LDR      r0,|L10.276|
0000ac  8800              LDRH     r0,[r0,#0]            ;2478  ; RCA
0000ae  0400              LSLS     r0,r0,#16             ;2478
0000b0  4919              LDR      r1,|L10.280|
0000b2  6008              STR      r0,[r1,#0]            ;2478  ; SDIO_CmdInitStructure
0000b4  2037              MOVS     r0,#0x37              ;2479
0000b6  6048              STR      r0,[r1,#4]            ;2479  ; SDIO_CmdInitStructure
0000b8  2040              MOVS     r0,#0x40              ;2480
0000ba  6088              STR      r0,[r1,#8]            ;2480  ; SDIO_CmdInitStructure
0000bc  2000              MOVS     r0,#0                 ;2481
0000be  60c8              STR      r0,[r1,#0xc]          ;2481  ; SDIO_CmdInitStructure
0000c0  f44f6080          MOV      r0,#0x400             ;2482
0000c4  6108              STR      r0,[r1,#0x10]         ;2482  ; SDIO_CmdInitStructure
0000c6  4608              MOV      r0,r1                 ;2483
0000c8  f7fffffe          BL       SDIO_SendCommand
0000cc  2037              MOVS     r0,#0x37              ;2486
0000ce  f7fffffe          BL       CmdResp1Error
0000d2  4604              MOV      r4,r0                 ;2486
0000d4  b10c              CBZ      r4,|L10.218|
0000d6  4620              MOV      r0,r4                 ;2490
0000d8  e79f              B        |L10.26|
                  |L10.218|
0000da  2000              MOVS     r0,#0                 ;2494
0000dc  490e              LDR      r1,|L10.280|
0000de  6008              STR      r0,[r1,#0]            ;2494  ; SDIO_CmdInitStructure
0000e0  2006              MOVS     r0,#6                 ;2495
0000e2  6048              STR      r0,[r1,#4]            ;2495  ; SDIO_CmdInitStructure
0000e4  2040              MOVS     r0,#0x40              ;2496
0000e6  6088              STR      r0,[r1,#8]            ;2496  ; SDIO_CmdInitStructure
0000e8  2000              MOVS     r0,#0                 ;2497
0000ea  60c8              STR      r0,[r1,#0xc]          ;2497  ; SDIO_CmdInitStructure
0000ec  f44f6080          MOV      r0,#0x400             ;2498
0000f0  6108              STR      r0,[r1,#0x10]         ;2498  ; SDIO_CmdInitStructure
0000f2  4608              MOV      r0,r1                 ;2499
0000f4  f7fffffe          BL       SDIO_SendCommand
0000f8  2006              MOVS     r0,#6                 ;2501
0000fa  f7fffffe          BL       CmdResp1Error
0000fe  4604              MOV      r4,r0                 ;2501
000100  b10c              CBZ      r4,|L10.262|
000102  4620              MOV      r0,r4                 ;2505
000104  e789              B        |L10.26|
                  |L10.262|
000106  4620              MOV      r0,r4                 ;2508
000108  e787              B        |L10.26|
                  |L10.266|
00010a  e7ff              B        |L10.268|
                  |L10.268|
00010c  2425              MOVS     r4,#0x25              ;2512
00010e  4620              MOV      r0,r4                 ;2513
000110  e783              B        |L10.26|
;;;2517   
                          ENDP

000112  0000              DCW      0x0000
                  |L10.276|
                          DCD      ||RCA||
                  |L10.280|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SDIO_IRQHandler||, CODE, READONLY, ALIGN=1

                  SDIO_IRQHandler PROC
;;;3017   */
;;;3018   void SDIO_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;3019   {
;;;3020   	/* SDIO */
;;;3021   	SD_ProcessIRQSrc();
000002  f7fffffe          BL       SD_ProcessIRQSrc
;;;3022   }
000006  bd10              POP      {r4,pc}
;;;3023   
                          ENDP


                          AREA ||i.SDIO_Interrupts_Config||, CODE, READONLY, ALIGN=1

                  SDIO_Interrupts_Config PROC
;;;2988   */
;;;2989   void SDIO_Interrupts_Config(void)
000000  b508              PUSH     {r3,lr}
;;;2990   {
;;;2991     NVIC_InitTypeDef NVIC_InitStructure;
;;;2992   
;;;2993     /* Configure the NVIC Preemption Priority Bits */
;;;2994     NVIC_PriorityGroupConfig(NVIC_PriorityGroup_1);
000002  f44f60c0          MOV      r0,#0x600
000006  f7fffffe          BL       NVIC_PriorityGroupConfig
;;;2995   
;;;2996     NVIC_InitStructure.NVIC_IRQChannel = SDIO_IRQn;
00000a  2031              MOVS     r0,#0x31
00000c  f88d0000          STRB     r0,[sp,#0]
;;;2997     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
000010  2000              MOVS     r0,#0
000012  f88d0001          STRB     r0,[sp,#1]
;;;2998     NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
000016  f88d0002          STRB     r0,[sp,#2]
;;;2999     NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
00001a  2001              MOVS     r0,#1
00001c  f88d0003          STRB     r0,[sp,#3]
;;;3000     NVIC_Init(&NVIC_InitStructure);
000020  4668              MOV      r0,sp
000022  f7fffffe          BL       NVIC_Init
;;;3001   
;;;3002   #if 1
;;;3003     NVIC_InitStructure.NVIC_IRQChannel = SD_SDIO_DMA_IRQn;
000026  203b              MOVS     r0,#0x3b
000028  f88d0000          STRB     r0,[sp,#0]
;;;3004     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
00002c  2001              MOVS     r0,#1
00002e  f88d0001          STRB     r0,[sp,#1]
;;;3005     NVIC_Init(&NVIC_InitStructure);
000032  4668              MOV      r0,sp
000034  f7fffffe          BL       NVIC_Init
;;;3006   #endif
;;;3007   }
000038  bd08              POP      {r3,pc}
;;;3008   
                          ENDP


                          AREA ||i.SD_DeInit||, CODE, READONLY, ALIGN=1

                  SD_DeInit PROC
;;;389      */
;;;390    void SD_DeInit(void)
000000  b510              PUSH     {r4,lr}
;;;391    {
;;;392      SD_LowLevel_DeInit();
000002  f7fffffe          BL       SD_LowLevel_DeInit
;;;393    }
000006  bd10              POP      {r4,pc}
;;;394    
                          ENDP


                          AREA ||i.SD_Detect||, CODE, READONLY, ALIGN=2

                  SD_Detect PROC
;;;515     */
;;;516    uint8_t SD_Detect(void)
000000  b508              PUSH     {r3,lr}
;;;517    {
;;;518      __IO uint8_t status = SD_PRESENT;
000002  2001              MOVS     r0,#1
000004  9000              STR      r0,[sp,#0]
;;;519    
;;;520      /*!< Check GPIO to detect SD */
;;;521      if (GPIO_ReadInputDataBit(SD_DETECT_GPIO_PORT, SD_DETECT_PIN) != Bit_RESET)
000006  2104              MOVS     r1,#4
000008  4804              LDR      r0,|L14.28|
00000a  f7fffffe          BL       GPIO_ReadInputDataBit
00000e  b108              CBZ      r0,|L14.20|
;;;522      {
;;;523        status = SD_NOT_PRESENT;
000010  2000              MOVS     r0,#0
000012  9000              STR      r0,[sp,#0]
                  |L14.20|
;;;524      }
;;;525      return status;
000014  f89d0000          LDRB     r0,[sp,#0]
;;;526    }
000018  bd08              POP      {r3,pc}
;;;527    
                          ENDP

00001a  0000              DCW      0x0000
                  |L14.28|
                          DCD      0x40021000

                          AREA ||i.SD_EnableWideBusOperation||, CODE, READONLY, ALIGN=2

                  SD_EnableWideBusOperation PROC
;;;1079     */
;;;1080   SD_Error SD_EnableWideBusOperation(uint32_t WideMode)
000000  b570              PUSH     {r4-r6,lr}
;;;1081   {
000002  4604              MOV      r4,r0
;;;1082     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1083   
;;;1084     /*!< MMC Card doesn't support this feature */
;;;1085     if (SDIO_MULTIMEDIA_CARD == CardType)
000006  4820              LDR      r0,|L15.136|
000008  6800              LDR      r0,[r0,#0]  ; CardType
00000a  2803              CMP      r0,#3
00000c  d102              BNE      |L15.20|
;;;1086     {
;;;1087       errorstatus = SD_UNSUPPORTED_FEATURE;
00000e  2527              MOVS     r5,#0x27
;;;1088       return(errorstatus);
000010  4628              MOV      r0,r5
                  |L15.18|
;;;1089     }
;;;1090     else if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1091     {
;;;1092       if (SDIO_BusWide_8b == WideMode)
;;;1093       {
;;;1094         errorstatus = SD_UNSUPPORTED_FEATURE;
;;;1095         return(errorstatus);
;;;1096       }
;;;1097       else if (SDIO_BusWide_4b == WideMode)
;;;1098       {
;;;1099         errorstatus = SDEnWideBus(ENABLE);
;;;1100   
;;;1101         if (SD_OK == errorstatus)
;;;1102         {
;;;1103           /*!< Configure the SDIO peripheral */
;;;1104           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;1105           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1106           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1107           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1108           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_4b;
;;;1109           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1110           SDIO_Init(&SDIO_InitStructure);
;;;1111         }
;;;1112       }
;;;1113       else
;;;1114       {
;;;1115         errorstatus = SDEnWideBus(DISABLE);
;;;1116   
;;;1117         if (SD_OK == errorstatus)
;;;1118         {
;;;1119           /*!< Configure the SDIO peripheral */
;;;1120           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;1121           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1122           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1123           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1124           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;1125           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1126           SDIO_Init(&SDIO_InitStructure);
;;;1127         }
;;;1128       }
;;;1129     }
;;;1130   
;;;1131     return(errorstatus);
;;;1132   }
000012  bd70              POP      {r4-r6,pc}
                  |L15.20|
000014  481c              LDR      r0,|L15.136|
000016  6800              LDR      r0,[r0,#0]            ;1090  ; CardType
000018  b138              CBZ      r0,|L15.42|
00001a  481b              LDR      r0,|L15.136|
00001c  6800              LDR      r0,[r0,#0]            ;1090  ; CardType
00001e  2801              CMP      r0,#1                 ;1090
000020  d003              BEQ      |L15.42|
000022  4819              LDR      r0,|L15.136|
000024  6800              LDR      r0,[r0,#0]            ;1090  ; CardType
000026  2802              CMP      r0,#2                 ;1090
000028  d12c              BNE      |L15.132|
                  |L15.42|
00002a  f5b45f80          CMP      r4,#0x1000            ;1092
00002e  d102              BNE      |L15.54|
000030  2527              MOVS     r5,#0x27              ;1094
000032  4628              MOV      r0,r5                 ;1095
000034  e7ed              B        |L15.18|
                  |L15.54|
000036  f5b46f00          CMP      r4,#0x800             ;1097
00003a  d113              BNE      |L15.100|
00003c  2001              MOVS     r0,#1                 ;1099
00003e  f7fffffe          BL       SDEnWideBus
000042  4605              MOV      r5,r0                 ;1099
000044  b9f5              CBNZ     r5,|L15.132|
000046  2000              MOVS     r0,#0                 ;1104
000048  4910              LDR      r1,|L15.140|
00004a  7508              STRB     r0,[r1,#0x14]         ;1104
00004c  6008              STR      r0,[r1,#0]            ;1105  ; SDIO_InitStructure
00004e  6048              STR      r0,[r1,#4]            ;1106  ; SDIO_InitStructure
000050  6088              STR      r0,[r1,#8]            ;1107  ; SDIO_InitStructure
000052  f44f6000          MOV      r0,#0x800             ;1108
000056  60c8              STR      r0,[r1,#0xc]          ;1108  ; SDIO_InitStructure
000058  2000              MOVS     r0,#0                 ;1109
00005a  6108              STR      r0,[r1,#0x10]         ;1109  ; SDIO_InitStructure
00005c  4608              MOV      r0,r1                 ;1110
00005e  f7fffffe          BL       SDIO_Init
000062  e00f              B        |L15.132|
                  |L15.100|
000064  2000              MOVS     r0,#0                 ;1115
000066  f7fffffe          BL       SDEnWideBus
00006a  4605              MOV      r5,r0                 ;1115
00006c  b955              CBNZ     r5,|L15.132|
00006e  2000              MOVS     r0,#0                 ;1120
000070  4906              LDR      r1,|L15.140|
000072  7508              STRB     r0,[r1,#0x14]         ;1120
000074  6008              STR      r0,[r1,#0]            ;1121  ; SDIO_InitStructure
000076  6048              STR      r0,[r1,#4]            ;1122  ; SDIO_InitStructure
000078  6088              STR      r0,[r1,#8]            ;1123  ; SDIO_InitStructure
00007a  60c8              STR      r0,[r1,#0xc]          ;1124  ; SDIO_InitStructure
00007c  6108              STR      r0,[r1,#0x10]         ;1125  ; SDIO_InitStructure
00007e  4608              MOV      r0,r1                 ;1126
000080  f7fffffe          BL       SDIO_Init
                  |L15.132|
000084  4628              MOV      r0,r5                 ;1131
000086  e7c4              B        |L15.18|
;;;1133   
                          ENDP

                  |L15.136|
                          DCD      CardType
                  |L15.140|
                          DCD      SDIO_InitStructure

                          AREA ||i.SD_Erase||, CODE, READONLY, ALIGN=2

                  SD_Erase PROC
;;;1754     */
;;;1755   SD_Error SD_Erase(uint32_t startaddr, uint32_t endaddr)
000000  e92d41fc          PUSH     {r2-r8,lr}
;;;1756   {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
;;;1757     SD_Error errorstatus = SD_OK;
000008  2400              MOVS     r4,#0
;;;1758     uint32_t delay = 0;
00000a  2500              MOVS     r5,#0
;;;1759     __IO uint32_t maxdelay = 0;
00000c  2000              MOVS     r0,#0
00000e  9001              STR      r0,[sp,#4]
;;;1760     uint8_t cardstate = 0;
000010  9000              STR      r0,[sp,#0]
;;;1761   
;;;1762     /*!< Check if the card coomnd class supports erase command */
;;;1763     if (((CSD_Tab[1] >> 20) & SD_CCCC_ERASE) == 0)
000012  4846              LDR      r0,|L16.300|
000014  6840              LDR      r0,[r0,#4]  ; CSD_Tab
000016  2120              MOVS     r1,#0x20
000018  ea015010          AND      r0,r1,r0,LSR #20
00001c  b918              CBNZ     r0,|L16.38|
;;;1764     {
;;;1765       errorstatus = SD_REQUEST_NOT_APPLICABLE;
00001e  2425              MOVS     r4,#0x25
;;;1766       return(errorstatus);
000020  4620              MOV      r0,r4
                  |L16.34|
;;;1767     }
;;;1768   
;;;1769     maxdelay = 120000 / ((SDIO->CLKCR & 0xFF) + 2);
;;;1770   
;;;1771     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
;;;1772     {
;;;1773       errorstatus = SD_LOCK_UNLOCK_FAILED;
;;;1774       return(errorstatus);
;;;1775     }
;;;1776   
;;;1777     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
;;;1778     {
;;;1779       startaddr /= 512;
;;;1780       endaddr /= 512;
;;;1781     }
;;;1782   
;;;1783     /*!< According to sd-card spec 1.0 ERASE_GROUP_START (CMD32) and erase_group_end(CMD33) */
;;;1784     if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1785     {
;;;1786       /*!< Send CMD32 SD_ERASE_GRP_START with argument as addr  */
;;;1787       SDIO_CmdInitStructure.SDIO_Argument = startaddr;
;;;1788       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_START;
;;;1789       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1790       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1791       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1792       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1793   
;;;1794       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_START);
;;;1795       if (errorstatus != SD_OK)
;;;1796       {
;;;1797         return(errorstatus);
;;;1798       }
;;;1799   
;;;1800       /*!< Send CMD33 SD_ERASE_GRP_END with argument as addr  */
;;;1801       SDIO_CmdInitStructure.SDIO_Argument = endaddr;
;;;1802       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_END;
;;;1803       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1804       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1805       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1806       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1807   
;;;1808       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_END);
;;;1809       if (errorstatus != SD_OK)
;;;1810       {
;;;1811         return(errorstatus);
;;;1812       }
;;;1813     }
;;;1814   
;;;1815     /*!< Send CMD38 ERASE */
;;;1816     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1817     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ERASE;
;;;1818     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1819     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1820     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1821     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1822   
;;;1823     errorstatus = CmdResp1Error(SD_CMD_ERASE);
;;;1824   
;;;1825     if (errorstatus != SD_OK)
;;;1826     {
;;;1827       return(errorstatus);
;;;1828     }
;;;1829   
;;;1830     for (delay = 0; delay < maxdelay; delay++)
;;;1831     {}
;;;1832   
;;;1833     /*!< Wait till the card is in programming state */
;;;1834     errorstatus = IsCardProgramming(&cardstate);
;;;1835     delay = SD_DATATIMEOUT;
;;;1836     while ((delay > 0) && (errorstatus == SD_OK) && ((SD_CARD_PROGRAMMING == cardstate) || (SD_CARD_RECEIVING == cardstate)))
;;;1837     {
;;;1838       errorstatus = IsCardProgramming(&cardstate);
;;;1839       delay--;
;;;1840     }
;;;1841   
;;;1842     return(errorstatus);
;;;1843   }
000022  e8bd81fc          POP      {r2-r8,pc}
                  |L16.38|
000026  4842              LDR      r0,|L16.304|
000028  6800              LDR      r0,[r0,#0]            ;1769
00002a  b2c0              UXTB     r0,r0                 ;1769
00002c  1c80              ADDS     r0,r0,#2              ;1769
00002e  4941              LDR      r1,|L16.308|
000030  fbb1f0f0          UDIV     r0,r1,r0              ;1769
000034  9001              STR      r0,[sp,#4]            ;1769
000036  2000              MOVS     r0,#0                 ;1771
000038  f7fffffe          BL       SDIO_GetResponse
00003c  f0007000          AND      r0,r0,#0x2000000      ;1771
000040  b110              CBZ      r0,|L16.72|
000042  240e              MOVS     r4,#0xe               ;1773
000044  4620              MOV      r0,r4                 ;1774
000046  e7ec              B        |L16.34|
                  |L16.72|
000048  483b              LDR      r0,|L16.312|
00004a  6800              LDR      r0,[r0,#0]            ;1777  ; CardType
00004c  2802              CMP      r0,#2                 ;1777
00004e  d101              BNE      |L16.84|
000050  0a76              LSRS     r6,r6,#9              ;1779
000052  0a7f              LSRS     r7,r7,#9              ;1780
                  |L16.84|
000054  4838              LDR      r0,|L16.312|
000056  6800              LDR      r0,[r0,#0]            ;1784  ; CardType
000058  b138              CBZ      r0,|L16.106|
00005a  4837              LDR      r0,|L16.312|
00005c  6800              LDR      r0,[r0,#0]            ;1784  ; CardType
00005e  2801              CMP      r0,#1                 ;1784
000060  d003              BEQ      |L16.106|
000062  4835              LDR      r0,|L16.312|
000064  6800              LDR      r0,[r0,#0]            ;1784  ; CardType
000066  2802              CMP      r0,#2                 ;1784
000068  d12b              BNE      |L16.194|
                  |L16.106|
00006a  4834              LDR      r0,|L16.316|
00006c  6006              STR      r6,[r0,#0]            ;1787  ; SDIO_CmdInitStructure
00006e  2020              MOVS     r0,#0x20              ;1788
000070  4932              LDR      r1,|L16.316|
000072  6048              STR      r0,[r1,#4]            ;1788  ; SDIO_CmdInitStructure
000074  2040              MOVS     r0,#0x40              ;1789
000076  6088              STR      r0,[r1,#8]            ;1789  ; SDIO_CmdInitStructure
000078  2000              MOVS     r0,#0                 ;1790
00007a  60c8              STR      r0,[r1,#0xc]          ;1790  ; SDIO_CmdInitStructure
00007c  f44f6080          MOV      r0,#0x400             ;1791
000080  6108              STR      r0,[r1,#0x10]         ;1791  ; SDIO_CmdInitStructure
000082  4608              MOV      r0,r1                 ;1792
000084  f7fffffe          BL       SDIO_SendCommand
000088  2020              MOVS     r0,#0x20              ;1794
00008a  f7fffffe          BL       CmdResp1Error
00008e  4604              MOV      r4,r0                 ;1794
000090  b10c              CBZ      r4,|L16.150|
000092  4620              MOV      r0,r4                 ;1797
000094  e7c5              B        |L16.34|
                  |L16.150|
000096  4829              LDR      r0,|L16.316|
000098  6007              STR      r7,[r0,#0]            ;1801  ; SDIO_CmdInitStructure
00009a  2021              MOVS     r0,#0x21              ;1802
00009c  4927              LDR      r1,|L16.316|
00009e  6048              STR      r0,[r1,#4]            ;1802  ; SDIO_CmdInitStructure
0000a0  2040              MOVS     r0,#0x40              ;1803
0000a2  6088              STR      r0,[r1,#8]            ;1803  ; SDIO_CmdInitStructure
0000a4  2000              MOVS     r0,#0                 ;1804
0000a6  60c8              STR      r0,[r1,#0xc]          ;1804  ; SDIO_CmdInitStructure
0000a8  f44f6080          MOV      r0,#0x400             ;1805
0000ac  6108              STR      r0,[r1,#0x10]         ;1805  ; SDIO_CmdInitStructure
0000ae  4608              MOV      r0,r1                 ;1806
0000b0  f7fffffe          BL       SDIO_SendCommand
0000b4  2021              MOVS     r0,#0x21              ;1808
0000b6  f7fffffe          BL       CmdResp1Error
0000ba  4604              MOV      r4,r0                 ;1808
0000bc  b10c              CBZ      r4,|L16.194|
0000be  4620              MOV      r0,r4                 ;1811
0000c0  e7af              B        |L16.34|
                  |L16.194|
0000c2  2000              MOVS     r0,#0                 ;1816
0000c4  491d              LDR      r1,|L16.316|
0000c6  6008              STR      r0,[r1,#0]            ;1816  ; SDIO_CmdInitStructure
0000c8  2026              MOVS     r0,#0x26              ;1817
0000ca  6048              STR      r0,[r1,#4]            ;1817  ; SDIO_CmdInitStructure
0000cc  2040              MOVS     r0,#0x40              ;1818
0000ce  6088              STR      r0,[r1,#8]            ;1818  ; SDIO_CmdInitStructure
0000d0  2000              MOVS     r0,#0                 ;1819
0000d2  60c8              STR      r0,[r1,#0xc]          ;1819  ; SDIO_CmdInitStructure
0000d4  f44f6080          MOV      r0,#0x400             ;1820
0000d8  6108              STR      r0,[r1,#0x10]         ;1820  ; SDIO_CmdInitStructure
0000da  4608              MOV      r0,r1                 ;1821
0000dc  f7fffffe          BL       SDIO_SendCommand
0000e0  2026              MOVS     r0,#0x26              ;1823
0000e2  f7fffffe          BL       CmdResp1Error
0000e6  4604              MOV      r4,r0                 ;1823
0000e8  b10c              CBZ      r4,|L16.238|
0000ea  4620              MOV      r0,r4                 ;1827
0000ec  e799              B        |L16.34|
                  |L16.238|
0000ee  2500              MOVS     r5,#0                 ;1830
0000f0  e000              B        |L16.244|
                  |L16.242|
0000f2  1c6d              ADDS     r5,r5,#1              ;1830
                  |L16.244|
0000f4  9801              LDR      r0,[sp,#4]            ;1830
0000f6  4285              CMP      r5,r0                 ;1830
0000f8  d3fb              BCC      |L16.242|
0000fa  4668              MOV      r0,sp                 ;1834
0000fc  f7fffffe          BL       IsCardProgramming
000100  4604              MOV      r4,r0                 ;1834
000102  f04f35ff          MOV      r5,#0xffffffff        ;1835
000106  e004              B        |L16.274|
                  |L16.264|
000108  4668              MOV      r0,sp                 ;1838
00010a  f7fffffe          BL       IsCardProgramming
00010e  4604              MOV      r4,r0                 ;1838
000110  1e6d              SUBS     r5,r5,#1              ;1839
                  |L16.274|
000112  b145              CBZ      r5,|L16.294|
000114  b93c              CBNZ     r4,|L16.294|
000116  f89d0000          LDRB     r0,[sp,#0]            ;1836
00011a  2807              CMP      r0,#7                 ;1836
00011c  d0f4              BEQ      |L16.264|
00011e  f89d0000          LDRB     r0,[sp,#0]            ;1836
000122  2806              CMP      r0,#6                 ;1836
000124  d0f0              BEQ      |L16.264|
                  |L16.294|
000126  4620              MOV      r0,r4                 ;1842
000128  e77b              B        |L16.34|
;;;1844   
                          ENDP

00012a  0000              DCW      0x0000
                  |L16.300|
                          DCD      CSD_Tab
                  |L16.304|
                          DCD      0x40012c04
                  |L16.308|
                          DCD      0x0001d4c0
                  |L16.312|
                          DCD      CardType
                  |L16.316|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_GetCardInfo||, CODE, READONLY, ALIGN=2

                  SD_GetCardInfo PROC
;;;782      */
;;;783    SD_Error SD_GetCardInfo(SD_CardInfo *cardinfo)
000000  b5f0              PUSH     {r4-r7,lr}
;;;784    {
000002  4601              MOV      r1,r0
;;;785      SD_Error errorstatus = SD_OK;
000004  2000              MOVS     r0,#0
;;;786      uint8_t tmp = 0;
000006  2200              MOVS     r2,#0
;;;787    
;;;788      cardinfo->CardType = (uint8_t)CardType;
000008  4bbc              LDR      r3,|L17.764|
00000a  781b              LDRB     r3,[r3,#0]  ; CardType
00000c  f8813056          STRB     r3,[r1,#0x56]
;;;789      cardinfo->RCA = (uint16_t)RCA;
000010  4bbb              LDR      r3,|L17.768|
000012  881b              LDRH     r3,[r3,#0]  ; RCA
000014  f8a13054          STRH     r3,[r1,#0x54]
;;;790    
;;;791      /*!< Byte 0 */
;;;792      tmp = (uint8_t)((CSD_Tab[0] & 0xFF000000) >> 24);
000018  4bba              LDR      r3,|L17.772|
00001a  681b              LDR      r3,[r3,#0]  ; CSD_Tab
00001c  0e1a              LSRS     r2,r3,#24
;;;793      cardinfo->SD_csd.CSDStruct = (tmp & 0xC0) >> 6;
00001e  0993              LSRS     r3,r2,#6
000020  700b              STRB     r3,[r1,#0]
;;;794      cardinfo->SD_csd.SysSpecVersion = (tmp & 0x3C) >> 2;
000022  f3c20383          UBFX     r3,r2,#2,#4
000026  704b              STRB     r3,[r1,#1]
;;;795      cardinfo->SD_csd.Reserved1 = tmp & 0x03;
000028  f0020303          AND      r3,r2,#3
00002c  708b              STRB     r3,[r1,#2]
;;;796    
;;;797      /*!< Byte 1 */
;;;798      tmp = (uint8_t)((CSD_Tab[0] & 0x00FF0000) >> 16);
00002e  4bb5              LDR      r3,|L17.772|
000030  681b              LDR      r3,[r3,#0]  ; CSD_Tab
000032  f3c34207          UBFX     r2,r3,#16,#8
;;;799      cardinfo->SD_csd.TAAC = tmp;
000036  70ca              STRB     r2,[r1,#3]
;;;800    
;;;801      /*!< Byte 2 */
;;;802      tmp = (uint8_t)((CSD_Tab[0] & 0x0000FF00) >> 8);
000038  4bb2              LDR      r3,|L17.772|
00003a  881b              LDRH     r3,[r3,#0]  ; CSD_Tab
00003c  f3c32207          UBFX     r2,r3,#8,#8
;;;803      cardinfo->SD_csd.NSAC = tmp;
000040  710a              STRB     r2,[r1,#4]
;;;804    
;;;805      /*!< Byte 3 */
;;;806      tmp = (uint8_t)(CSD_Tab[0] & 0x000000FF);
000042  4bb0              LDR      r3,|L17.772|
000044  781a              LDRB     r2,[r3,#0]  ; CSD_Tab
;;;807      cardinfo->SD_csd.MaxBusClkFrec = tmp;
000046  714a              STRB     r2,[r1,#5]
;;;808    
;;;809      /*!< Byte 4 */
;;;810      tmp = (uint8_t)((CSD_Tab[1] & 0xFF000000) >> 24);
000048  685b              LDR      r3,[r3,#4]  ; CSD_Tab
00004a  0e1a              LSRS     r2,r3,#24
;;;811      cardinfo->SD_csd.CardComdClasses = tmp << 4;
00004c  0113              LSLS     r3,r2,#4
00004e  80cb              STRH     r3,[r1,#6]
;;;812    
;;;813      /*!< Byte 5 */
;;;814      tmp = (uint8_t)((CSD_Tab[1] & 0x00FF0000) >> 16);
000050  4bac              LDR      r3,|L17.772|
000052  685b              LDR      r3,[r3,#4]  ; CSD_Tab
000054  f3c34207          UBFX     r2,r3,#16,#8
;;;815      cardinfo->SD_csd.CardComdClasses |= (tmp & 0xF0) >> 4;
000058  88cb              LDRH     r3,[r1,#6]
00005a  ea431312          ORR      r3,r3,r2,LSR #4
00005e  80cb              STRH     r3,[r1,#6]
;;;816      cardinfo->SD_csd.RdBlockLen = tmp & 0x0F;
000060  f002030f          AND      r3,r2,#0xf
000064  720b              STRB     r3,[r1,#8]
;;;817    
;;;818      /*!< Byte 6 */
;;;819      tmp = (uint8_t)((CSD_Tab[1] & 0x0000FF00) >> 8);
000066  4ba7              LDR      r3,|L17.772|
000068  889b              LDRH     r3,[r3,#4]  ; CSD_Tab
00006a  f3c32207          UBFX     r2,r3,#8,#8
;;;820      cardinfo->SD_csd.PartBlockRead = (tmp & 0x80) >> 7;
00006e  09d3              LSRS     r3,r2,#7
000070  724b              STRB     r3,[r1,#9]
;;;821      cardinfo->SD_csd.WrBlockMisalign = (tmp & 0x40) >> 6;
000072  f3c21380          UBFX     r3,r2,#6,#1
000076  728b              STRB     r3,[r1,#0xa]
;;;822      cardinfo->SD_csd.RdBlockMisalign = (tmp & 0x20) >> 5;
000078  f3c21340          UBFX     r3,r2,#5,#1
00007c  72cb              STRB     r3,[r1,#0xb]
;;;823      cardinfo->SD_csd.DSRImpl = (tmp & 0x10) >> 4;
00007e  f3c21300          UBFX     r3,r2,#4,#1
000082  730b              STRB     r3,[r1,#0xc]
;;;824      cardinfo->SD_csd.Reserved2 = 0; /*!< Reserved */
000084  2300              MOVS     r3,#0
000086  734b              STRB     r3,[r1,#0xd]
;;;825    
;;;826      if ((CardType == SDIO_STD_CAPACITY_SD_CARD_V1_1) || (CardType == SDIO_STD_CAPACITY_SD_CARD_V2_0))
000088  4b9c              LDR      r3,|L17.764|
00008a  681b              LDR      r3,[r3,#0]  ; CardType
00008c  b11b              CBZ      r3,|L17.150|
00008e  4b9b              LDR      r3,|L17.764|
000090  681b              LDR      r3,[r3,#0]  ; CardType
000092  2b01              CMP      r3,#1
000094  d14f              BNE      |L17.310|
                  |L17.150|
;;;827      {
;;;828        cardinfo->SD_csd.DeviceSize = (tmp & 0x03) << 10;
000096  0793              LSLS     r3,r2,#30
000098  0d1b              LSRS     r3,r3,#20
00009a  610b              STR      r3,[r1,#0x10]
;;;829    
;;;830        /*!< Byte 7 */
;;;831        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
00009c  4b99              LDR      r3,|L17.772|
00009e  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;832        cardinfo->SD_csd.DeviceSize |= (tmp) << 2;
0000a0  690b              LDR      r3,[r1,#0x10]
0000a2  ea430382          ORR      r3,r3,r2,LSL #2
0000a6  610b              STR      r3,[r1,#0x10]
;;;833    
;;;834        /*!< Byte 8 */
;;;835        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
0000a8  4b96              LDR      r3,|L17.772|
0000aa  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000ac  0e1a              LSRS     r2,r3,#24
;;;836        cardinfo->SD_csd.DeviceSize |= (tmp & 0xC0) >> 6;
0000ae  690b              LDR      r3,[r1,#0x10]
0000b0  ea431392          ORR      r3,r3,r2,LSR #6
0000b4  610b              STR      r3,[r1,#0x10]
;;;837    
;;;838        cardinfo->SD_csd.MaxRdCurrentVDDMin = (tmp & 0x38) >> 3;
0000b6  f3c203c2          UBFX     r3,r2,#3,#3
0000ba  750b              STRB     r3,[r1,#0x14]
;;;839        cardinfo->SD_csd.MaxRdCurrentVDDMax = (tmp & 0x07);
0000bc  f0020307          AND      r3,r2,#7
0000c0  754b              STRB     r3,[r1,#0x15]
;;;840    
;;;841        /*!< Byte 9 */
;;;842        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
0000c2  4b90              LDR      r3,|L17.772|
0000c4  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000c6  f3c34207          UBFX     r2,r3,#16,#8
;;;843        cardinfo->SD_csd.MaxWrCurrentVDDMin = (tmp & 0xE0) >> 5;
0000ca  0953              LSRS     r3,r2,#5
0000cc  758b              STRB     r3,[r1,#0x16]
;;;844        cardinfo->SD_csd.MaxWrCurrentVDDMax = (tmp & 0x1C) >> 2;
0000ce  f3c20382          UBFX     r3,r2,#2,#3
0000d2  75cb              STRB     r3,[r1,#0x17]
;;;845        cardinfo->SD_csd.DeviceSizeMul = (tmp & 0x03) << 1;
0000d4  0793              LSLS     r3,r2,#30
0000d6  0f5b              LSRS     r3,r3,#29
0000d8  760b              STRB     r3,[r1,#0x18]
;;;846        /*!< Byte 10 */
;;;847        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
0000da  4b8a              LDR      r3,|L17.772|
0000dc  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
0000de  f3c32207          UBFX     r2,r3,#8,#8
;;;848        cardinfo->SD_csd.DeviceSizeMul |= (tmp & 0x80) >> 7;
0000e2  7e0b              LDRB     r3,[r1,#0x18]
0000e4  ea4313d2          ORR      r3,r3,r2,LSR #7
0000e8  760b              STRB     r3,[r1,#0x18]
;;;849    
;;;850        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) ;
0000ea  690b              LDR      r3,[r1,#0x10]
0000ec  1c5b              ADDS     r3,r3,#1
0000ee  2400              MOVS     r4,#0
0000f0  e9c13412          STRD     r3,r4,[r1,#0x48]
;;;851        cardinfo->CardCapacity *= (1 << (cardinfo->SD_csd.DeviceSizeMul + 2));
0000f4  7e0b              LDRB     r3,[r1,#0x18]
0000f6  e9d16412          LDRD     r6,r4,[r1,#0x48]
0000fa  1c9b              ADDS     r3,r3,#2
0000fc  2501              MOVS     r5,#1
0000fe  fa05f303          LSL      r3,r5,r3
000102  17df              ASRS     r7,r3,#31
000104  fba65c03          UMULL    r5,r12,r6,r3
000108  fb04c303          MLA      r3,r4,r3,r12
00010c  fb063307          MLA      r3,r6,r7,r3
000110  e9c15312          STRD     r5,r3,[r1,#0x48]
;;;852        cardinfo->CardBlockSize = 1 << (cardinfo->SD_csd.RdBlockLen);
000114  7a0c              LDRB     r4,[r1,#8]
000116  2301              MOVS     r3,#1
000118  40a3              LSLS     r3,r3,r4
00011a  650b              STR      r3,[r1,#0x50]
;;;853        cardinfo->CardCapacity *= cardinfo->CardBlockSize;
00011c  2700              MOVS     r7,#0
00011e  e9d15612          LDRD     r5,r6,[r1,#0x48]
000122  6d0b              LDR      r3,[r1,#0x50]
000124  fba54c03          UMULL    r4,r12,r5,r3
000128  fb06c303          MLA      r3,r6,r3,r12
00012c  fb053307          MLA      r3,r5,r7,r3
000130  e9c14312          STRD     r4,r3,[r1,#0x48]
000134  e02d              B        |L17.402|
                  |L17.310|
;;;854      }
;;;855      else if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000136  4b71              LDR      r3,|L17.764|
000138  681b              LDR      r3,[r3,#0]  ; CardType
00013a  2b02              CMP      r3,#2
00013c  d129              BNE      |L17.402|
;;;856      {
;;;857        /*!< Byte 7 */
;;;858        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
00013e  4b71              LDR      r3,|L17.772|
000140  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;859        cardinfo->SD_csd.DeviceSize = (tmp & 0x3F) << 16;
000142  0693              LSLS     r3,r2,#26
000144  0a9b              LSRS     r3,r3,#10
000146  610b              STR      r3,[r1,#0x10]
;;;860    
;;;861        /*!< Byte 8 */
;;;862        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
000148  4b6e              LDR      r3,|L17.772|
00014a  689b              LDR      r3,[r3,#8]  ; CSD_Tab
00014c  0e1a              LSRS     r2,r3,#24
;;;863    
;;;864        cardinfo->SD_csd.DeviceSize |= (tmp << 8);
00014e  690b              LDR      r3,[r1,#0x10]
000150  ea432302          ORR      r3,r3,r2,LSL #8
000154  610b              STR      r3,[r1,#0x10]
;;;865    
;;;866        /*!< Byte 9 */
;;;867        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
000156  4b6b              LDR      r3,|L17.772|
000158  689b              LDR      r3,[r3,#8]  ; CSD_Tab
00015a  f3c34207          UBFX     r2,r3,#16,#8
;;;868    
;;;869        cardinfo->SD_csd.DeviceSize |= (tmp);
00015e  690b              LDR      r3,[r1,#0x10]
000160  4313              ORRS     r3,r3,r2
000162  610b              STR      r3,[r1,#0x10]
;;;870    
;;;871        /*!< Byte 10 */
;;;872        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
000164  4b67              LDR      r3,|L17.772|
000166  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
000168  f3c32207          UBFX     r2,r3,#8,#8
;;;873    
;;;874        cardinfo->CardCapacity = (int64_t)(cardinfo->SD_csd.DeviceSize + 1) * 512 * 1024;
00016c  690b              LDR      r3,[r1,#0x10]
00016e  1c5b              ADDS     r3,r3,#1
000170  f44f7400          MOV      r4,#0x200
000174  fba33404          UMULL    r3,r4,r3,r4
000178  f44f6680          MOV      r6,#0x400
00017c  2500              MOVS     r5,#0
00017e  fba37c06          UMULL    r7,r12,r3,r6
000182  fb04c406          MLA      r4,r4,r6,r12
000186  fb034305          MLA      r3,r3,r5,r4
00018a  e9c17312          STRD     r7,r3,[r1,#0x48]
;;;875        cardinfo->CardBlockSize = 512;
00018e  1073              ASRS     r3,r6,#1
000190  650b              STR      r3,[r1,#0x50]
                  |L17.402|
;;;876      }
;;;877    
;;;878    
;;;879      cardinfo->SD_csd.EraseGrSize = (tmp & 0x40) >> 6;
000192  f3c21380          UBFX     r3,r2,#6,#1
000196  f8013f19          STRB     r3,[r1,#0x19]!
;;;880      cardinfo->SD_csd.EraseGrMul = (tmp & 0x3F) << 1;
00019a  0693              LSLS     r3,r2,#26
00019c  0e5b              LSRS     r3,r3,#25
00019e  704b              STRB     r3,[r1,#1]
;;;881    
;;;882      /*!< Byte 11 */
;;;883      tmp = (uint8_t)(CSD_Tab[2] & 0x000000FF);
0001a0  4b58              LDR      r3,|L17.772|
0001a2  7a1a              LDRB     r2,[r3,#8]  ; CSD_Tab
;;;884      cardinfo->SD_csd.EraseGrMul |= (tmp & 0x80) >> 7;
0001a4  784b              LDRB     r3,[r1,#1]
0001a6  ea4313d2          ORR      r3,r3,r2,LSR #7
0001aa  704b              STRB     r3,[r1,#1]
;;;885      cardinfo->SD_csd.WrProtectGrSize = (tmp & 0x7F);
0001ac  f002037f          AND      r3,r2,#0x7f
0001b0  708b              STRB     r3,[r1,#2]
;;;886    
;;;887      /*!< Byte 12 */
;;;888      tmp = (uint8_t)((CSD_Tab[3] & 0xFF000000) >> 24);
0001b2  4b54              LDR      r3,|L17.772|
0001b4  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
0001b6  0e1a              LSRS     r2,r3,#24
;;;889      cardinfo->SD_csd.WrProtectGrEnable = (tmp & 0x80) >> 7;
0001b8  09d3              LSRS     r3,r2,#7
0001ba  70cb              STRB     r3,[r1,#3]
;;;890      cardinfo->SD_csd.ManDeflECC = (tmp & 0x60) >> 5;
0001bc  f3c21341          UBFX     r3,r2,#5,#2
0001c0  710b              STRB     r3,[r1,#4]
;;;891      cardinfo->SD_csd.WrSpeedFact = (tmp & 0x1C) >> 2;
0001c2  f3c20382          UBFX     r3,r2,#2,#3
0001c6  714b              STRB     r3,[r1,#5]
;;;892      cardinfo->SD_csd.MaxWrBlockLen = (tmp & 0x03) << 2;
0001c8  0793              LSLS     r3,r2,#30
0001ca  0f1b              LSRS     r3,r3,#28
0001cc  718b              STRB     r3,[r1,#6]
;;;893    
;;;894      /*!< Byte 13 */
;;;895      tmp = (uint8_t)((CSD_Tab[3] & 0x00FF0000) >> 16);
0001ce  4b4d              LDR      r3,|L17.772|
0001d0  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
0001d2  f3c34207          UBFX     r2,r3,#16,#8
;;;896      cardinfo->SD_csd.MaxWrBlockLen |= (tmp & 0xC0) >> 6;
0001d6  798b              LDRB     r3,[r1,#6]
0001d8  ea431392          ORR      r3,r3,r2,LSR #6
0001dc  718b              STRB     r3,[r1,#6]
;;;897      cardinfo->SD_csd.WriteBlockPaPartial = (tmp & 0x20) >> 5;
0001de  f3c21340          UBFX     r3,r2,#5,#1
0001e2  71cb              STRB     r3,[r1,#7]
;;;898      cardinfo->SD_csd.Reserved3 = 0;
0001e4  2300              MOVS     r3,#0
0001e6  720b              STRB     r3,[r1,#8]
;;;899      cardinfo->SD_csd.ContentProtectAppli = (tmp & 0x01);
0001e8  f0020301          AND      r3,r2,#1
0001ec  724b              STRB     r3,[r1,#9]
;;;900    
;;;901      /*!< Byte 14 */
;;;902      tmp = (uint8_t)((CSD_Tab[3] & 0x0000FF00) >> 8);
0001ee  4b45              LDR      r3,|L17.772|
0001f0  899b              LDRH     r3,[r3,#0xc]  ; CSD_Tab
0001f2  f3c32207          UBFX     r2,r3,#8,#8
;;;903      cardinfo->SD_csd.FileFormatGrouop = (tmp & 0x80) >> 7;
0001f6  09d3              LSRS     r3,r2,#7
0001f8  728b              STRB     r3,[r1,#0xa]
;;;904      cardinfo->SD_csd.CopyFlag = (tmp & 0x40) >> 6;
0001fa  f3c21380          UBFX     r3,r2,#6,#1
0001fe  72cb              STRB     r3,[r1,#0xb]
;;;905      cardinfo->SD_csd.PermWrProtect = (tmp & 0x20) >> 5;
000200  f3c21340          UBFX     r3,r2,#5,#1
000204  730b              STRB     r3,[r1,#0xc]
;;;906      cardinfo->SD_csd.TempWrProtect = (tmp & 0x10) >> 4;
000206  f3c21300          UBFX     r3,r2,#4,#1
00020a  734b              STRB     r3,[r1,#0xd]
;;;907      cardinfo->SD_csd.FileFormat = (tmp & 0x0C) >> 2;
00020c  f3c20381          UBFX     r3,r2,#2,#2
000210  738b              STRB     r3,[r1,#0xe]
;;;908      cardinfo->SD_csd.ECC = (tmp & 0x03);
000212  f0020303          AND      r3,r2,#3
000216  73cb              STRB     r3,[r1,#0xf]
;;;909    
;;;910      /*!< Byte 15 */
;;;911      tmp = (uint8_t)(CSD_Tab[3] & 0x000000FF);
000218  4b3a              LDR      r3,|L17.772|
00021a  7b1a              LDRB     r2,[r3,#0xc]  ; CSD_Tab
;;;912      cardinfo->SD_csd.CSD_CRC = (tmp & 0xFE) >> 1;
00021c  0853              LSRS     r3,r2,#1
00021e  740b              STRB     r3,[r1,#0x10]
;;;913      cardinfo->SD_csd.Reserved4 = 1;
000220  2301              MOVS     r3,#1
000222  744b              STRB     r3,[r1,#0x11]
;;;914    
;;;915    
;;;916      /*!< Byte 0 */
;;;917      tmp = (uint8_t)((CID_Tab[0] & 0xFF000000) >> 24);
000224  4b38              LDR      r3,|L17.776|
000226  681b              LDR      r3,[r3,#0]  ; CID_Tab
000228  0e1a              LSRS     r2,r3,#24
;;;918      cardinfo->SD_cid.ManufacturerID = tmp;
00022a  74ca              STRB     r2,[r1,#0x13]
00022c  3919              SUBS     r1,r1,#0x19
;;;919    
;;;920      /*!< Byte 1 */
;;;921      tmp = (uint8_t)((CID_Tab[0] & 0x00FF0000) >> 16);
00022e  4b36              LDR      r3,|L17.776|
000230  681b              LDR      r3,[r3,#0]  ; CID_Tab
000232  f3c34207          UBFX     r2,r3,#16,#8
;;;922      cardinfo->SD_cid.OEM_AppliID = tmp << 8;
000236  0214              LSLS     r4,r2,#8
000238  85cc              STRH     r4,[r1,#0x2e]
;;;923    
;;;924      /*!< Byte 2 */
;;;925      tmp = (uint8_t)((CID_Tab[0] & 0x000000FF00) >> 8);
00023a  4b33              LDR      r3,|L17.776|
00023c  881b              LDRH     r3,[r3,#0]  ; CID_Tab
00023e  f3c32207          UBFX     r2,r3,#8,#8
;;;926      cardinfo->SD_cid.OEM_AppliID |= tmp;
000242  8dcb              LDRH     r3,[r1,#0x2e]
000244  4313              ORRS     r3,r3,r2
000246  85cb              STRH     r3,[r1,#0x2e]
;;;927    
;;;928      /*!< Byte 3 */
;;;929      tmp = (uint8_t)(CID_Tab[0] & 0x000000FF);
000248  4b2f              LDR      r3,|L17.776|
00024a  781a              LDRB     r2,[r3,#0]  ; CID_Tab
;;;930      cardinfo->SD_cid.ProdName1 = tmp << 24;
00024c  0614              LSLS     r4,r2,#24
00024e  630c              STR      r4,[r1,#0x30]
;;;931    
;;;932      /*!< Byte 4 */
;;;933      tmp = (uint8_t)((CID_Tab[1] & 0xFF000000) >> 24);
000250  685b              LDR      r3,[r3,#4]  ; CID_Tab
000252  0e1a              LSRS     r2,r3,#24
;;;934      cardinfo->SD_cid.ProdName1 |= tmp << 16;
000254  6b0b              LDR      r3,[r1,#0x30]
000256  ea434402          ORR      r4,r3,r2,LSL #16
00025a  630c              STR      r4,[r1,#0x30]
;;;935    
;;;936      /*!< Byte 5 */
;;;937      tmp = (uint8_t)((CID_Tab[1] & 0x00FF0000) >> 16);
00025c  4b2a              LDR      r3,|L17.776|
00025e  685b              LDR      r3,[r3,#4]  ; CID_Tab
000260  f3c34207          UBFX     r2,r3,#16,#8
;;;938      cardinfo->SD_cid.ProdName1 |= tmp << 8;
000264  6b0b              LDR      r3,[r1,#0x30]
000266  ea432402          ORR      r4,r3,r2,LSL #8
00026a  630c              STR      r4,[r1,#0x30]
;;;939    
;;;940      /*!< Byte 6 */
;;;941      tmp = (uint8_t)((CID_Tab[1] & 0x0000FF00) >> 8);
00026c  4b26              LDR      r3,|L17.776|
00026e  889b              LDRH     r3,[r3,#4]  ; CID_Tab
000270  f3c32207          UBFX     r2,r3,#8,#8
;;;942      cardinfo->SD_cid.ProdName1 |= tmp;
000274  6b0b              LDR      r3,[r1,#0x30]
000276  4313              ORRS     r3,r3,r2
000278  630b              STR      r3,[r1,#0x30]
;;;943    
;;;944      /*!< Byte 7 */
;;;945      tmp = (uint8_t)(CID_Tab[1] & 0x000000FF);
00027a  4b23              LDR      r3,|L17.776|
00027c  791a              LDRB     r2,[r3,#4]  ; CID_Tab
;;;946      cardinfo->SD_cid.ProdName2 = tmp;
00027e  2334              MOVS     r3,#0x34
000280  545a              STRB     r2,[r3,r1]
;;;947    
;;;948      /*!< Byte 8 */
;;;949      tmp = (uint8_t)((CID_Tab[2] & 0xFF000000) >> 24);
000282  4b21              LDR      r3,|L17.776|
000284  689b              LDR      r3,[r3,#8]  ; CID_Tab
000286  0e1a              LSRS     r2,r3,#24
;;;950      cardinfo->SD_cid.ProdRev = tmp;
000288  2335              MOVS     r3,#0x35
00028a  545a              STRB     r2,[r3,r1]
;;;951    
;;;952      /*!< Byte 9 */
;;;953      tmp = (uint8_t)((CID_Tab[2] & 0x00FF0000) >> 16);
00028c  4b1e              LDR      r3,|L17.776|
00028e  689b              LDR      r3,[r3,#8]  ; CID_Tab
000290  f3c34207          UBFX     r2,r3,#16,#8
;;;954      cardinfo->SD_cid.ProdSN = tmp << 24;
000294  0614              LSLS     r4,r2,#24
000296  638c              STR      r4,[r1,#0x38]
;;;955    
;;;956      /*!< Byte 10 */
;;;957      tmp = (uint8_t)((CID_Tab[2] & 0x0000FF00) >> 8);
000298  4b1b              LDR      r3,|L17.776|
00029a  891b              LDRH     r3,[r3,#8]  ; CID_Tab
00029c  f3c32207          UBFX     r2,r3,#8,#8
;;;958      cardinfo->SD_cid.ProdSN |= tmp << 16;
0002a0  6b8b              LDR      r3,[r1,#0x38]
0002a2  ea434402          ORR      r4,r3,r2,LSL #16
0002a6  638c              STR      r4,[r1,#0x38]
;;;959    
;;;960      /*!< Byte 11 */
;;;961      tmp = (uint8_t)(CID_Tab[2] & 0x000000FF);
0002a8  4b17              LDR      r3,|L17.776|
0002aa  7a1a              LDRB     r2,[r3,#8]  ; CID_Tab
;;;962      cardinfo->SD_cid.ProdSN |= tmp << 8;
0002ac  6b8b              LDR      r3,[r1,#0x38]
0002ae  ea432402          ORR      r4,r3,r2,LSL #8
0002b2  638c              STR      r4,[r1,#0x38]
;;;963    
;;;964      /*!< Byte 12 */
;;;965      tmp = (uint8_t)((CID_Tab[3] & 0xFF000000) >> 24);
0002b4  4b14              LDR      r3,|L17.776|
0002b6  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
0002b8  0e1a              LSRS     r2,r3,#24
;;;966      cardinfo->SD_cid.ProdSN |= tmp;
0002ba  6b8b              LDR      r3,[r1,#0x38]
0002bc  4313              ORRS     r3,r3,r2
0002be  638b              STR      r3,[r1,#0x38]
;;;967    
;;;968      /*!< Byte 13 */
;;;969      tmp = (uint8_t)((CID_Tab[3] & 0x00FF0000) >> 16);
0002c0  4b11              LDR      r3,|L17.776|
0002c2  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
0002c4  f3c34207          UBFX     r2,r3,#16,#8
;;;970      cardinfo->SD_cid.Reserved1 |= (tmp & 0xF0) >> 4;
0002c8  233c              MOVS     r3,#0x3c
0002ca  5c5b              LDRB     r3,[r3,r1]
0002cc  ea431412          ORR      r4,r3,r2,LSR #4
0002d0  233c              MOVS     r3,#0x3c
0002d2  545c              STRB     r4,[r3,r1]
;;;971      cardinfo->SD_cid.ManufactDate = (tmp & 0x0F) << 8;
0002d4  0713              LSLS     r3,r2,#28
0002d6  0d1c              LSRS     r4,r3,#20
0002d8  87cc              STRH     r4,[r1,#0x3e]
;;;972    
;;;973      /*!< Byte 14 */
;;;974      tmp = (uint8_t)((CID_Tab[3] & 0x0000FF00) >> 8);
0002da  4b0b              LDR      r3,|L17.776|
0002dc  899b              LDRH     r3,[r3,#0xc]  ; CID_Tab
0002de  f3c32207          UBFX     r2,r3,#8,#8
;;;975      cardinfo->SD_cid.ManufactDate |= tmp;
0002e2  8fcb              LDRH     r3,[r1,#0x3e]
0002e4  4313              ORRS     r3,r3,r2
0002e6  87cb              STRH     r3,[r1,#0x3e]
;;;976    
;;;977      /*!< Byte 15 */
;;;978      tmp = (uint8_t)(CID_Tab[3] & 0x000000FF);
0002e8  4b07              LDR      r3,|L17.776|
0002ea  7b1a              LDRB     r2,[r3,#0xc]  ; CID_Tab
;;;979      cardinfo->SD_cid.CID_CRC = (tmp & 0xFE) >> 1;
0002ec  0854              LSRS     r4,r2,#1
0002ee  2340              MOVS     r3,#0x40
0002f0  545c              STRB     r4,[r3,r1]
;;;980      cardinfo->SD_cid.Reserved2 = 1;
0002f2  2401              MOVS     r4,#1
0002f4  2341              MOVS     r3,#0x41
0002f6  545c              STRB     r4,[r3,r1]
;;;981    
;;;982      return(errorstatus);
;;;983    }
0002f8  bdf0              POP      {r4-r7,pc}
;;;984    
                          ENDP

0002fa  0000              DCW      0x0000
                  |L17.764|
                          DCD      CardType
                  |L17.768|
                          DCD      ||RCA||
                  |L17.772|
                          DCD      CSD_Tab
                  |L17.776|
                          DCD      CID_Tab

                          AREA ||i.SD_GetCardStatus||, CODE, READONLY, ALIGN=2

                  SD_GetCardStatus PROC
;;;994      */
;;;995    SD_Error SD_GetCardStatus(SD_CardStatus *cardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;996    {
000002  4604              MOV      r4,r0
;;;997      SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;998      uint8_t tmp = 0;
000006  2500              MOVS     r5,#0
;;;999    
;;;1000     errorstatus = SD_SendSDStatus((uint32_t *)SDSTATUS_Tab);
000008  4824              LDR      r0,|L18.156|
00000a  f7fffffe          BL       SD_SendSDStatus
00000e  4606              MOV      r6,r0
;;;1001   
;;;1002     if (errorstatus  != SD_OK)
000010  b10e              CBZ      r6,|L18.22|
;;;1003     {
;;;1004       return(errorstatus);
000012  4630              MOV      r0,r6
                  |L18.20|
;;;1005     }
;;;1006   
;;;1007     /*!< Byte 0 */
;;;1008     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0xC0) >> 6);
;;;1009     cardstatus->DAT_BUS_WIDTH = tmp;
;;;1010   
;;;1011     /*!< Byte 0 */
;;;1012     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0x20) >> 5);
;;;1013     cardstatus->SECURED_MODE = tmp;
;;;1014   
;;;1015     /*!< Byte 2 */
;;;1016     tmp = (uint8_t)((SDSTATUS_Tab[2] & 0xFF));
;;;1017     cardstatus->SD_CARD_TYPE = tmp << 8;
;;;1018   
;;;1019     /*!< Byte 3 */
;;;1020     tmp = (uint8_t)((SDSTATUS_Tab[3] & 0xFF));
;;;1021     cardstatus->SD_CARD_TYPE |= tmp;
;;;1022   
;;;1023     /*!< Byte 4 */
;;;1024     tmp = (uint8_t)(SDSTATUS_Tab[4] & 0xFF);
;;;1025     cardstatus->SIZE_OF_PROTECTED_AREA = tmp << 24;
;;;1026   
;;;1027     /*!< Byte 5 */
;;;1028     tmp = (uint8_t)(SDSTATUS_Tab[5] & 0xFF);
;;;1029     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 16;
;;;1030   
;;;1031     /*!< Byte 6 */
;;;1032     tmp = (uint8_t)(SDSTATUS_Tab[6] & 0xFF);
;;;1033     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 8;
;;;1034   
;;;1035     /*!< Byte 7 */
;;;1036     tmp = (uint8_t)(SDSTATUS_Tab[7] & 0xFF);
;;;1037     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp;
;;;1038   
;;;1039     /*!< Byte 8 */
;;;1040     tmp = (uint8_t)((SDSTATUS_Tab[8] & 0xFF));
;;;1041     cardstatus->SPEED_CLASS = tmp;
;;;1042   
;;;1043     /*!< Byte 9 */
;;;1044     tmp = (uint8_t)((SDSTATUS_Tab[9] & 0xFF));
;;;1045     cardstatus->PERFORMANCE_MOVE = tmp;
;;;1046   
;;;1047     /*!< Byte 10 */
;;;1048     tmp = (uint8_t)((SDSTATUS_Tab[10] & 0xF0) >> 4);
;;;1049     cardstatus->AU_SIZE = tmp;
;;;1050   
;;;1051     /*!< Byte 11 */
;;;1052     tmp = (uint8_t)(SDSTATUS_Tab[11] & 0xFF);
;;;1053     cardstatus->ERASE_SIZE = tmp << 8;
;;;1054   
;;;1055     /*!< Byte 12 */
;;;1056     tmp = (uint8_t)(SDSTATUS_Tab[12] & 0xFF);
;;;1057     cardstatus->ERASE_SIZE |= tmp;
;;;1058   
;;;1059     /*!< Byte 13 */
;;;1060     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0xFC) >> 2);
;;;1061     cardstatus->ERASE_TIMEOUT = tmp;
;;;1062   
;;;1063     /*!< Byte 13 */
;;;1064     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0x3));
;;;1065     cardstatus->ERASE_OFFSET = tmp;
;;;1066   
;;;1067     return(errorstatus);
;;;1068   }
000014  bd70              POP      {r4-r6,pc}
                  |L18.22|
000016  4821              LDR      r0,|L18.156|
000018  7800              LDRB     r0,[r0,#0]            ;1008  ; SDSTATUS_Tab
00001a  0985              LSRS     r5,r0,#6              ;1008
00001c  7025              STRB     r5,[r4,#0]            ;1009
00001e  481f              LDR      r0,|L18.156|
000020  7800              LDRB     r0,[r0,#0]            ;1012  ; SDSTATUS_Tab
000022  f3c01540          UBFX     r5,r0,#5,#1           ;1012
000026  7065              STRB     r5,[r4,#1]            ;1013
000028  481c              LDR      r0,|L18.156|
00002a  7885              LDRB     r5,[r0,#2]            ;1016  ; SDSTATUS_Tab
00002c  0228              LSLS     r0,r5,#8              ;1017
00002e  8060              STRH     r0,[r4,#2]            ;1017
000030  481a              LDR      r0,|L18.156|
000032  78c5              LDRB     r5,[r0,#3]            ;1020  ; SDSTATUS_Tab
000034  8860              LDRH     r0,[r4,#2]            ;1021
000036  4328              ORRS     r0,r0,r5              ;1021
000038  8060              STRH     r0,[r4,#2]            ;1021
00003a  4818              LDR      r0,|L18.156|
00003c  7905              LDRB     r5,[r0,#4]            ;1024  ; SDSTATUS_Tab
00003e  0628              LSLS     r0,r5,#24             ;1025
000040  6060              STR      r0,[r4,#4]            ;1025
000042  4816              LDR      r0,|L18.156|
000044  7945              LDRB     r5,[r0,#5]            ;1028  ; SDSTATUS_Tab
000046  6860              LDR      r0,[r4,#4]            ;1029
000048  ea404005          ORR      r0,r0,r5,LSL #16      ;1029
00004c  6060              STR      r0,[r4,#4]            ;1029
00004e  4813              LDR      r0,|L18.156|
000050  7985              LDRB     r5,[r0,#6]            ;1032  ; SDSTATUS_Tab
000052  6860              LDR      r0,[r4,#4]            ;1033
000054  ea402005          ORR      r0,r0,r5,LSL #8       ;1033
000058  6060              STR      r0,[r4,#4]            ;1033
00005a  4810              LDR      r0,|L18.156|
00005c  79c5              LDRB     r5,[r0,#7]            ;1036  ; SDSTATUS_Tab
00005e  6860              LDR      r0,[r4,#4]            ;1037
000060  4328              ORRS     r0,r0,r5              ;1037
000062  6060              STR      r0,[r4,#4]            ;1037
000064  480d              LDR      r0,|L18.156|
000066  7a05              LDRB     r5,[r0,#8]            ;1040  ; SDSTATUS_Tab
000068  7225              STRB     r5,[r4,#8]            ;1041
00006a  7a45              LDRB     r5,[r0,#9]            ;1044  ; SDSTATUS_Tab
00006c  7265              STRB     r5,[r4,#9]            ;1045
00006e  7a80              LDRB     r0,[r0,#0xa]          ;1048  ; SDSTATUS_Tab
000070  0905              LSRS     r5,r0,#4              ;1048
000072  72a5              STRB     r5,[r4,#0xa]          ;1049
000074  4809              LDR      r0,|L18.156|
000076  7ac5              LDRB     r5,[r0,#0xb]          ;1052  ; SDSTATUS_Tab
000078  0228              LSLS     r0,r5,#8              ;1053
00007a  81a0              STRH     r0,[r4,#0xc]          ;1053
00007c  4807              LDR      r0,|L18.156|
00007e  7b05              LDRB     r5,[r0,#0xc]          ;1056  ; SDSTATUS_Tab
000080  89a0              LDRH     r0,[r4,#0xc]          ;1057
000082  4328              ORRS     r0,r0,r5              ;1057
000084  81a0              STRH     r0,[r4,#0xc]          ;1057
000086  4805              LDR      r0,|L18.156|
000088  7b40              LDRB     r0,[r0,#0xd]          ;1060  ; SDSTATUS_Tab
00008a  0885              LSRS     r5,r0,#2              ;1060
00008c  73a5              STRB     r5,[r4,#0xe]          ;1061
00008e  4803              LDR      r0,|L18.156|
000090  7b40              LDRB     r0,[r0,#0xd]          ;1064  ; SDSTATUS_Tab
000092  f0000503          AND      r5,r0,#3              ;1064
000096  73e5              STRB     r5,[r4,#0xf]          ;1065
000098  4630              MOV      r0,r6                 ;1067
00009a  e7bb              B        |L18.20|
;;;1069   
                          ENDP

                  |L18.156|
                          DCD      SDSTATUS_Tab

                          AREA ||i.SD_GetState||, CODE, READONLY, ALIGN=1

                  SD_GetState PROC
;;;489      */
;;;490    SDCardState SD_GetState(void)
000000  b508              PUSH     {r3,lr}
;;;491    {
;;;492      uint32_t resp1 = 0;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;493    
;;;494      if(SD_Detect()== SD_PRESENT)
000006  f7fffffe          BL       SD_Detect
00000a  2801              CMP      r0,#1
00000c  d109              BNE      |L19.34|
;;;495      {
;;;496        if (SD_SendStatus(&resp1) != SD_OK)
00000e  4668              MOV      r0,sp
000010  f7fffffe          BL       SD_SendStatus
000014  b108              CBZ      r0,|L19.26|
;;;497        {
;;;498          return SD_CARD_ERROR;
000016  20ff              MOVS     r0,#0xff
                  |L19.24|
;;;499        }
;;;500        else
;;;501        {
;;;502          return (SDCardState)((resp1 >> 9) & 0x0F);
;;;503        }
;;;504      }
;;;505      else
;;;506      {
;;;507        return SD_CARD_ERROR;
;;;508      }
;;;509    }
000018  bd08              POP      {r3,pc}
                  |L19.26|
00001a  9800              LDR      r0,[sp,#0]            ;502
00001c  f3c02043          UBFX     r0,r0,#9,#4           ;502
000020  e7fa              B        |L19.24|
                  |L19.34|
000022  20ff              MOVS     r0,#0xff              ;507
000024  e7f8              B        |L19.24|
;;;510    
                          ENDP


                          AREA ||i.SD_GetStatus||, CODE, READONLY, ALIGN=1

                  SD_GetStatus PROC
;;;464      */
;;;465    SDTransferState SD_GetStatus(void)
000000  b510              PUSH     {r4,lr}
;;;466    {
;;;467      SDCardState cardstate =  SD_CARD_TRANSFER;
000002  2404              MOVS     r4,#4
;;;468    
;;;469      cardstate = SD_GetState();
000004  f7fffffe          BL       SD_GetState
000008  4604              MOV      r4,r0
;;;470    
;;;471      if (cardstate == SD_CARD_TRANSFER)
00000a  2c04              CMP      r4,#4
00000c  d101              BNE      |L20.18|
;;;472      {
;;;473        return(SD_TRANSFER_OK);
00000e  2000              MOVS     r0,#0
                  |L20.16|
;;;474      }
;;;475      else if(cardstate == SD_CARD_ERROR)
;;;476      {
;;;477        return (SD_TRANSFER_ERROR);
;;;478      }
;;;479      else
;;;480      {
;;;481        return(SD_TRANSFER_BUSY);
;;;482      }
;;;483    }
000010  bd10              POP      {r4,pc}
                  |L20.18|
000012  2cff              CMP      r4,#0xff              ;475
000014  d101              BNE      |L20.26|
000016  2002              MOVS     r0,#2                 ;477
000018  e7fa              B        |L20.16|
                  |L20.26|
00001a  2001              MOVS     r0,#1                 ;481
00001c  e7f8              B        |L20.16|
;;;484    
                          ENDP


                          AREA ||i.SD_GetTransferState||, CODE, READONLY, ALIGN=2

                  SD_GetTransferState PROC
;;;1714     */
;;;1715   SDTransferState SD_GetTransferState(void)
000000  4804              LDR      r0,|L21.20|
;;;1716   {
;;;1717     if (SDIO->STA & (SDIO_FLAG_TXACT | SDIO_FLAG_RXACT))
000002  6800              LDR      r0,[r0,#0]
000004  f4005040          AND      r0,r0,#0x3000
000008  b108              CBZ      r0,|L21.14|
;;;1718     {
;;;1719       return(SD_TRANSFER_BUSY);
00000a  2001              MOVS     r0,#1
                  |L21.12|
;;;1720     }
;;;1721     else
;;;1722     {
;;;1723       return(SD_TRANSFER_OK);
;;;1724     }
;;;1725   }
00000c  4770              BX       lr
                  |L21.14|
00000e  2000              MOVS     r0,#0                 ;1723
000010  e7fc              B        |L21.12|
;;;1726   
                          ENDP

000012  0000              DCW      0x0000
                  |L21.20|
                          DCD      0x40012c34

                          AREA ||i.SD_Init||, CODE, READONLY, ALIGN=2

                  SD_Init PROC
;;;400      */
;;;401    SD_Error SD_Init(void)
000000  b508              PUSH     {r3,lr}
;;;402    {
;;;403      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;404    
;;;405      /* NVIC */
;;;406      SDIO_Interrupts_Config();
000006  f7fffffe          BL       SDIO_Interrupts_Config
;;;407    
;;;408      /* SDIO Peripheral Low Level Init */
;;;409      SD_LowLevel_Init();
00000a  f7fffffe          BL       SD_LowLevel_Init
;;;410    
;;;411      SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;412    
;;;413      errorstatus = SD_PowerON();
000012  f7fffffe          BL       SD_PowerON
000016  9000              STR      r0,[sp,#0]
;;;414    
;;;415      if (errorstatus != SD_OK)
000018  f89d0000          LDRB     r0,[sp,#0]
00001c  b110              CBZ      r0,|L22.36|
;;;416      {
;;;417        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;418        return(errorstatus);
00001e  f89d0000          LDRB     r0,[sp,#0]
                  |L22.34|
;;;419      }
;;;420    
;;;421      errorstatus = SD_InitializeCards();
;;;422    
;;;423      if (errorstatus != SD_OK)
;;;424      {
;;;425        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;426        return(errorstatus);
;;;427      }
;;;428    
;;;429      /*!< Configure the SDIO peripheral */
;;;430      /*!< SDIO_CK = SDIOCLK / (SDIO_TRANSFER_CLK_DIV + 2) */
;;;431      /*!< on STM32F4xx devices, SDIOCLK is fixed to 48MHz */
;;;432      SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;433      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;434      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;435      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;436      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;437      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;438      SDIO_Init(&SDIO_InitStructure);
;;;439    
;;;440      /*----------------- Read CSD/CID MSD registers ------------------*/
;;;441      errorstatus = SD_GetCardInfo(&SDCardInfo);
;;;442    
;;;443      if (errorstatus == SD_OK)
;;;444      {
;;;445        /*----------------- Select Card --------------------------------*/
;;;446        errorstatus = SD_SelectDeselect((uint32_t) (SDCardInfo.RCA << 16));
;;;447      }
;;;448    
;;;449      if (errorstatus == SD_OK)
;;;450      {
;;;451        errorstatus = SD_EnableWideBusOperation(SDIO_BusWide_4b);
;;;452      }
;;;453    
;;;454      return(errorstatus);
;;;455    }
000022  bd08              POP      {r3,pc}
                  |L22.36|
000024  f7fffffe          BL       SD_InitializeCards
000028  9000              STR      r0,[sp,#0]            ;421
00002a  f89d0000          LDRB     r0,[sp,#0]            ;423
00002e  b110              CBZ      r0,|L22.54|
000030  f89d0000          LDRB     r0,[sp,#0]            ;426
000034  e7f5              B        |L22.34|
                  |L22.54|
000036  2000              MOVS     r0,#0                 ;432
000038  4911              LDR      r1,|L22.128|
00003a  7508              STRB     r0,[r1,#0x14]         ;432
00003c  6008              STR      r0,[r1,#0]            ;433  ; SDIO_InitStructure
00003e  6048              STR      r0,[r1,#4]            ;434  ; SDIO_InitStructure
000040  6088              STR      r0,[r1,#8]            ;435  ; SDIO_InitStructure
000042  60c8              STR      r0,[r1,#0xc]          ;436  ; SDIO_InitStructure
000044  6108              STR      r0,[r1,#0x10]         ;437  ; SDIO_InitStructure
000046  4608              MOV      r0,r1                 ;438
000048  f7fffffe          BL       SDIO_Init
00004c  480d              LDR      r0,|L22.132|
00004e  f7fffffe          BL       SD_GetCardInfo
000052  9000              STR      r0,[sp,#0]            ;441
000054  f89d0000          LDRB     r0,[sp,#0]            ;443
000058  b930              CBNZ     r0,|L22.104|
00005a  490a              LDR      r1,|L22.132|
00005c  f8b11054          LDRH     r1,[r1,#0x54]         ;446  ; SDCardInfo
000060  0408              LSLS     r0,r1,#16             ;446
000062  f7fffffe          BL       SD_SelectDeselect
000066  9000              STR      r0,[sp,#0]            ;446
                  |L22.104|
000068  f89d0000          LDRB     r0,[sp,#0]            ;449
00006c  b920              CBNZ     r0,|L22.120|
00006e  f44f6000          MOV      r0,#0x800             ;451
000072  f7fffffe          BL       SD_EnableWideBusOperation
000076  9000              STR      r0,[sp,#0]            ;451
                  |L22.120|
000078  f89d0000          LDRB     r0,[sp,#0]            ;454
00007c  e7d1              B        |L22.34|
;;;456    
                          ENDP

00007e  0000              DCW      0x0000
                  |L22.128|
                          DCD      SDIO_InitStructure
                  |L22.132|
                          DCD      SDCardInfo

                          AREA ||i.SD_InitializeCards||, CODE, READONLY, ALIGN=2

                  SD_InitializeCards PROC
;;;693      */
;;;694    SD_Error SD_InitializeCards(void)
000000  b538              PUSH     {r3-r5,lr}
;;;695    {
;;;696      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;697      uint16_t rca = 0x01;
000004  2001              MOVS     r0,#1
000006  9000              STR      r0,[sp,#0]
;;;698    
;;;699      if (SDIO_GetPowerState() == SDIO_PowerState_OFF)
000008  f7fffffe          BL       SDIO_GetPowerState
00000c  b910              CBNZ     r0,|L23.20|
;;;700      {
;;;701        errorstatus = SD_REQUEST_NOT_APPLICABLE;
00000e  2425              MOVS     r4,#0x25
;;;702        return(errorstatus);
000010  4620              MOV      r0,r4
                  |L23.18|
;;;703      }
;;;704    
;;;705      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;706      {
;;;707        /*!< Send CMD2 ALL_SEND_CID */
;;;708        SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;709        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ALL_SEND_CID;
;;;710        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;711        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;712        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;713        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;714    
;;;715        errorstatus = CmdResp2Error();
;;;716    
;;;717        if (SD_OK != errorstatus)
;;;718        {
;;;719          return(errorstatus);
;;;720        }
;;;721    
;;;722        CID_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;723        CID_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;724        CID_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;725        CID_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;726      }
;;;727      if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) ||  (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) ||  (SDIO_SECURE_DIGITAL_IO_COMBO_CARD == CardType)
;;;728          ||  (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;729      {
;;;730        /*!< Send CMD3 SET_REL_ADDR with argument 0 */
;;;731        /*!< SD Card publishes its RCA. */
;;;732        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;733        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_REL_ADDR;
;;;734        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;735        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;736        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;737        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;738    
;;;739        errorstatus = CmdResp6Error(SD_CMD_SET_REL_ADDR, &rca);
;;;740    
;;;741        if (SD_OK != errorstatus)
;;;742        {
;;;743          return(errorstatus);
;;;744        }
;;;745      }
;;;746    
;;;747      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;748      {
;;;749        RCA = rca;
;;;750    
;;;751        /*!< Send CMD9 SEND_CSD with argument as card's RCA */
;;;752        SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)(rca << 16);
;;;753        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_CSD;
;;;754        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;755        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;756        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;757        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;758    
;;;759        errorstatus = CmdResp2Error();
;;;760    
;;;761        if (SD_OK != errorstatus)
;;;762        {
;;;763          return(errorstatus);
;;;764        }
;;;765    
;;;766        CSD_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;767        CSD_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;768        CSD_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;769        CSD_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;770      }
;;;771    
;;;772      errorstatus = SD_OK; /*!< All cards get intialized */
;;;773    
;;;774      return(errorstatus);
;;;775    }
000012  bd38              POP      {r3-r5,pc}
                  |L23.20|
000014  4844              LDR      r0,|L23.296|
000016  6800              LDR      r0,[r0,#0]            ;705  ; CardType
000018  2804              CMP      r0,#4                 ;705
00001a  d028              BEQ      |L23.110|
00001c  2000              MOVS     r0,#0                 ;708
00001e  4943              LDR      r1,|L23.300|
000020  6008              STR      r0,[r1,#0]            ;708  ; SDIO_CmdInitStructure
000022  2002              MOVS     r0,#2                 ;709
000024  6048              STR      r0,[r1,#4]            ;709  ; SDIO_CmdInitStructure
000026  20c0              MOVS     r0,#0xc0              ;710
000028  6088              STR      r0,[r1,#8]            ;710  ; SDIO_CmdInitStructure
00002a  2000              MOVS     r0,#0                 ;711
00002c  60c8              STR      r0,[r1,#0xc]          ;711  ; SDIO_CmdInitStructure
00002e  f44f6080          MOV      r0,#0x400             ;712
000032  6108              STR      r0,[r1,#0x10]         ;712  ; SDIO_CmdInitStructure
000034  4608              MOV      r0,r1                 ;713
000036  f7fffffe          BL       SDIO_SendCommand
00003a  f7fffffe          BL       CmdResp2Error
00003e  4604              MOV      r4,r0                 ;715
000040  b10c              CBZ      r4,|L23.70|
000042  4620              MOV      r0,r4                 ;719
000044  e7e5              B        |L23.18|
                  |L23.70|
000046  2000              MOVS     r0,#0                 ;722
000048  f7fffffe          BL       SDIO_GetResponse
00004c  4938              LDR      r1,|L23.304|
00004e  6008              STR      r0,[r1,#0]            ;722  ; CID_Tab
000050  2004              MOVS     r0,#4                 ;723
000052  f7fffffe          BL       SDIO_GetResponse
000056  4936              LDR      r1,|L23.304|
000058  6048              STR      r0,[r1,#4]            ;723  ; CID_Tab
00005a  2008              MOVS     r0,#8                 ;724
00005c  f7fffffe          BL       SDIO_GetResponse
000060  4933              LDR      r1,|L23.304|
000062  6088              STR      r0,[r1,#8]            ;724  ; CID_Tab
000064  200c              MOVS     r0,#0xc               ;725
000066  f7fffffe          BL       SDIO_GetResponse
00006a  4931              LDR      r1,|L23.304|
00006c  60c8              STR      r0,[r1,#0xc]          ;725  ; CID_Tab
                  |L23.110|
00006e  482e              LDR      r0,|L23.296|
000070  6800              LDR      r0,[r0,#0]            ;727  ; CardType
000072  b158              CBZ      r0,|L23.140|
000074  482c              LDR      r0,|L23.296|
000076  6800              LDR      r0,[r0,#0]            ;727  ; CardType
000078  2801              CMP      r0,#1                 ;727
00007a  d007              BEQ      |L23.140|
00007c  482a              LDR      r0,|L23.296|
00007e  6800              LDR      r0,[r0,#0]            ;727  ; CardType
000080  2806              CMP      r0,#6                 ;727
000082  d003              BEQ      |L23.140|
000084  4828              LDR      r0,|L23.296|
000086  6800              LDR      r0,[r0,#0]            ;728  ; CardType
000088  2802              CMP      r0,#2                 ;728
00008a  d116              BNE      |L23.186|
                  |L23.140|
00008c  2000              MOVS     r0,#0                 ;732
00008e  4927              LDR      r1,|L23.300|
000090  6008              STR      r0,[r1,#0]            ;732  ; SDIO_CmdInitStructure
000092  2003              MOVS     r0,#3                 ;733
000094  6048              STR      r0,[r1,#4]            ;733  ; SDIO_CmdInitStructure
000096  2040              MOVS     r0,#0x40              ;734
000098  6088              STR      r0,[r1,#8]            ;734  ; SDIO_CmdInitStructure
00009a  2000              MOVS     r0,#0                 ;735
00009c  60c8              STR      r0,[r1,#0xc]          ;735  ; SDIO_CmdInitStructure
00009e  f44f6080          MOV      r0,#0x400             ;736
0000a2  6108              STR      r0,[r1,#0x10]         ;736  ; SDIO_CmdInitStructure
0000a4  4608              MOV      r0,r1                 ;737
0000a6  f7fffffe          BL       SDIO_SendCommand
0000aa  4669              MOV      r1,sp                 ;739
0000ac  2003              MOVS     r0,#3                 ;739
0000ae  f7fffffe          BL       CmdResp6Error
0000b2  4604              MOV      r4,r0                 ;739
0000b4  b10c              CBZ      r4,|L23.186|
0000b6  4620              MOV      r0,r4                 ;743
0000b8  e7ab              B        |L23.18|
                  |L23.186|
0000ba  481b              LDR      r0,|L23.296|
0000bc  6800              LDR      r0,[r0,#0]            ;747  ; CardType
0000be  2804              CMP      r0,#4                 ;747
0000c0  d02e              BEQ      |L23.288|
0000c2  f8bd0000          LDRH     r0,[sp,#0]            ;749
0000c6  491b              LDR      r1,|L23.308|
0000c8  6008              STR      r0,[r1,#0]            ;749  ; RCA
0000ca  f8bd0000          LDRH     r0,[sp,#0]            ;752
0000ce  0400              LSLS     r0,r0,#16             ;752
0000d0  4916              LDR      r1,|L23.300|
0000d2  6008              STR      r0,[r1,#0]            ;752  ; SDIO_CmdInitStructure
0000d4  2009              MOVS     r0,#9                 ;753
0000d6  6048              STR      r0,[r1,#4]            ;753  ; SDIO_CmdInitStructure
0000d8  20c0              MOVS     r0,#0xc0              ;754
0000da  6088              STR      r0,[r1,#8]            ;754  ; SDIO_CmdInitStructure
0000dc  2000              MOVS     r0,#0                 ;755
0000de  60c8              STR      r0,[r1,#0xc]          ;755  ; SDIO_CmdInitStructure
0000e0  f44f6080          MOV      r0,#0x400             ;756
0000e4  6108              STR      r0,[r1,#0x10]         ;756  ; SDIO_CmdInitStructure
0000e6  4608              MOV      r0,r1                 ;757
0000e8  f7fffffe          BL       SDIO_SendCommand
0000ec  f7fffffe          BL       CmdResp2Error
0000f0  4604              MOV      r4,r0                 ;759
0000f2  b10c              CBZ      r4,|L23.248|
0000f4  4620              MOV      r0,r4                 ;763
0000f6  e78c              B        |L23.18|
                  |L23.248|
0000f8  2000              MOVS     r0,#0                 ;766
0000fa  f7fffffe          BL       SDIO_GetResponse
0000fe  490e              LDR      r1,|L23.312|
000100  6008              STR      r0,[r1,#0]            ;766  ; CSD_Tab
000102  2004              MOVS     r0,#4                 ;767
000104  f7fffffe          BL       SDIO_GetResponse
000108  490b              LDR      r1,|L23.312|
00010a  6048              STR      r0,[r1,#4]            ;767  ; CSD_Tab
00010c  2008              MOVS     r0,#8                 ;768
00010e  f7fffffe          BL       SDIO_GetResponse
000112  4909              LDR      r1,|L23.312|
000114  6088              STR      r0,[r1,#8]            ;768  ; CSD_Tab
000116  200c              MOVS     r0,#0xc               ;769
000118  f7fffffe          BL       SDIO_GetResponse
00011c  4906              LDR      r1,|L23.312|
00011e  60c8              STR      r0,[r1,#0xc]          ;769  ; CSD_Tab
                  |L23.288|
000120  2400              MOVS     r4,#0                 ;772
000122  4620              MOV      r0,r4                 ;774
000124  e775              B        |L23.18|
;;;776    
                          ENDP

000126  0000              DCW      0x0000
                  |L23.296|
                          DCD      CardType
                  |L23.300|
                          DCD      SDIO_CmdInitStructure
                  |L23.304|
                          DCD      CID_Tab
                  |L23.308|
                          DCD      ||RCA||
                  |L23.312|
                          DCD      CSD_Tab

                          AREA ||i.SD_LowLevel_DMA_RxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_RxConfig PROC
;;;2945     */
;;;2946   void SD_LowLevel_DMA_RxConfig(uint32_t *BufferDST, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2947   {
000002  b08f              SUB      sp,sp,#0x3c
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;2948     DMA_InitTypeDef SDDMA_InitStructure;
;;;2949   
;;;2950     DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_FEIF | SD_SDIO_DMA_FLAG_DMEIF | SD_SDIO_DMA_FLAG_TEIF | SD_SDIO_DMA_FLAG_HTIF | SD_SDIO_DMA_FLAG_TCIF);
000008  f04f51fa          MOV      r1,#0x1f400000
00000c  481d              LDR      r0,|L24.132|
00000e  f7fffffe          BL       DMA_ClearFlag
;;;2951   
;;;2952     /* DMA2 Stream3  or Stream6 disable */
;;;2953     DMA_Cmd(SD_SDIO_DMA_STREAM, DISABLE);
000012  2100              MOVS     r1,#0
000014  481b              LDR      r0,|L24.132|
000016  f7fffffe          BL       DMA_Cmd
;;;2954   
;;;2955     /* DMA2 Stream3 or Stream6 Config */
;;;2956     DMA_DeInit(SD_SDIO_DMA_STREAM);
00001a  481a              LDR      r0,|L24.132|
00001c  f7fffffe          BL       DMA_DeInit
;;;2957   
;;;2958     SDDMA_InitStructure.DMA_Channel = SD_SDIO_DMA_CHANNEL;
000020  f04f6000          MOV      r0,#0x8000000
000024  9000              STR      r0,[sp,#0]
;;;2959     SDDMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000026  4818              LDR      r0,|L24.136|
000028  9001              STR      r0,[sp,#4]
;;;2960     SDDMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)BufferDST;
00002a  9402              STR      r4,[sp,#8]
;;;2961     SDDMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralToMemory;
00002c  2000              MOVS     r0,#0
00002e  9003              STR      r0,[sp,#0xc]
;;;2962     SDDMA_InitStructure.DMA_BufferSize = 0;
000030  9004              STR      r0,[sp,#0x10]
;;;2963     SDDMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000032  9005              STR      r0,[sp,#0x14]
;;;2964     SDDMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000034  f44f6080          MOV      r0,#0x400
000038  9006              STR      r0,[sp,#0x18]
;;;2965     SDDMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00003a  0080              LSLS     r0,r0,#2
00003c  9007              STR      r0,[sp,#0x1c]
;;;2966     SDDMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
00003e  0080              LSLS     r0,r0,#2
000040  9008              STR      r0,[sp,#0x20]
;;;2967     SDDMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000042  2000              MOVS     r0,#0
000044  9009              STR      r0,[sp,#0x24]
;;;2968     SDDMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
000046  f44f3040          MOV      r0,#0x30000
00004a  900a              STR      r0,[sp,#0x28]
;;;2969     SDDMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
00004c  2004              MOVS     r0,#4
00004e  900b              STR      r0,[sp,#0x2c]
;;;2970     SDDMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
000050  2003              MOVS     r0,#3
000052  900c              STR      r0,[sp,#0x30]
;;;2971     SDDMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_INC4;
000054  f44f0000          MOV      r0,#0x800000
000058  900d              STR      r0,[sp,#0x34]
;;;2972     SDDMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_INC4;
00005a  1080              ASRS     r0,r0,#2
00005c  900e              STR      r0,[sp,#0x38]
;;;2973     DMA_Init(SD_SDIO_DMA_STREAM, &SDDMA_InitStructure);
00005e  4669              MOV      r1,sp
000060  4808              LDR      r0,|L24.132|
000062  f7fffffe          BL       DMA_Init
;;;2974     DMA_ITConfig(SD_SDIO_DMA_STREAM, DMA_IT_TC, ENABLE);
000066  2201              MOVS     r2,#1
000068  2110              MOVS     r1,#0x10
00006a  4806              LDR      r0,|L24.132|
00006c  f7fffffe          BL       DMA_ITConfig
;;;2975     DMA_FlowControllerConfig(SD_SDIO_DMA_STREAM, DMA_FlowCtrl_Peripheral);
000070  2120              MOVS     r1,#0x20
000072  4804              LDR      r0,|L24.132|
000074  f7fffffe          BL       DMA_FlowControllerConfig
;;;2976   
;;;2977     /* DMA2 Stream3 or Stream6 enable */
;;;2978     DMA_Cmd(SD_SDIO_DMA_STREAM, ENABLE);
000078  2101              MOVS     r1,#1
00007a  4802              LDR      r0,|L24.132|
00007c  f7fffffe          BL       DMA_Cmd
;;;2979   }
000080  b00f              ADD      sp,sp,#0x3c
000082  bd30              POP      {r4,r5,pc}
;;;2980   
                          ENDP

                  |L24.132|
                          DCD      0x40026458
                  |L24.136|
                          DCD      0x40012c80

                          AREA ||i.SD_LowLevel_DMA_TxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_TxConfig PROC
;;;2903     */
;;;2904   void SD_LowLevel_DMA_TxConfig(uint32_t *BufferSRC, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2905   {
000002  b08f              SUB      sp,sp,#0x3c
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;2906     DMA_InitTypeDef SDDMA_InitStructure;
;;;2907   
;;;2908     DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_FEIF | SD_SDIO_DMA_FLAG_DMEIF | SD_SDIO_DMA_FLAG_TEIF | SD_SDIO_DMA_FLAG_HTIF | SD_SDIO_DMA_FLAG_TCIF);
000008  f04f51fa          MOV      r1,#0x1f400000
00000c  481e              LDR      r0,|L25.136|
00000e  f7fffffe          BL       DMA_ClearFlag
;;;2909   
;;;2910     /* DMA2 Stream3  or Stream6 disable */
;;;2911     DMA_Cmd(SD_SDIO_DMA_STREAM, DISABLE);
000012  2100              MOVS     r1,#0
000014  481c              LDR      r0,|L25.136|
000016  f7fffffe          BL       DMA_Cmd
;;;2912   
;;;2913     /* DMA2 Stream3  or Stream6 Config */
;;;2914     DMA_DeInit(SD_SDIO_DMA_STREAM);
00001a  481b              LDR      r0,|L25.136|
00001c  f7fffffe          BL       DMA_DeInit
;;;2915   
;;;2916     SDDMA_InitStructure.DMA_Channel = SD_SDIO_DMA_CHANNEL;
000020  f04f6000          MOV      r0,#0x8000000
000024  9000              STR      r0,[sp,#0]
;;;2917     SDDMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000026  4819              LDR      r0,|L25.140|
000028  9001              STR      r0,[sp,#4]
;;;2918     SDDMA_InitStructure.DMA_Memory0BaseAddr = (uint32_t)BufferSRC;
00002a  9402              STR      r4,[sp,#8]
;;;2919     SDDMA_InitStructure.DMA_DIR = DMA_DIR_MemoryToPeripheral;
00002c  2040              MOVS     r0,#0x40
00002e  9003              STR      r0,[sp,#0xc]
;;;2920     SDDMA_InitStructure.DMA_BufferSize = 0;
000030  2000              MOVS     r0,#0
000032  9004              STR      r0,[sp,#0x10]
;;;2921     SDDMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000034  9005              STR      r0,[sp,#0x14]
;;;2922     SDDMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000036  f44f6080          MOV      r0,#0x400
00003a  9006              STR      r0,[sp,#0x18]
;;;2923     SDDMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00003c  0080              LSLS     r0,r0,#2
00003e  9007              STR      r0,[sp,#0x1c]
;;;2924     SDDMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
000040  0080              LSLS     r0,r0,#2
000042  9008              STR      r0,[sp,#0x20]
;;;2925     SDDMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000044  2000              MOVS     r0,#0
000046  9009              STR      r0,[sp,#0x24]
;;;2926     SDDMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;
000048  f44f3040          MOV      r0,#0x30000
00004c  900a              STR      r0,[sp,#0x28]
;;;2927     SDDMA_InitStructure.DMA_FIFOMode = DMA_FIFOMode_Enable;
00004e  2004              MOVS     r0,#4
000050  900b              STR      r0,[sp,#0x2c]
;;;2928     SDDMA_InitStructure.DMA_FIFOThreshold = DMA_FIFOThreshold_Full;
000052  2003              MOVS     r0,#3
000054  900c              STR      r0,[sp,#0x30]
;;;2929     SDDMA_InitStructure.DMA_MemoryBurst = DMA_MemoryBurst_INC4;
000056  f44f0000          MOV      r0,#0x800000
00005a  900d              STR      r0,[sp,#0x34]
;;;2930     SDDMA_InitStructure.DMA_PeripheralBurst = DMA_PeripheralBurst_INC4;
00005c  1080              ASRS     r0,r0,#2
00005e  900e              STR      r0,[sp,#0x38]
;;;2931     DMA_Init(SD_SDIO_DMA_STREAM, &SDDMA_InitStructure);
000060  4669              MOV      r1,sp
000062  4809              LDR      r0,|L25.136|
000064  f7fffffe          BL       DMA_Init
;;;2932     DMA_ITConfig(SD_SDIO_DMA_STREAM, DMA_IT_TC, ENABLE);
000068  2201              MOVS     r2,#1
00006a  2110              MOVS     r1,#0x10
00006c  4806              LDR      r0,|L25.136|
00006e  f7fffffe          BL       DMA_ITConfig
;;;2933     DMA_FlowControllerConfig(SD_SDIO_DMA_STREAM, DMA_FlowCtrl_Peripheral);
000072  2120              MOVS     r1,#0x20
000074  4804              LDR      r0,|L25.136|
000076  f7fffffe          BL       DMA_FlowControllerConfig
;;;2934   
;;;2935     /* DMA2 Stream3  or Stream6 enable */
;;;2936     DMA_Cmd(SD_SDIO_DMA_STREAM, ENABLE);
00007a  2101              MOVS     r1,#1
00007c  4802              LDR      r0,|L25.136|
00007e  f7fffffe          BL       DMA_Cmd
;;;2937   
;;;2938   }
000082  b00f              ADD      sp,sp,#0x3c
000084  bd30              POP      {r4,r5,pc}
;;;2939   
                          ENDP

000086  0000              DCW      0x0000
                  |L25.136|
                          DCD      0x40026458
                  |L25.140|
                          DCD      0x40012c80

                          AREA ||i.SD_LowLevel_DeInit||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DeInit PROC
;;;2809     */
;;;2810   void SD_LowLevel_DeInit(void)
000000  b51c              PUSH     {r2-r4,lr}
;;;2811   {
;;;2812     GPIO_InitTypeDef  GPIO_InitStructure;
;;;2813   
;;;2814     /*!< Disable SDIO Clock */
;;;2815     SDIO_ClockCmd(DISABLE);
000002  2000              MOVS     r0,#0
000004  f7fffffe          BL       SDIO_ClockCmd
;;;2816   
;;;2817     /*!< Set Power State to OFF */
;;;2818     SDIO_SetPowerState(SDIO_PowerState_OFF);
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_SetPowerState
;;;2819   
;;;2820     /*!< DeInitializes the SDIO peripheral */
;;;2821     SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;2822   
;;;2823     /* Disable the SDIO APB2 Clock */
;;;2824     RCC_APB2PeriphClockCmd(RCC_APB2Periph_SDIO, DISABLE);
000012  2100              MOVS     r1,#0
000014  f44f6000          MOV      r0,#0x800
000018  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2825   
;;;2826     GPIO_PinAFConfig(GPIOC, GPIO_PinSource8, GPIO_AF_MCO);
00001c  2200              MOVS     r2,#0
00001e  2108              MOVS     r1,#8
000020  481a              LDR      r0,|L26.140|
000022  f7fffffe          BL       GPIO_PinAFConfig
;;;2827     GPIO_PinAFConfig(GPIOC, GPIO_PinSource9, GPIO_AF_MCO);
000026  2200              MOVS     r2,#0
000028  2109              MOVS     r1,#9
00002a  4818              LDR      r0,|L26.140|
00002c  f7fffffe          BL       GPIO_PinAFConfig
;;;2828     GPIO_PinAFConfig(GPIOC, GPIO_PinSource10, GPIO_AF_MCO);
000030  2200              MOVS     r2,#0
000032  210a              MOVS     r1,#0xa
000034  4815              LDR      r0,|L26.140|
000036  f7fffffe          BL       GPIO_PinAFConfig
;;;2829     GPIO_PinAFConfig(GPIOC, GPIO_PinSource11, GPIO_AF_MCO);
00003a  2200              MOVS     r2,#0
00003c  210b              MOVS     r1,#0xb
00003e  4813              LDR      r0,|L26.140|
000040  f7fffffe          BL       GPIO_PinAFConfig
;;;2830     GPIO_PinAFConfig(GPIOC, GPIO_PinSource12, GPIO_AF_MCO);
000044  2200              MOVS     r2,#0
000046  210c              MOVS     r1,#0xc
000048  4810              LDR      r0,|L26.140|
00004a  f7fffffe          BL       GPIO_PinAFConfig
;;;2831     GPIO_PinAFConfig(GPIOD, GPIO_PinSource2, GPIO_AF_MCO);
00004e  2200              MOVS     r2,#0
000050  2102              MOVS     r1,#2
000052  480f              LDR      r0,|L26.144|
000054  f7fffffe          BL       GPIO_PinAFConfig
;;;2832   
;;;2833     /* Configure PC.08, PC.09, PC.10, PC.11 pins: D0, D1, D2, D3 pins */
;;;2834     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11;
000058  f44f6070          MOV      r0,#0xf00
00005c  9000              STR      r0,[sp,#0]
;;;2835     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
00005e  2000              MOVS     r0,#0
000060  f88d0004          STRB     r0,[sp,#4]
;;;2836     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
000064  f88d0007          STRB     r0,[sp,#7]
;;;2837     GPIO_Init(GPIOC, &GPIO_InitStructure);
000068  4669              MOV      r1,sp
00006a  4808              LDR      r0,|L26.140|
00006c  f7fffffe          BL       GPIO_Init
;;;2838   
;;;2839     /* Configure PD.02 CMD line */
;;;2840     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000070  2004              MOVS     r0,#4
000072  9000              STR      r0,[sp,#0]
;;;2841     GPIO_Init(GPIOD, &GPIO_InitStructure);
000074  4669              MOV      r1,sp
000076  4806              LDR      r0,|L26.144|
000078  f7fffffe          BL       GPIO_Init
;;;2842   
;;;2843     /* Configure PC.12 pin: CLK pin */
;;;2844     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;
00007c  f44f5080          MOV      r0,#0x1000
000080  9000              STR      r0,[sp,#0]
;;;2845     GPIO_Init(GPIOC, &GPIO_InitStructure);
000082  4669              MOV      r1,sp
000084  4801              LDR      r0,|L26.140|
000086  f7fffffe          BL       GPIO_Init
;;;2846   }
00008a  bd1c              POP      {r2-r4,pc}
;;;2847   
                          ENDP

                  |L26.140|
                          DCD      0x40020800
                  |L26.144|
                          DCD      0x40020c00

                          AREA ||i.SD_LowLevel_Init||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_Init PROC
;;;2853     */
;;;2854   void SD_LowLevel_Init(void)
000000  b51c              PUSH     {r2-r4,lr}
;;;2855   {
;;;2856     GPIO_InitTypeDef  GPIO_InitStructure;
;;;2857   
;;;2858     /* GPIOC and GPIOD Periph clock enable */
;;;2859     RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC | RCC_AHB1Periph_GPIOD | SD_DETECT_GPIO_CLK, ENABLE);
000002  2101              MOVS     r1,#1
000004  201c              MOVS     r0,#0x1c
000006  f7fffffe          BL       RCC_AHB1PeriphClockCmd
;;;2860   
;;;2861     GPIO_PinAFConfig(GPIOC, GPIO_PinSource8, GPIO_AF_SDIO);
00000a  220c              MOVS     r2,#0xc
00000c  2108              MOVS     r1,#8
00000e  482a              LDR      r0,|L27.184|
000010  f7fffffe          BL       GPIO_PinAFConfig
;;;2862     GPIO_PinAFConfig(GPIOC, GPIO_PinSource9, GPIO_AF_SDIO);
000014  220c              MOVS     r2,#0xc
000016  2109              MOVS     r1,#9
000018  4827              LDR      r0,|L27.184|
00001a  f7fffffe          BL       GPIO_PinAFConfig
;;;2863     GPIO_PinAFConfig(GPIOC, GPIO_PinSource10, GPIO_AF_SDIO);
00001e  220c              MOVS     r2,#0xc
000020  210a              MOVS     r1,#0xa
000022  4825              LDR      r0,|L27.184|
000024  f7fffffe          BL       GPIO_PinAFConfig
;;;2864     GPIO_PinAFConfig(GPIOC, GPIO_PinSource11, GPIO_AF_SDIO);
000028  220c              MOVS     r2,#0xc
00002a  210b              MOVS     r1,#0xb
00002c  4822              LDR      r0,|L27.184|
00002e  f7fffffe          BL       GPIO_PinAFConfig
;;;2865     GPIO_PinAFConfig(GPIOC, GPIO_PinSource12, GPIO_AF_SDIO);
000032  220c              MOVS     r2,#0xc
000034  4611              MOV      r1,r2
000036  4820              LDR      r0,|L27.184|
000038  f7fffffe          BL       GPIO_PinAFConfig
;;;2866     GPIO_PinAFConfig(GPIOD, GPIO_PinSource2, GPIO_AF_SDIO);
00003c  220c              MOVS     r2,#0xc
00003e  2102              MOVS     r1,#2
000040  481e              LDR      r0,|L27.188|
000042  f7fffffe          BL       GPIO_PinAFConfig
;;;2867   
;;;2868     /* Configure PC.08, PC.09, PC.10, PC.11 pins: D0, D1, D2, D3 pins */
;;;2869     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11;
000046  f44f6070          MOV      r0,#0xf00
00004a  9000              STR      r0,[sp,#0]
;;;2870     GPIO_InitStructure.GPIO_Speed = GPIO_Speed_25MHz;
00004c  2001              MOVS     r0,#1
00004e  f88d0005          STRB     r0,[sp,#5]
;;;2871     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
000052  2002              MOVS     r0,#2
000054  f88d0004          STRB     r0,[sp,#4]
;;;2872     GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
000058  2000              MOVS     r0,#0
00005a  f88d0006          STRB     r0,[sp,#6]
;;;2873     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
00005e  2001              MOVS     r0,#1
000060  f88d0007          STRB     r0,[sp,#7]
;;;2874     GPIO_Init(GPIOC, &GPIO_InitStructure);
000064  4669              MOV      r1,sp
000066  4814              LDR      r0,|L27.184|
000068  f7fffffe          BL       GPIO_Init
;;;2875   
;;;2876     /* Configure PD.02 CMD line */
;;;2877     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
00006c  2004              MOVS     r0,#4
00006e  9000              STR      r0,[sp,#0]
;;;2878     GPIO_Init(GPIOD, &GPIO_InitStructure);
000070  4669              MOV      r1,sp
000072  4812              LDR      r0,|L27.188|
000074  f7fffffe          BL       GPIO_Init
;;;2879   
;;;2880     /* Configure PC.12 pin: CLK pin */
;;;2881     GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12;
000078  f44f5080          MOV      r0,#0x1000
00007c  9000              STR      r0,[sp,#0]
;;;2882     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;
00007e  2000              MOVS     r0,#0
000080  f88d0007          STRB     r0,[sp,#7]
;;;2883     GPIO_Init(GPIOC, &GPIO_InitStructure);
000084  4669              MOV      r1,sp
000086  480c              LDR      r0,|L27.184|
000088  f7fffffe          BL       GPIO_Init
;;;2884   
;;;2885     /*!< Configure SD_SPI_DETECT_PIN pin: SD Card detect pin */
;;;2886     GPIO_InitStructure.GPIO_Pin = SD_DETECT_PIN;
00008c  2004              MOVS     r0,#4
00008e  9000              STR      r0,[sp,#0]
;;;2887     GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
000090  2000              MOVS     r0,#0
000092  f88d0004          STRB     r0,[sp,#4]
;;;2888     GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
000096  2001              MOVS     r0,#1
000098  f88d0007          STRB     r0,[sp,#7]
;;;2889     GPIO_Init(SD_DETECT_GPIO_PORT, &GPIO_InitStructure);
00009c  4669              MOV      r1,sp
00009e  4808              LDR      r0,|L27.192|
0000a0  f7fffffe          BL       GPIO_Init
;;;2890   
;;;2891     /* Enable the SDIO APB2 Clock */
;;;2892     RCC_APB2PeriphClockCmd(RCC_APB2Periph_SDIO, ENABLE);
0000a4  2101              MOVS     r1,#1
0000a6  02c8              LSLS     r0,r1,#11
0000a8  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2893   
;;;2894     /* Enable the DMA2 Clock */
;;;2895     RCC_AHB1PeriphClockCmd(SD_SDIO_DMA_CLK, ENABLE);
0000ac  2101              MOVS     r1,#1
0000ae  0588              LSLS     r0,r1,#22
0000b0  f7fffffe          BL       RCC_AHB1PeriphClockCmd
;;;2896   }
0000b4  bd1c              POP      {r2-r4,pc}
;;;2897   
                          ENDP

0000b6  0000              DCW      0x0000
                  |L27.184|
                          DCD      0x40020800
                  |L27.188|
                          DCD      0x40020c00
                  |L27.192|
                          DCD      0x40021000

                          AREA ||i.SD_PowerOFF||, CODE, READONLY, ALIGN=1

                  SD_PowerOFF PROC
;;;677      */
;;;678    SD_Error SD_PowerOFF(void)
000000  b510              PUSH     {r4,lr}
;;;679    {
;;;680      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;681    
;;;682      /*!< Set Power State to OFF */
;;;683      SDIO_SetPowerState(SDIO_PowerState_OFF);
000004  2000              MOVS     r0,#0
000006  f7fffffe          BL       SDIO_SetPowerState
;;;684    
;;;685      return(errorstatus);
00000a  4620              MOV      r0,r4
;;;686    }
00000c  bd10              POP      {r4,pc}
;;;687    
                          ENDP


                          AREA ||i.SD_PowerON||, CODE, READONLY, ALIGN=2

                  SD_PowerON PROC
;;;533      */
;;;534    SD_Error SD_PowerON(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;535    {
;;;536      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;537      uint32_t response = 0, count = 0, validvoltage = 0;
000006  2500              MOVS     r5,#0
000008  2400              MOVS     r4,#0
00000a  2600              MOVS     r6,#0
;;;538      uint32_t SDType = SD_STD_CAPACITY;
00000c  2700              MOVS     r7,#0
;;;539    
;;;540      /*!< Power ON Sequence -----------------------------------------------------*/
;;;541      /*!< Configure the SDIO peripheral */
;;;542      /*!< SDIO_CK = SDIOCLK / (SDIO_INIT_CLK_DIV + 2) */
;;;543      /*!< on STM32F4xx devices, SDIOCLK is fixed to 48MHz */
;;;544      /*!< SDIO_CK for initialization should not exceed 400 KHz */
;;;545      SDIO_InitStructure.SDIO_ClockDiv = SDIO_INIT_CLK_DIV;
00000e  2076              MOVS     r0,#0x76
000010  495f              LDR      r1,|L29.400|
000012  7508              STRB     r0,[r1,#0x14]
;;;546      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
000014  2000              MOVS     r0,#0
000016  6008              STR      r0,[r1,#0]  ; SDIO_InitStructure
;;;547      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
000018  6048              STR      r0,[r1,#4]  ; SDIO_InitStructure
;;;548      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
00001a  6088              STR      r0,[r1,#8]  ; SDIO_InitStructure
;;;549      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
00001c  60c8              STR      r0,[r1,#0xc]  ; SDIO_InitStructure
;;;550      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
00001e  6108              STR      r0,[r1,#0x10]  ; SDIO_InitStructure
;;;551      SDIO_Init(&SDIO_InitStructure);
000020  4608              MOV      r0,r1
000022  f7fffffe          BL       SDIO_Init
;;;552    
;;;553      /*!< Set Power State to ON */
;;;554      SDIO_SetPowerState(SDIO_PowerState_ON);
000026  2003              MOVS     r0,#3
000028  f7fffffe          BL       SDIO_SetPowerState
;;;555    
;;;556      /*!< Enable SDIO Clock */
;;;557      SDIO_ClockCmd(ENABLE);
00002c  2001              MOVS     r0,#1
00002e  f7fffffe          BL       SDIO_ClockCmd
;;;558    
;;;559      /*!< CMD0: GO_IDLE_STATE ---------------------------------------------------*/
;;;560      /*!< No CMD response required */
;;;561      SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000032  2000              MOVS     r0,#0
000034  4957              LDR      r1,|L29.404|
000036  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;562      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_GO_IDLE_STATE;
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;563      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_No;
00003a  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;564      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003c  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;565      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003e  f44f6080          MOV      r0,#0x400
000042  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;566      SDIO_SendCommand(&SDIO_CmdInitStructure);
000044  4608              MOV      r0,r1
000046  f7fffffe          BL       SDIO_SendCommand
;;;567    
;;;568      errorstatus = CmdError();
00004a  f7fffffe          BL       CmdError
00004e  9000              STR      r0,[sp,#0]
;;;569    
;;;570      if (errorstatus != SD_OK)
000050  f89d0000          LDRB     r0,[sp,#0]
000054  b110              CBZ      r0,|L29.92|
;;;571      {
;;;572        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;573        return(errorstatus);
000056  f89d0000          LDRB     r0,[sp,#0]
                  |L29.90|
;;;574      }
;;;575    
;;;576      /*!< CMD8: SEND_IF_COND ----------------------------------------------------*/
;;;577      /*!< Send CMD8 to verify SD card interface operating condition */
;;;578      /*!< Argument: - [31:12]: Reserved (shall be set to '0')
;;;579                   - [11:8]: Supply Voltage (VHS) 0x1 (Range: 2.7-3.6 V)
;;;580                   - [7:0]: Check Pattern (recommended 0xAA) */
;;;581      /*!< CMD Response: R7 */
;;;582      SDIO_CmdInitStructure.SDIO_Argument = SD_CHECK_PATTERN;
;;;583      SDIO_CmdInitStructure.SDIO_CmdIndex = SDIO_SEND_IF_COND;
;;;584      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;585      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;586      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;587      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;588    
;;;589      errorstatus = CmdResp7Error();
;;;590    
;;;591      if (errorstatus == SD_OK)
;;;592      {
;;;593        CardType = SDIO_STD_CAPACITY_SD_CARD_V2_0; /*!< SD Card 2.0 */
;;;594        SDType = SD_HIGH_CAPACITY;
;;;595      }
;;;596      else
;;;597      {
;;;598        /*!< CMD55 */
;;;599        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;600        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;601        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;602        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;603        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;604        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;605        errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;606      }
;;;607      /*!< CMD55 */
;;;608      SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;609      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;610      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;611      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;612      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;613      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;614      errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;615    
;;;616      /*!< If errorstatus is Command TimeOut, it is a MMC card */
;;;617      /*!< If errorstatus is SD_OK it is a SD card: SD card 2.0 (voltage range mismatch)
;;;618         or SD card 1.x */
;;;619      if (errorstatus == SD_OK)
;;;620      {
;;;621        /*!< SD CARD */
;;;622        /*!< Send ACMD41 SD_APP_OP_COND with Argument 0x80100000 */
;;;623        while ((!validvoltage) && (count < SD_MAX_VOLT_TRIAL))
;;;624        {
;;;625    
;;;626          /*!< SEND CMD55 APP_CMD with RCA as 0 */
;;;627          SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;628          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;629          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;630          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;631          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;632          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;633    
;;;634          errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;635    
;;;636          if (errorstatus != SD_OK)
;;;637          {
;;;638            return(errorstatus);
;;;639          }
;;;640          SDIO_CmdInitStructure.SDIO_Argument = SD_VOLTAGE_WINDOW_SD | SDType;
;;;641          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_OP_COND;
;;;642          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;643          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;644          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;645          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;646    
;;;647          errorstatus = CmdResp3Error();
;;;648          if (errorstatus != SD_OK)
;;;649          {
;;;650            return(errorstatus);
;;;651          }
;;;652    
;;;653          response = SDIO_GetResponse(SDIO_RESP1);
;;;654          validvoltage = (((response >> 31) == 1) ? 1 : 0);
;;;655          count++;
;;;656        }
;;;657        if (count >= SD_MAX_VOLT_TRIAL)
;;;658        {
;;;659          errorstatus = SD_INVALID_VOLTRANGE;
;;;660          return(errorstatus);
;;;661        }
;;;662    
;;;663        if (response &= SD_HIGH_CAPACITY)
;;;664        {
;;;665          CardType = SDIO_HIGH_CAPACITY_SD_CARD;
;;;666        }
;;;667    
;;;668      }/*!< else MMC Card */
;;;669    
;;;670      return(errorstatus);
;;;671    }
00005a  bdf8              POP      {r3-r7,pc}
                  |L29.92|
00005c  f44f70d5          MOV      r0,#0x1aa             ;582
000060  494c              LDR      r1,|L29.404|
000062  6008              STR      r0,[r1,#0]            ;582  ; SDIO_CmdInitStructure
000064  2008              MOVS     r0,#8                 ;583
000066  6048              STR      r0,[r1,#4]            ;583  ; SDIO_CmdInitStructure
000068  2040              MOVS     r0,#0x40              ;584
00006a  6088              STR      r0,[r1,#8]            ;584  ; SDIO_CmdInitStructure
00006c  2000              MOVS     r0,#0                 ;585
00006e  60c8              STR      r0,[r1,#0xc]          ;585  ; SDIO_CmdInitStructure
000070  f44f6080          MOV      r0,#0x400             ;586
000074  6108              STR      r0,[r1,#0x10]         ;586  ; SDIO_CmdInitStructure
000076  4608              MOV      r0,r1                 ;587
000078  f7fffffe          BL       SDIO_SendCommand
00007c  f7fffffe          BL       CmdResp7Error
000080  9000              STR      r0,[sp,#0]            ;589
000082  f89d0000          LDRB     r0,[sp,#0]            ;591
000086  b920              CBNZ     r0,|L29.146|
000088  2001              MOVS     r0,#1                 ;593
00008a  4943              LDR      r1,|L29.408|
00008c  6008              STR      r0,[r1,#0]            ;593  ; CardType
00008e  0787              LSLS     r7,r0,#30             ;594
000090  e012              B        |L29.184|
                  |L29.146|
000092  2000              MOVS     r0,#0                 ;599
000094  493f              LDR      r1,|L29.404|
000096  6008              STR      r0,[r1,#0]            ;599  ; SDIO_CmdInitStructure
000098  2037              MOVS     r0,#0x37              ;600
00009a  6048              STR      r0,[r1,#4]            ;600  ; SDIO_CmdInitStructure
00009c  2040              MOVS     r0,#0x40              ;601
00009e  6088              STR      r0,[r1,#8]            ;601  ; SDIO_CmdInitStructure
0000a0  2000              MOVS     r0,#0                 ;602
0000a2  60c8              STR      r0,[r1,#0xc]          ;602  ; SDIO_CmdInitStructure
0000a4  f44f6080          MOV      r0,#0x400             ;603
0000a8  6108              STR      r0,[r1,#0x10]         ;603  ; SDIO_CmdInitStructure
0000aa  4608              MOV      r0,r1                 ;604
0000ac  f7fffffe          BL       SDIO_SendCommand
0000b0  2037              MOVS     r0,#0x37              ;605
0000b2  f7fffffe          BL       CmdResp1Error
0000b6  9000              STR      r0,[sp,#0]            ;605
                  |L29.184|
0000b8  2000              MOVS     r0,#0                 ;608
0000ba  4936              LDR      r1,|L29.404|
0000bc  6008              STR      r0,[r1,#0]            ;608  ; SDIO_CmdInitStructure
0000be  2037              MOVS     r0,#0x37              ;609
0000c0  6048              STR      r0,[r1,#4]            ;609  ; SDIO_CmdInitStructure
0000c2  2040              MOVS     r0,#0x40              ;610
0000c4  6088              STR      r0,[r1,#8]            ;610  ; SDIO_CmdInitStructure
0000c6  2000              MOVS     r0,#0                 ;611
0000c8  60c8              STR      r0,[r1,#0xc]          ;611  ; SDIO_CmdInitStructure
0000ca  f44f6080          MOV      r0,#0x400             ;612
0000ce  6108              STR      r0,[r1,#0x10]         ;612  ; SDIO_CmdInitStructure
0000d0  4608              MOV      r0,r1                 ;613
0000d2  f7fffffe          BL       SDIO_SendCommand
0000d6  2037              MOVS     r0,#0x37              ;614
0000d8  f7fffffe          BL       CmdResp1Error
0000dc  9000              STR      r0,[sp,#0]            ;614
0000de  f89d0000          LDRB     r0,[sp,#0]            ;619
0000e2  2800              CMP      r0,#0                 ;619
0000e4  d151              BNE      |L29.394|
0000e6  e03b              B        |L29.352|
                  |L29.232|
0000e8  2000              MOVS     r0,#0                 ;627
0000ea  492a              LDR      r1,|L29.404|
0000ec  6008              STR      r0,[r1,#0]            ;627  ; SDIO_CmdInitStructure
0000ee  2037              MOVS     r0,#0x37              ;628
0000f0  6048              STR      r0,[r1,#4]            ;628  ; SDIO_CmdInitStructure
0000f2  2040              MOVS     r0,#0x40              ;629
0000f4  6088              STR      r0,[r1,#8]            ;629  ; SDIO_CmdInitStructure
0000f6  2000              MOVS     r0,#0                 ;630
0000f8  60c8              STR      r0,[r1,#0xc]          ;630  ; SDIO_CmdInitStructure
0000fa  f44f6080          MOV      r0,#0x400             ;631
0000fe  6108              STR      r0,[r1,#0x10]         ;631  ; SDIO_CmdInitStructure
000100  4608              MOV      r0,r1                 ;632
000102  f7fffffe          BL       SDIO_SendCommand
000106  2037              MOVS     r0,#0x37              ;634
000108  f7fffffe          BL       CmdResp1Error
00010c  9000              STR      r0,[sp,#0]            ;634
00010e  f89d0000          LDRB     r0,[sp,#0]            ;636
000112  b110              CBZ      r0,|L29.282|
000114  f89d0000          LDRB     r0,[sp,#0]            ;638
000118  e79f              B        |L29.90|
                  |L29.282|
00011a  4820              LDR      r0,|L29.412|
00011c  4338              ORRS     r0,r0,r7              ;640
00011e  491d              LDR      r1,|L29.404|
000120  6008              STR      r0,[r1,#0]            ;640  ; SDIO_CmdInitStructure
000122  2029              MOVS     r0,#0x29              ;641
000124  6048              STR      r0,[r1,#4]            ;641  ; SDIO_CmdInitStructure
000126  2040              MOVS     r0,#0x40              ;642
000128  6088              STR      r0,[r1,#8]            ;642  ; SDIO_CmdInitStructure
00012a  2000              MOVS     r0,#0                 ;643
00012c  60c8              STR      r0,[r1,#0xc]          ;643  ; SDIO_CmdInitStructure
00012e  f44f6080          MOV      r0,#0x400             ;644
000132  6108              STR      r0,[r1,#0x10]         ;644  ; SDIO_CmdInitStructure
000134  4608              MOV      r0,r1                 ;645
000136  f7fffffe          BL       SDIO_SendCommand
00013a  f7fffffe          BL       CmdResp3Error
00013e  9000              STR      r0,[sp,#0]            ;647
000140  f89d0000          LDRB     r0,[sp,#0]            ;648
000144  b110              CBZ      r0,|L29.332|
000146  f89d0000          LDRB     r0,[sp,#0]            ;650
00014a  e786              B        |L29.90|
                  |L29.332|
00014c  2000              MOVS     r0,#0                 ;653
00014e  f7fffffe          BL       SDIO_GetResponse
000152  4605              MOV      r5,r0                 ;653
000154  2001              MOVS     r0,#1                 ;654
000156  ea8070d5          EOR      r0,r0,r5,LSR #31      ;654
00015a  f0800601          EOR      r6,r0,#1              ;654
00015e  1c64              ADDS     r4,r4,#1              ;655
                  |L29.352|
000160  b91e              CBNZ     r6,|L29.362|
000162  f64f70ff          MOV      r0,#0xffff            ;623
000166  4284              CMP      r4,r0                 ;623
000168  d3be              BCC      |L29.232|
                  |L29.362|
00016a  f64f70ff          MOV      r0,#0xffff            ;657
00016e  4284              CMP      r4,r0                 ;657
000170  d304              BCC      |L29.380|
000172  201b              MOVS     r0,#0x1b              ;659
000174  9000              STR      r0,[sp,#0]            ;659
000176  f89d0000          LDRB     r0,[sp,#0]            ;660
00017a  e76e              B        |L29.90|
                  |L29.380|
00017c  f0054080          AND      r0,r5,#0x40000000     ;663
000180  0005              MOVS     r5,r0                 ;663
000182  d002              BEQ      |L29.394|
000184  2002              MOVS     r0,#2                 ;665
000186  4904              LDR      r1,|L29.408|
000188  6008              STR      r0,[r1,#0]            ;665  ; CardType
                  |L29.394|
00018a  f89d0000          LDRB     r0,[sp,#0]            ;670
00018e  e764              B        |L29.90|
;;;672    
                          ENDP

                  |L29.400|
                          DCD      SDIO_InitStructure
                  |L29.404|
                          DCD      SDIO_CmdInitStructure
                  |L29.408|
                          DCD      CardType
                  |L29.412|
                          DCD      0x80100000

                          AREA ||i.SD_ProcessDMAIRQ||, CODE, READONLY, ALIGN=2

                  SD_ProcessDMAIRQ PROC
;;;2047     */
;;;2048   void SD_ProcessDMAIRQ(void)
000000  b510              PUSH     {r4,lr}
;;;2049   {
;;;2050     if(DMA2->LISR & SD_SDIO_DMA_FLAG_TCIF)
000002  4807              LDR      r0,|L30.32|
000004  6800              LDR      r0,[r0,#0]
000006  f00050c0          AND      r0,r0,#0x18000000
00000a  b140              CBZ      r0,|L30.30|
;;;2051     {
;;;2052       DMAEndOfTransfer = 0x01;
00000c  2001              MOVS     r0,#1
00000e  4905              LDR      r1,|L30.36|
000010  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;2053       DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_TCIF|SD_SDIO_DMA_FLAG_FEIF);
000012  f04f51c2          MOV      r1,#0x18400000
000016  4802              LDR      r0,|L30.32|
000018  3058              ADDS     r0,r0,#0x58
00001a  f7fffffe          BL       DMA_ClearFlag
                  |L30.30|
;;;2054     }
;;;2055   }
00001e  bd10              POP      {r4,pc}
;;;2056   
                          ENDP

                  |L30.32|
                          DCD      0x40026400
                  |L30.36|
                          DCD      DMAEndOfTransfer

                          AREA ||i.SD_ProcessIRQSrc||, CODE, READONLY, ALIGN=2

                  SD_ProcessIRQSrc PROC
;;;2002     */
;;;2003   SD_Error SD_ProcessIRQSrc(void)
000000  b510              PUSH     {r4,lr}
;;;2004   {
;;;2005     if (SDIO_GetITStatus(SDIO_IT_DATAEND) != RESET)
000002  f44f7080          MOV      r0,#0x100
000006  f7fffffe          BL       SDIO_GetITStatus
00000a  b150              CBZ      r0,|L31.34|
;;;2006     {
;;;2007       TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  4925              LDR      r1,|L31.164|
000010  7008              STRB     r0,[r1,#0]
;;;2008       SDIO_ClearITPendingBit(SDIO_IT_DATAEND);
000012  f44f7080          MOV      r0,#0x100
000016  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2009       TransferEnd = 1;
00001a  2001              MOVS     r0,#1
00001c  4922              LDR      r1,|L31.168|
00001e  6008              STR      r0,[r1,#0]  ; TransferEnd
000020  e037              B        |L31.146|
                  |L31.34|
;;;2010     }
;;;2011     else if (SDIO_GetITStatus(SDIO_IT_DCRCFAIL) != RESET)
000022  2002              MOVS     r0,#2
000024  f7fffffe          BL       SDIO_GetITStatus
000028  b130              CBZ      r0,|L31.56|
;;;2012     {
;;;2013       SDIO_ClearITPendingBit(SDIO_IT_DCRCFAIL);
00002a  2002              MOVS     r0,#2
00002c  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2014       TransferError = SD_DATA_CRC_FAIL;
000030  2002              MOVS     r0,#2
000032  491c              LDR      r1,|L31.164|
000034  7008              STRB     r0,[r1,#0]
000036  e02c              B        |L31.146|
                  |L31.56|
;;;2015     }
;;;2016     else if (SDIO_GetITStatus(SDIO_IT_DTIMEOUT) != RESET)
000038  2008              MOVS     r0,#8
00003a  f7fffffe          BL       SDIO_GetITStatus
00003e  b130              CBZ      r0,|L31.78|
;;;2017     {
;;;2018       SDIO_ClearITPendingBit(SDIO_IT_DTIMEOUT);
000040  2008              MOVS     r0,#8
000042  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2019       TransferError = SD_DATA_TIMEOUT;
000046  2004              MOVS     r0,#4
000048  4916              LDR      r1,|L31.164|
00004a  7008              STRB     r0,[r1,#0]
00004c  e021              B        |L31.146|
                  |L31.78|
;;;2020     }
;;;2021     else if (SDIO_GetITStatus(SDIO_IT_RXOVERR) != RESET)
00004e  2020              MOVS     r0,#0x20
000050  f7fffffe          BL       SDIO_GetITStatus
000054  b130              CBZ      r0,|L31.100|
;;;2022     {
;;;2023       SDIO_ClearITPendingBit(SDIO_IT_RXOVERR);
000056  2020              MOVS     r0,#0x20
000058  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2024       TransferError = SD_RX_OVERRUN;
00005c  2006              MOVS     r0,#6
00005e  4911              LDR      r1,|L31.164|
000060  7008              STRB     r0,[r1,#0]
000062  e016              B        |L31.146|
                  |L31.100|
;;;2025     }
;;;2026     else if (SDIO_GetITStatus(SDIO_IT_TXUNDERR) != RESET)
000064  2010              MOVS     r0,#0x10
000066  f7fffffe          BL       SDIO_GetITStatus
00006a  b130              CBZ      r0,|L31.122|
;;;2027     {
;;;2028       SDIO_ClearITPendingBit(SDIO_IT_TXUNDERR);
00006c  2010              MOVS     r0,#0x10
00006e  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2029       TransferError = SD_TX_UNDERRUN;
000072  2005              MOVS     r0,#5
000074  490b              LDR      r1,|L31.164|
000076  7008              STRB     r0,[r1,#0]
000078  e00b              B        |L31.146|
                  |L31.122|
;;;2030     }
;;;2031     else if (SDIO_GetITStatus(SDIO_IT_STBITERR) != RESET)
00007a  f44f7000          MOV      r0,#0x200
00007e  f7fffffe          BL       SDIO_GetITStatus
000082  b130              CBZ      r0,|L31.146|
;;;2032     {
;;;2033       SDIO_ClearITPendingBit(SDIO_IT_STBITERR);
000084  f44f7000          MOV      r0,#0x200
000088  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2034       TransferError = SD_START_BIT_ERR;
00008c  2007              MOVS     r0,#7
00008e  4905              LDR      r1,|L31.164|
000090  7008              STRB     r0,[r1,#0]
                  |L31.146|
;;;2035     }
;;;2036   
;;;2037     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND |
000092  2100              MOVS     r1,#0
000094  f24c303a          MOV      r0,#0xc33a
000098  f7fffffe          BL       SDIO_ITConfig
;;;2038                   SDIO_IT_TXFIFOHE | SDIO_IT_RXFIFOHF | SDIO_IT_TXUNDERR |
;;;2039                   SDIO_IT_RXOVERR | SDIO_IT_STBITERR, DISABLE);
;;;2040     return(TransferError);
00009c  4801              LDR      r0,|L31.164|
00009e  7800              LDRB     r0,[r0,#0]  ; TransferError
;;;2041   }
0000a0  bd10              POP      {r4,pc}
;;;2042   
                          ENDP

0000a2  0000              DCW      0x0000
                  |L31.164|
                          DCD      TransferError
                  |L31.168|
                          DCD      TransferEnd

                          AREA ||i.SD_ReadBlock||, CODE, READONLY, ALIGN=2

                  SD_ReadBlock PROC
;;;1169     */
;;;1170   SD_Error SD_ReadBlock(uint8_t *readbuff, uint32_t ReadAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1171   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
;;;1172     SD_Error errorstatus = SD_OK;
00000a  2600              MOVS     r6,#0
;;;1173   #if defined (SD_POLLING_MODE)
;;;1174     uint32_t count = 0, *tempbuff = (uint32_t *)readbuff;
;;;1175   #endif
;;;1176   
;;;1177     TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  492d              LDR      r1,|L32.196|
000010  7008              STRB     r0,[r1,#0]
;;;1178     TransferEnd = 0;
000012  492d              LDR      r1,|L32.200|
000014  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1179     StopCondition = 0;
000016  492d              LDR      r1,|L32.204|
000018  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1180   
;;;1181     SDIO->DCTRL = 0x0;
00001a  492d              LDR      r1,|L32.208|
00001c  6008              STR      r0,[r1,#0]
;;;1182   
;;;1183   
;;;1184     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00001e  482d              LDR      r0,|L32.212|
000020  6800              LDR      r0,[r0,#0]  ; CardType
000022  2802              CMP      r0,#2
000024  d101              BNE      |L32.42|
;;;1185     {
;;;1186       BlockSize = 512;
000026  0204              LSLS     r4,r0,#8
;;;1187       ReadAddr /= 512;
000028  0a6d              LSRS     r5,r5,#9
                  |L32.42|
;;;1188     }
;;;1189   
;;;1190     /* Set Block Size for Card */
;;;1191     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00002a  482b              LDR      r0,|L32.216|
00002c  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1192     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00002e  2010              MOVS     r0,#0x10
000030  4929              LDR      r1,|L32.216|
000032  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1193     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000034  2040              MOVS     r0,#0x40
000036  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1194     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000038  2000              MOVS     r0,#0
00003a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1195     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003c  f44f6080          MOV      r0,#0x400
000040  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1196     SDIO_SendCommand(&SDIO_CmdInitStructure);
000042  4608              MOV      r0,r1
000044  f7fffffe          BL       SDIO_SendCommand
;;;1197   
;;;1198     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000048  2010              MOVS     r0,#0x10
00004a  f7fffffe          BL       CmdResp1Error
00004e  4606              MOV      r6,r0
;;;1199   
;;;1200     if (SD_OK != errorstatus)
000050  b116              CBZ      r6,|L32.88|
;;;1201     {
;;;1202       return(errorstatus);
000052  4630              MOV      r0,r6
                  |L32.84|
;;;1203     }
;;;1204   
;;;1205     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1206     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1207     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1208     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1209     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1210     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1211     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1212   
;;;1213     /*!< Send CMD17 READ_SINGLE_BLOCK */
;;;1214     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1215     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_SINGLE_BLOCK;
;;;1216     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1217     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1218     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1219     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1220   
;;;1221     errorstatus = CmdResp1Error(SD_CMD_READ_SINGLE_BLOCK);
;;;1222   
;;;1223     if (errorstatus != SD_OK)
;;;1224     {
;;;1225       return(errorstatus);
;;;1226     }
;;;1227   
;;;1228   #if defined (SD_POLLING_MODE)
;;;1229     /*!< In case of single block transfer, no need of stop transfer at all.*/
;;;1230     /*!< Polling mode */
;;;1231     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1232     {
;;;1233       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1234       {
;;;1235         for (count = 0; count < 8; count++)
;;;1236         {
;;;1237           *(tempbuff + count) = SDIO_ReadData();
;;;1238         }
;;;1239         tempbuff += 8;
;;;1240       }
;;;1241     }
;;;1242   
;;;1243     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1244     {
;;;1245       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1246       errorstatus = SD_DATA_TIMEOUT;
;;;1247       return(errorstatus);
;;;1248     }
;;;1249     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1250     {
;;;1251       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1252       errorstatus = SD_DATA_CRC_FAIL;
;;;1253       return(errorstatus);
;;;1254     }
;;;1255     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1256     {
;;;1257       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1258       errorstatus = SD_RX_OVERRUN;
;;;1259       return(errorstatus);
;;;1260     }
;;;1261     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1262     {
;;;1263       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1264       errorstatus = SD_START_BIT_ERR;
;;;1265       return(errorstatus);
;;;1266     }
;;;1267     count = SD_DATATIMEOUT;
;;;1268     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1269     {
;;;1270       *tempbuff = SDIO_ReadData();
;;;1271       tempbuff++;
;;;1272       count--;
;;;1273     }
;;;1274   
;;;1275     /*!< Clear all the static flags */
;;;1276     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1277   
;;;1278   #elif defined (SD_DMA_MODE)
;;;1279       SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1280       SDIO_DMACmd(ENABLE);
;;;1281       SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, BlockSize);
;;;1282   #endif
;;;1283   
;;;1284     return(errorstatus);
;;;1285   }
000054  e8bd81f0          POP      {r4-r8,pc}
                  |L32.88|
000058  f04f30ff          MOV      r0,#0xffffffff        ;1205
00005c  491f              LDR      r1,|L32.220|
00005e  6008              STR      r0,[r1,#0]            ;1205  ; SDIO_DataInitStructure
000060  4608              MOV      r0,r1                 ;1206
000062  6044              STR      r4,[r0,#4]            ;1206  ; SDIO_DataInitStructure
000064  2090              MOVS     r0,#0x90              ;1207
000066  6088              STR      r0,[r1,#8]            ;1207  ; SDIO_DataInitStructure
000068  2002              MOVS     r0,#2                 ;1208
00006a  60c8              STR      r0,[r1,#0xc]          ;1208  ; SDIO_DataInitStructure
00006c  2000              MOVS     r0,#0                 ;1209
00006e  6108              STR      r0,[r1,#0x10]         ;1209  ; SDIO_DataInitStructure
000070  2001              MOVS     r0,#1                 ;1210
000072  6148              STR      r0,[r1,#0x14]         ;1210  ; SDIO_DataInitStructure
000074  4608              MOV      r0,r1                 ;1211
000076  f7fffffe          BL       SDIO_DataConfig
00007a  4817              LDR      r0,|L32.216|
00007c  6005              STR      r5,[r0,#0]            ;1214  ; SDIO_CmdInitStructure
00007e  2011              MOVS     r0,#0x11              ;1215
000080  4915              LDR      r1,|L32.216|
000082  6048              STR      r0,[r1,#4]            ;1215  ; SDIO_CmdInitStructure
000084  2040              MOVS     r0,#0x40              ;1216
000086  6088              STR      r0,[r1,#8]            ;1216  ; SDIO_CmdInitStructure
000088  2000              MOVS     r0,#0                 ;1217
00008a  60c8              STR      r0,[r1,#0xc]          ;1217  ; SDIO_CmdInitStructure
00008c  f44f6080          MOV      r0,#0x400             ;1218
000090  6108              STR      r0,[r1,#0x10]         ;1218  ; SDIO_CmdInitStructure
000092  4608              MOV      r0,r1                 ;1219
000094  f7fffffe          BL       SDIO_SendCommand
000098  2011              MOVS     r0,#0x11              ;1221
00009a  f7fffffe          BL       CmdResp1Error
00009e  4606              MOV      r6,r0                 ;1221
0000a0  b10e              CBZ      r6,|L32.166|
0000a2  4630              MOV      r0,r6                 ;1225
0000a4  e7d6              B        |L32.84|
                  |L32.166|
0000a6  2101              MOVS     r1,#1                 ;1279
0000a8  f240302a          MOV      r0,#0x32a             ;1279
0000ac  f7fffffe          BL       SDIO_ITConfig
0000b0  2001              MOVS     r0,#1                 ;1280
0000b2  f7fffffe          BL       SDIO_DMACmd
0000b6  4621              MOV      r1,r4                 ;1281
0000b8  4638              MOV      r0,r7                 ;1281
0000ba  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000be  4630              MOV      r0,r6                 ;1284
0000c0  e7c8              B        |L32.84|
;;;1286   
                          ENDP

0000c2  0000              DCW      0x0000
                  |L32.196|
                          DCD      TransferError
                  |L32.200|
                          DCD      TransferEnd
                  |L32.204|
                          DCD      StopCondition
                  |L32.208|
                          DCD      0x40012c2c
                  |L32.212|
                          DCD      CardType
                  |L32.216|
                          DCD      SDIO_CmdInitStructure
                  |L32.220|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_ReadMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_ReadMultiBlocks PROC
;;;1301     */
;;;1302   SD_Error SD_ReadMultiBlocks(uint8_t *readbuff, uint32_t ReadAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1303   {
000004  4680              MOV      r8,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
00000a  461e              MOV      r6,r3
;;;1304     SD_Error errorstatus = SD_OK;
00000c  2700              MOVS     r7,#0
;;;1305     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  492e              LDR      r1,|L33.204|
000012  7008              STRB     r0,[r1,#0]
;;;1306     TransferEnd = 0;
000014  492e              LDR      r1,|L33.208|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1307     StopCondition = 1;
000018  2001              MOVS     r0,#1
00001a  492e              LDR      r1,|L33.212|
00001c  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1308   
;;;1309     SDIO->DCTRL = 0x0;
00001e  2000              MOVS     r0,#0
000020  492d              LDR      r1,|L33.216|
000022  6008              STR      r0,[r1,#0]
;;;1310   
;;;1311     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000024  482d              LDR      r0,|L33.220|
000026  6800              LDR      r0,[r0,#0]  ; CardType
000028  2802              CMP      r0,#2
00002a  d101              BNE      |L33.48|
;;;1312     {
;;;1313       BlockSize = 512;
00002c  0204              LSLS     r4,r0,#8
;;;1314       ReadAddr /= 512;
00002e  0a6d              LSRS     r5,r5,#9
                  |L33.48|
;;;1315     }
;;;1316   
;;;1317     /*!< Set Block Size for Card */
;;;1318     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000030  482b              LDR      r0,|L33.224|
000032  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1319     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000034  2010              MOVS     r0,#0x10
000036  492a              LDR      r1,|L33.224|
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1320     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00003a  2040              MOVS     r0,#0x40
00003c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1321     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003e  2000              MOVS     r0,#0
000040  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1322     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000042  f44f6080          MOV      r0,#0x400
000046  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1323     SDIO_SendCommand(&SDIO_CmdInitStructure);
000048  4608              MOV      r0,r1
00004a  f7fffffe          BL       SDIO_SendCommand
;;;1324   
;;;1325     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00004e  2010              MOVS     r0,#0x10
000050  f7fffffe          BL       CmdResp1Error
000054  4607              MOV      r7,r0
;;;1326   
;;;1327     if (SD_OK != errorstatus)
000056  b117              CBZ      r7,|L33.94|
;;;1328     {
;;;1329       return(errorstatus);
000058  4638              MOV      r0,r7
                  |L33.90|
;;;1330     }
;;;1331   
;;;1332     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1333     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1334     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1335     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1336     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1337     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1338     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1339   
;;;1340     /*!< Send CMD18 READ_MULT_BLOCK with argument data address */
;;;1341     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1342     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_MULT_BLOCK;
;;;1343     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1344     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1345     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1346     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1347   
;;;1348     errorstatus = CmdResp1Error(SD_CMD_READ_MULT_BLOCK);
;;;1349   
;;;1350     if (errorstatus != SD_OK)
;;;1351     {
;;;1352       return(errorstatus);
;;;1353     }
;;;1354   
;;;1355     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1356     SDIO_DMACmd(ENABLE);
;;;1357     SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, (NumberOfBlocks * BlockSize));
;;;1358   
;;;1359     return(errorstatus);
;;;1360   }
00005a  e8bd81f0          POP      {r4-r8,pc}
                  |L33.94|
00005e  f04f30ff          MOV      r0,#0xffffffff        ;1332
000062  4920              LDR      r1,|L33.228|
000064  6008              STR      r0,[r1,#0]            ;1332  ; SDIO_DataInitStructure
000066  fb06f004          MUL      r0,r6,r4              ;1333
00006a  6048              STR      r0,[r1,#4]            ;1333  ; SDIO_DataInitStructure
00006c  2090              MOVS     r0,#0x90              ;1334
00006e  6088              STR      r0,[r1,#8]            ;1334  ; SDIO_DataInitStructure
000070  2002              MOVS     r0,#2                 ;1335
000072  60c8              STR      r0,[r1,#0xc]          ;1335  ; SDIO_DataInitStructure
000074  2000              MOVS     r0,#0                 ;1336
000076  6108              STR      r0,[r1,#0x10]         ;1336  ; SDIO_DataInitStructure
000078  2001              MOVS     r0,#1                 ;1337
00007a  6148              STR      r0,[r1,#0x14]         ;1337  ; SDIO_DataInitStructure
00007c  4608              MOV      r0,r1                 ;1338
00007e  f7fffffe          BL       SDIO_DataConfig
000082  4817              LDR      r0,|L33.224|
000084  6005              STR      r5,[r0,#0]            ;1341  ; SDIO_CmdInitStructure
000086  2012              MOVS     r0,#0x12              ;1342
000088  4915              LDR      r1,|L33.224|
00008a  6048              STR      r0,[r1,#4]            ;1342  ; SDIO_CmdInitStructure
00008c  2040              MOVS     r0,#0x40              ;1343
00008e  6088              STR      r0,[r1,#8]            ;1343  ; SDIO_CmdInitStructure
000090  2000              MOVS     r0,#0                 ;1344
000092  60c8              STR      r0,[r1,#0xc]          ;1344  ; SDIO_CmdInitStructure
000094  f44f6080          MOV      r0,#0x400             ;1345
000098  6108              STR      r0,[r1,#0x10]         ;1345  ; SDIO_CmdInitStructure
00009a  4608              MOV      r0,r1                 ;1346
00009c  f7fffffe          BL       SDIO_SendCommand
0000a0  2012              MOVS     r0,#0x12              ;1348
0000a2  f7fffffe          BL       CmdResp1Error
0000a6  4607              MOV      r7,r0                 ;1348
0000a8  b10f              CBZ      r7,|L33.174|
0000aa  4638              MOV      r0,r7                 ;1352
0000ac  e7d5              B        |L33.90|
                  |L33.174|
0000ae  2101              MOVS     r1,#1                 ;1355
0000b0  f240302a          MOV      r0,#0x32a             ;1355
0000b4  f7fffffe          BL       SDIO_ITConfig
0000b8  2001              MOVS     r0,#1                 ;1356
0000ba  f7fffffe          BL       SDIO_DMACmd
0000be  fb06f104          MUL      r1,r6,r4              ;1357
0000c2  4640              MOV      r0,r8                 ;1357
0000c4  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000c8  4638              MOV      r0,r7                 ;1359
0000ca  e7c6              B        |L33.90|
;;;1361   
                          ENDP

                  |L33.204|
                          DCD      TransferError
                  |L33.208|
                          DCD      TransferEnd
                  |L33.212|
                          DCD      StopCondition
                  |L33.216|
                          DCD      0x40012c2c
                  |L33.220|
                          DCD      CardType
                  |L33.224|
                          DCD      SDIO_CmdInitStructure
                  |L33.228|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_SelectDeselect||, CODE, READONLY, ALIGN=2

                  SD_SelectDeselect PROC
;;;1138     */
;;;1139   SD_Error SD_SelectDeselect(uint32_t addr)
000000  b570              PUSH     {r4-r6,lr}
;;;1140   {
000002  4604              MOV      r4,r0
;;;1141     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1142   
;;;1143     /*!< Send CMD7 SDIO_SEL_DESEL_CARD */
;;;1144     SDIO_CmdInitStructure.SDIO_Argument =  addr;
000006  480a              LDR      r0,|L34.48|
000008  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1145     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEL_DESEL_CARD;
00000a  2007              MOVS     r0,#7
00000c  4908              LDR      r1,|L34.48|
00000e  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1146     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000010  2040              MOVS     r0,#0x40
000012  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1147     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000014  2000              MOVS     r0,#0
000016  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1148     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000018  f44f6080          MOV      r0,#0x400
00001c  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1149     SDIO_SendCommand(&SDIO_CmdInitStructure);
00001e  4608              MOV      r0,r1
000020  f7fffffe          BL       SDIO_SendCommand
;;;1150   
;;;1151     errorstatus = CmdResp1Error(SD_CMD_SEL_DESEL_CARD);
000024  2007              MOVS     r0,#7
000026  f7fffffe          BL       CmdResp1Error
00002a  4605              MOV      r5,r0
;;;1152   
;;;1153     return(errorstatus);
00002c  4628              MOV      r0,r5
;;;1154   }
00002e  bd70              POP      {r4-r6,pc}
;;;1155   
                          ENDP

                  |L34.48|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_SendSDStatus||, CODE, READONLY, ALIGN=2

                  SD_SendSDStatus PROC
;;;1885     */
;;;1886   SD_Error SD_SendSDStatus(uint32_t *psdstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1887   {
000002  4604              MOV      r4,r0
;;;1888     SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;1889     uint32_t count = 0;
000006  2500              MOVS     r5,#0
;;;1890   
;;;1891     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_GetResponse
00000e  f0007000          AND      r0,r0,#0x2000000
000012  b110              CBZ      r0,|L35.26|
;;;1892     {
;;;1893       errorstatus = SD_LOCK_UNLOCK_FAILED;
000014  260e              MOVS     r6,#0xe
;;;1894       return(errorstatus);
000016  4630              MOV      r0,r6
                  |L35.24|
;;;1895     }
;;;1896   
;;;1897     /*!< Set block size for card if it is not equal to current block size for card. */
;;;1898     SDIO_CmdInitStructure.SDIO_Argument = 64;
;;;1899     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1900     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1901     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1902     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1903     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1904   
;;;1905     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
;;;1906   
;;;1907     if (errorstatus != SD_OK)
;;;1908     {
;;;1909       return(errorstatus);
;;;1910     }
;;;1911   
;;;1912     /*!< CMD55 */
;;;1913     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1914     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1915     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1916     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1917     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1918     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1919     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1920   
;;;1921     if (errorstatus != SD_OK)
;;;1922     {
;;;1923       return(errorstatus);
;;;1924     }
;;;1925   
;;;1926     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1927     SDIO_DataInitStructure.SDIO_DataLength = 64;
;;;1928     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_64b;
;;;1929     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1930     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1931     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1932     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1933   
;;;1934     /*!< Send ACMD13 SD_APP_STAUS  with argument as card's RCA.*/
;;;1935     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1936     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_STAUS;
;;;1937     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1938     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1939     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1940     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1941     errorstatus = CmdResp1Error(SD_CMD_SD_APP_STAUS);
;;;1942   
;;;1943     if (errorstatus != SD_OK)
;;;1944     {
;;;1945       return(errorstatus);
;;;1946     }
;;;1947   
;;;1948     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1949     {
;;;1950       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1951       {
;;;1952         for (count = 0; count < 8; count++)
;;;1953         {
;;;1954           *(psdstatus + count) = SDIO_ReadData();
;;;1955         }
;;;1956         psdstatus += 8;
;;;1957       }
;;;1958     }
;;;1959   
;;;1960     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1961     {
;;;1962       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1963       errorstatus = SD_DATA_TIMEOUT;
;;;1964       return(errorstatus);
;;;1965     }
;;;1966     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1967     {
;;;1968       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1969       errorstatus = SD_DATA_CRC_FAIL;
;;;1970       return(errorstatus);
;;;1971     }
;;;1972     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1973     {
;;;1974       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1975       errorstatus = SD_RX_OVERRUN;
;;;1976       return(errorstatus);
;;;1977     }
;;;1978     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1979     {
;;;1980       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1981       errorstatus = SD_START_BIT_ERR;
;;;1982       return(errorstatus);
;;;1983     }
;;;1984   
;;;1985     count = SD_DATATIMEOUT;
;;;1986     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1987     {
;;;1988       *psdstatus = SDIO_ReadData();
;;;1989       psdstatus++;
;;;1990       count--;
;;;1991     }
;;;1992     /*!< Clear all the static status flags*/
;;;1993     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1994   
;;;1995     return(errorstatus);
;;;1996   }
000018  bd70              POP      {r4-r6,pc}
                  |L35.26|
00001a  2040              MOVS     r0,#0x40              ;1898
00001c  4954              LDR      r1,|L35.368|
00001e  6008              STR      r0,[r1,#0]            ;1898  ; SDIO_CmdInitStructure
000020  2010              MOVS     r0,#0x10              ;1899
000022  6048              STR      r0,[r1,#4]            ;1899  ; SDIO_CmdInitStructure
000024  2040              MOVS     r0,#0x40              ;1900
000026  6088              STR      r0,[r1,#8]            ;1900  ; SDIO_CmdInitStructure
000028  2000              MOVS     r0,#0                 ;1901
00002a  60c8              STR      r0,[r1,#0xc]          ;1901  ; SDIO_CmdInitStructure
00002c  f44f6080          MOV      r0,#0x400             ;1902
000030  6108              STR      r0,[r1,#0x10]         ;1902  ; SDIO_CmdInitStructure
000032  4608              MOV      r0,r1                 ;1903
000034  f7fffffe          BL       SDIO_SendCommand
000038  2010              MOVS     r0,#0x10              ;1905
00003a  f7fffffe          BL       CmdResp1Error
00003e  4606              MOV      r6,r0                 ;1905
000040  b10e              CBZ      r6,|L35.70|
000042  4630              MOV      r0,r6                 ;1909
000044  e7e8              B        |L35.24|
                  |L35.70|
000046  484b              LDR      r0,|L35.372|
000048  8800              LDRH     r0,[r0,#0]            ;1913  ; RCA
00004a  0400              LSLS     r0,r0,#16             ;1913
00004c  4948              LDR      r1,|L35.368|
00004e  6008              STR      r0,[r1,#0]            ;1913  ; SDIO_CmdInitStructure
000050  2037              MOVS     r0,#0x37              ;1914
000052  6048              STR      r0,[r1,#4]            ;1914  ; SDIO_CmdInitStructure
000054  2040              MOVS     r0,#0x40              ;1915
000056  6088              STR      r0,[r1,#8]            ;1915  ; SDIO_CmdInitStructure
000058  2000              MOVS     r0,#0                 ;1916
00005a  60c8              STR      r0,[r1,#0xc]          ;1916  ; SDIO_CmdInitStructure
00005c  f44f6080          MOV      r0,#0x400             ;1917
000060  6108              STR      r0,[r1,#0x10]         ;1917  ; SDIO_CmdInitStructure
000062  4608              MOV      r0,r1                 ;1918
000064  f7fffffe          BL       SDIO_SendCommand
000068  2037              MOVS     r0,#0x37              ;1919
00006a  f7fffffe          BL       CmdResp1Error
00006e  4606              MOV      r6,r0                 ;1919
000070  b10e              CBZ      r6,|L35.118|
000072  4630              MOV      r0,r6                 ;1923
000074  e7d0              B        |L35.24|
                  |L35.118|
000076  f04f30ff          MOV      r0,#0xffffffff        ;1926
00007a  493f              LDR      r1,|L35.376|
00007c  6008              STR      r0,[r1,#0]            ;1926  ; SDIO_DataInitStructure
00007e  2040              MOVS     r0,#0x40              ;1927
000080  6048              STR      r0,[r1,#4]            ;1927  ; SDIO_DataInitStructure
000082  2060              MOVS     r0,#0x60              ;1928
000084  6088              STR      r0,[r1,#8]            ;1928  ; SDIO_DataInitStructure
000086  2002              MOVS     r0,#2                 ;1929
000088  60c8              STR      r0,[r1,#0xc]          ;1929  ; SDIO_DataInitStructure
00008a  2000              MOVS     r0,#0                 ;1930
00008c  6108              STR      r0,[r1,#0x10]         ;1930  ; SDIO_DataInitStructure
00008e  2001              MOVS     r0,#1                 ;1931
000090  6148              STR      r0,[r1,#0x14]         ;1931  ; SDIO_DataInitStructure
000092  4608              MOV      r0,r1                 ;1932
000094  f7fffffe          BL       SDIO_DataConfig
000098  2000              MOVS     r0,#0                 ;1935
00009a  4935              LDR      r1,|L35.368|
00009c  6008              STR      r0,[r1,#0]            ;1935  ; SDIO_CmdInitStructure
00009e  200d              MOVS     r0,#0xd               ;1936
0000a0  6048              STR      r0,[r1,#4]            ;1936  ; SDIO_CmdInitStructure
0000a2  2040              MOVS     r0,#0x40              ;1937
0000a4  6088              STR      r0,[r1,#8]            ;1937  ; SDIO_CmdInitStructure
0000a6  2000              MOVS     r0,#0                 ;1938
0000a8  60c8              STR      r0,[r1,#0xc]          ;1938  ; SDIO_CmdInitStructure
0000aa  f44f6080          MOV      r0,#0x400             ;1939
0000ae  6108              STR      r0,[r1,#0x10]         ;1939  ; SDIO_CmdInitStructure
0000b0  4608              MOV      r0,r1                 ;1940
0000b2  f7fffffe          BL       SDIO_SendCommand
0000b6  200d              MOVS     r0,#0xd               ;1941
0000b8  f7fffffe          BL       CmdResp1Error
0000bc  4606              MOV      r6,r0                 ;1941
0000be  b10e              CBZ      r6,|L35.196|
0000c0  4630              MOV      r0,r6                 ;1945
0000c2  e7a9              B        |L35.24|
                  |L35.196|
0000c4  e00e              B        |L35.228|
                  |L35.198|
0000c6  f44f4000          MOV      r0,#0x8000            ;1950
0000ca  f7fffffe          BL       SDIO_GetFlagStatus
0000ce  b148              CBZ      r0,|L35.228|
0000d0  2500              MOVS     r5,#0                 ;1952
0000d2  e004              B        |L35.222|
                  |L35.212|
0000d4  f7fffffe          BL       SDIO_ReadData
0000d8  f8440025          STR      r0,[r4,r5,LSL #2]     ;1954
0000dc  1c6d              ADDS     r5,r5,#1              ;1952
                  |L35.222|
0000de  2d08              CMP      r5,#8                 ;1952
0000e0  d3f8              BCC      |L35.212|
0000e2  3420              ADDS     r4,r4,#0x20           ;1956
                  |L35.228|
0000e4  4825              LDR      r0,|L35.380|
0000e6  6800              LDR      r0,[r0,#0]            ;1948
0000e8  f240612a          MOV      r1,#0x62a             ;1948
0000ec  4008              ANDS     r0,r0,r1              ;1948
0000ee  2800              CMP      r0,#0                 ;1948
0000f0  d0e9              BEQ      |L35.198|
0000f2  2008              MOVS     r0,#8                 ;1960
0000f4  f7fffffe          BL       SDIO_GetFlagStatus
0000f8  b128              CBZ      r0,|L35.262|
0000fa  2008              MOVS     r0,#8                 ;1962
0000fc  f7fffffe          BL       SDIO_ClearFlag
000100  2604              MOVS     r6,#4                 ;1963
000102  4630              MOV      r0,r6                 ;1964
000104  e788              B        |L35.24|
                  |L35.262|
000106  2002              MOVS     r0,#2                 ;1966
000108  f7fffffe          BL       SDIO_GetFlagStatus
00010c  b128              CBZ      r0,|L35.282|
00010e  2002              MOVS     r0,#2                 ;1968
000110  f7fffffe          BL       SDIO_ClearFlag
000114  2602              MOVS     r6,#2                 ;1969
000116  4630              MOV      r0,r6                 ;1970
000118  e77e              B        |L35.24|
                  |L35.282|
00011a  2020              MOVS     r0,#0x20              ;1972
00011c  f7fffffe          BL       SDIO_GetFlagStatus
000120  b128              CBZ      r0,|L35.302|
000122  2020              MOVS     r0,#0x20              ;1974
000124  f7fffffe          BL       SDIO_ClearFlag
000128  2606              MOVS     r6,#6                 ;1975
00012a  4630              MOV      r0,r6                 ;1976
00012c  e774              B        |L35.24|
                  |L35.302|
00012e  f44f7000          MOV      r0,#0x200             ;1978
000132  f7fffffe          BL       SDIO_GetFlagStatus
000136  b130              CBZ      r0,|L35.326|
000138  f44f7000          MOV      r0,#0x200             ;1980
00013c  f7fffffe          BL       SDIO_ClearFlag
000140  2607              MOVS     r6,#7                 ;1981
000142  4630              MOV      r0,r6                 ;1982
000144  e768              B        |L35.24|
                  |L35.326|
000146  f04f35ff          MOV      r5,#0xffffffff        ;1985
00014a  e004              B        |L35.342|
                  |L35.332|
00014c  f7fffffe          BL       SDIO_ReadData
000150  6020              STR      r0,[r4,#0]            ;1988
000152  1d24              ADDS     r4,r4,#4              ;1989
000154  1e6d              SUBS     r5,r5,#1              ;1990
                  |L35.342|
000156  f44f1000          MOV      r0,#0x200000          ;1986
00015a  f7fffffe          BL       SDIO_GetFlagStatus
00015e  b108              CBZ      r0,|L35.356|
000160  2d00              CMP      r5,#0                 ;1986
000162  d1f3              BNE      |L35.332|
                  |L35.356|
000164  f24050ff          MOV      r0,#0x5ff             ;1993
000168  f7fffffe          BL       SDIO_ClearFlag
00016c  4630              MOV      r0,r6                 ;1995
00016e  e753              B        |L35.24|
;;;1997   
                          ENDP

                  |L35.368|
                          DCD      SDIO_CmdInitStructure
                  |L35.372|
                          DCD      ||RCA||
                  |L35.376|
                          DCD      SDIO_DataInitStructure
                  |L35.380|
                          DCD      0x40012c34

                          AREA ||i.SD_SendStatus||, CODE, READONLY, ALIGN=2

                  SD_SendStatus PROC
;;;1850     */
;;;1851   SD_Error SD_SendStatus(uint32_t *pcardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1852   {
000002  4604              MOV      r4,r0
;;;1853     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1854   
;;;1855     if (pcardstatus == NULL)
000006  b914              CBNZ     r4,|L36.14|
;;;1856     {
;;;1857       errorstatus = SD_INVALID_PARAMETER;
000008  2526              MOVS     r5,#0x26
;;;1858       return(errorstatus);
00000a  4628              MOV      r0,r5
                  |L36.12|
;;;1859     }
;;;1860   
;;;1861     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1862     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
;;;1863     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1864     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1865     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1866     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1867   
;;;1868     errorstatus = CmdResp1Error(SD_CMD_SEND_STATUS);
;;;1869   
;;;1870     if (errorstatus != SD_OK)
;;;1871     {
;;;1872       return(errorstatus);
;;;1873     }
;;;1874   
;;;1875     *pcardstatus = SDIO_GetResponse(SDIO_RESP1);
;;;1876   
;;;1877     return(errorstatus);
;;;1878   }
00000c  bd70              POP      {r4-r6,pc}
                  |L36.14|
00000e  480f              LDR      r0,|L36.76|
000010  8800              LDRH     r0,[r0,#0]            ;1861  ; RCA
000012  0400              LSLS     r0,r0,#16             ;1861
000014  490e              LDR      r1,|L36.80|
000016  6008              STR      r0,[r1,#0]            ;1861  ; SDIO_CmdInitStructure
000018  200d              MOVS     r0,#0xd               ;1862
00001a  6048              STR      r0,[r1,#4]            ;1862  ; SDIO_CmdInitStructure
00001c  2040              MOVS     r0,#0x40              ;1863
00001e  6088              STR      r0,[r1,#8]            ;1863  ; SDIO_CmdInitStructure
000020  2000              MOVS     r0,#0                 ;1864
000022  60c8              STR      r0,[r1,#0xc]          ;1864  ; SDIO_CmdInitStructure
000024  f44f6080          MOV      r0,#0x400             ;1865
000028  6108              STR      r0,[r1,#0x10]         ;1865  ; SDIO_CmdInitStructure
00002a  4608              MOV      r0,r1                 ;1866
00002c  f7fffffe          BL       SDIO_SendCommand
000030  200d              MOVS     r0,#0xd               ;1868
000032  f7fffffe          BL       CmdResp1Error
000036  4605              MOV      r5,r0                 ;1868
000038  b10d              CBZ      r5,|L36.62|
00003a  4628              MOV      r0,r5                 ;1872
00003c  e7e6              B        |L36.12|
                  |L36.62|
00003e  2000              MOVS     r0,#0                 ;1875
000040  f7fffffe          BL       SDIO_GetResponse
000044  6020              STR      r0,[r4,#0]            ;1875
000046  4628              MOV      r0,r5                 ;1877
000048  e7e0              B        |L36.12|
;;;1879   
                          ENDP

00004a  0000              DCW      0x0000
                  |L36.76|
                          DCD      ||RCA||
                  |L36.80|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_StopTransfer||, CODE, READONLY, ALIGN=2

                  SD_StopTransfer PROC
;;;1731     */
;;;1732   SD_Error SD_StopTransfer(void)
000000  b510              PUSH     {r4,lr}
;;;1733   {
;;;1734     SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;1735   
;;;1736     /*!< Send CMD12 STOP_TRANSMISSION  */
;;;1737     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000004  2000              MOVS     r0,#0
000006  490a              LDR      r1,|L37.48|
000008  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;1738     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_STOP_TRANSMISSION;
00000a  200c              MOVS     r0,#0xc
00000c  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1739     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00000e  2040              MOVS     r0,#0x40
000010  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1740     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000012  2000              MOVS     r0,#0
000014  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1741     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000016  f44f6080          MOV      r0,#0x400
00001a  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1742     SDIO_SendCommand(&SDIO_CmdInitStructure);
00001c  4608              MOV      r0,r1
00001e  f7fffffe          BL       SDIO_SendCommand
;;;1743   
;;;1744     errorstatus = CmdResp1Error(SD_CMD_STOP_TRANSMISSION);
000022  200c              MOVS     r0,#0xc
000024  f7fffffe          BL       CmdResp1Error
000028  4604              MOV      r4,r0
;;;1745   
;;;1746     return(errorstatus);
00002a  4620              MOV      r0,r4
;;;1747   }
00002c  bd10              POP      {r4,pc}
;;;1748   
                          ENDP

00002e  0000              DCW      0x0000
                  |L37.48|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_WaitReadOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitReadOperation PROC
;;;1369     */
;;;1370   SD_Error SD_WaitReadOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1371   {
;;;1372     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1373     uint32_t timeout;
;;;1374   
;;;1375     timeout = SD_DATATIMEOUT;
000004  1e6c              SUBS     r4,r5,#1
;;;1376   
;;;1377     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L38.10|
                  |L38.8|
;;;1378     {
;;;1379       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L38.10|
00000a  4818              LDR      r0,|L38.108|
00000c  6800              LDR      r0,[r0,#0]            ;1377  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L38.32|
000010  4817              LDR      r0,|L38.112|
000012  6800              LDR      r0,[r0,#0]            ;1377  ; TransferEnd
000014  b920              CBNZ     r0,|L38.32|
000016  4817              LDR      r0,|L38.116|
000018  7800              LDRB     r0,[r0,#0]            ;1377  ; TransferError
00001a  b908              CBNZ     r0,|L38.32|
00001c  2c00              CMP      r4,#0                 ;1377
00001e  d1f3              BNE      |L38.8|
                  |L38.32|
;;;1380     }
;;;1381   
;;;1382     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4912              LDR      r1,|L38.108|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1383   
;;;1384     timeout = SD_DATATIMEOUT;
000026  1e44              SUBS     r4,r0,#1
;;;1385   
;;;1386     while(((SDIO->STA & SDIO_FLAG_RXACT)) && (timeout > 0))
000028  e000              B        |L38.44|
                  |L38.42|
;;;1387     {
;;;1388       timeout--;
00002a  1e64              SUBS     r4,r4,#1
                  |L38.44|
00002c  4812              LDR      r0,|L38.120|
00002e  6800              LDR      r0,[r0,#0]            ;1386
000030  f4005000          AND      r0,r0,#0x2000         ;1386
000034  b108              CBZ      r0,|L38.58|
000036  2c00              CMP      r4,#0                 ;1386
000038  d1f7              BNE      |L38.42|
                  |L38.58|
;;;1389     }
;;;1390   
;;;1391     if (StopCondition == 1)
00003a  4810              LDR      r0,|L38.124|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L38.78|
;;;1392     {
;;;1393       errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1394       StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490c              LDR      r1,|L38.124|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L38.78|
;;;1395     }
;;;1396   
;;;1397     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L38.84|
000050  b905              CBNZ     r5,|L38.84|
;;;1398     {
;;;1399       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L38.84|
;;;1400     }
;;;1401   
;;;1402     /*!< Clear all the static flags */
;;;1403     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1404   
;;;1405     if (TransferError != SD_OK)
00005c  4805              LDR      r0,|L38.116|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L38.104|
;;;1406     {
;;;1407       return(TransferError);
000062  4804              LDR      r0,|L38.116|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L38.102|
;;;1408     }
;;;1409     else
;;;1410     {
;;;1411       return(errorstatus);
;;;1412     }
;;;1413   }
000066  bd70              POP      {r4-r6,pc}
                  |L38.104|
000068  4628              MOV      r0,r5                 ;1411
00006a  e7fc              B        |L38.102|
;;;1414   
                          ENDP

                  |L38.108|
                          DCD      DMAEndOfTransfer
                  |L38.112|
                          DCD      TransferEnd
                  |L38.116|
                          DCD      TransferError
                  |L38.120|
                          DCD      0x40012c34
                  |L38.124|
                          DCD      StopCondition

                          AREA ||i.SD_WaitWriteOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitWriteOperation PROC
;;;1661     */
;;;1662   SD_Error SD_WaitWriteOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1663   {
;;;1664     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1665     uint32_t timeout;
;;;1666   
;;;1667     timeout = SD_DATATIMEOUT;
000004  1e6c              SUBS     r4,r5,#1
;;;1668   
;;;1669     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L39.10|
                  |L39.8|
;;;1670     {
;;;1671       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L39.10|
00000a  4818              LDR      r0,|L39.108|
00000c  6800              LDR      r0,[r0,#0]            ;1669  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L39.32|
000010  4817              LDR      r0,|L39.112|
000012  6800              LDR      r0,[r0,#0]            ;1669  ; TransferEnd
000014  b920              CBNZ     r0,|L39.32|
000016  4817              LDR      r0,|L39.116|
000018  7800              LDRB     r0,[r0,#0]            ;1669  ; TransferError
00001a  b908              CBNZ     r0,|L39.32|
00001c  2c00              CMP      r4,#0                 ;1669
00001e  d1f3              BNE      |L39.8|
                  |L39.32|
;;;1672     }
;;;1673   
;;;1674     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4912              LDR      r1,|L39.108|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1675   
;;;1676     timeout = SD_DATATIMEOUT;
000026  1e44              SUBS     r4,r0,#1
;;;1677   
;;;1678     while(((SDIO->STA & SDIO_FLAG_TXACT)) && (timeout > 0))
000028  e000              B        |L39.44|
                  |L39.42|
;;;1679     {
;;;1680       timeout--;
00002a  1e64              SUBS     r4,r4,#1
                  |L39.44|
00002c  4812              LDR      r0,|L39.120|
00002e  6800              LDR      r0,[r0,#0]            ;1678
000030  f4005080          AND      r0,r0,#0x1000         ;1678
000034  b108              CBZ      r0,|L39.58|
000036  2c00              CMP      r4,#0                 ;1678
000038  d1f7              BNE      |L39.42|
                  |L39.58|
;;;1681     }
;;;1682   
;;;1683     if (StopCondition == 1)
00003a  4810              LDR      r0,|L39.124|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L39.78|
;;;1684     {
;;;1685       errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1686       StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490c              LDR      r1,|L39.124|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L39.78|
;;;1687     }
;;;1688   
;;;1689     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L39.84|
000050  b905              CBNZ     r5,|L39.84|
;;;1690     {
;;;1691       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L39.84|
;;;1692     }
;;;1693   
;;;1694     /*!< Clear all the static flags */
;;;1695     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1696   
;;;1697     if (TransferError != SD_OK)
00005c  4805              LDR      r0,|L39.116|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L39.104|
;;;1698     {
;;;1699       return(TransferError);
000062  4804              LDR      r0,|L39.116|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L39.102|
;;;1700     }
;;;1701     else
;;;1702     {
;;;1703       return(errorstatus);
;;;1704     }
;;;1705   }
000066  bd70              POP      {r4-r6,pc}
                  |L39.104|
000068  4628              MOV      r0,r5                 ;1703
00006a  e7fc              B        |L39.102|
;;;1706   
                          ENDP

                  |L39.108|
                          DCD      DMAEndOfTransfer
                  |L39.112|
                          DCD      TransferEnd
                  |L39.116|
                          DCD      TransferError
                  |L39.120|
                          DCD      0x40012c34
                  |L39.124|
                          DCD      StopCondition

                          AREA ||i.SD_WriteBlock||, CODE, READONLY, ALIGN=2

                  SD_WriteBlock PROC
;;;1428     */
;;;1429   SD_Error SD_WriteBlock(uint8_t *writebuff, uint32_t WriteAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1430   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
000008  4614              MOV      r4,r2
;;;1431     SD_Error errorstatus = SD_OK;
00000a  2600              MOVS     r6,#0
;;;1432   
;;;1433   #if defined (SD_POLLING_MODE)
;;;1434     uint32_t bytestransferred = 0, count = 0, restwords = 0;
;;;1435     uint32_t *tempbuff = (uint32_t *)writebuff;
;;;1436   #endif
;;;1437   
;;;1438     TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  492c              LDR      r1,|L40.192|
000010  7008              STRB     r0,[r1,#0]
;;;1439     TransferEnd = 0;
000012  492c              LDR      r1,|L40.196|
000014  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1440     StopCondition = 0;
000016  492c              LDR      r1,|L40.200|
000018  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1441   
;;;1442     SDIO->DCTRL = 0x0;
00001a  492c              LDR      r1,|L40.204|
00001c  6008              STR      r0,[r1,#0]
;;;1443   
;;;1444   
;;;1445     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00001e  482c              LDR      r0,|L40.208|
000020  6800              LDR      r0,[r0,#0]  ; CardType
000022  2802              CMP      r0,#2
000024  d101              BNE      |L40.42|
;;;1446     {
;;;1447       BlockSize = 512;
000026  0204              LSLS     r4,r0,#8
;;;1448       WriteAddr /= 512;
000028  0a6d              LSRS     r5,r5,#9
                  |L40.42|
;;;1449     }
;;;1450   
;;;1451     /* Set Block Size for Card */
;;;1452     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00002a  482a              LDR      r0,|L40.212|
00002c  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1453     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00002e  2010              MOVS     r0,#0x10
000030  4928              LDR      r1,|L40.212|
000032  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1454     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000034  2040              MOVS     r0,#0x40
000036  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1455     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000038  2000              MOVS     r0,#0
00003a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1456     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003c  f44f6080          MOV      r0,#0x400
000040  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1457     SDIO_SendCommand(&SDIO_CmdInitStructure);
000042  4608              MOV      r0,r1
000044  f7fffffe          BL       SDIO_SendCommand
;;;1458   
;;;1459     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000048  2010              MOVS     r0,#0x10
00004a  f7fffffe          BL       CmdResp1Error
00004e  4606              MOV      r6,r0
;;;1460   
;;;1461     if (SD_OK != errorstatus)
000050  b116              CBZ      r6,|L40.88|
;;;1462     {
;;;1463       return(errorstatus);
000052  4630              MOV      r0,r6
                  |L40.84|
;;;1464     }
;;;1465   
;;;1466     /*!< Send CMD24 WRITE_SINGLE_BLOCK */
;;;1467     SDIO_CmdInitStructure.SDIO_Argument = WriteAddr;
;;;1468     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_SINGLE_BLOCK;
;;;1469     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1470     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1471     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1472     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1473   
;;;1474     errorstatus = CmdResp1Error(SD_CMD_WRITE_SINGLE_BLOCK);
;;;1475   
;;;1476     if (errorstatus != SD_OK)
;;;1477     {
;;;1478       return(errorstatus);
;;;1479     }
;;;1480   
;;;1481     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1482     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1483     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1484     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1485     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1486     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1487     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1488   
;;;1489     /*!< In case of single data block transfer no need of stop command at all */
;;;1490   #if defined (SD_POLLING_MODE)
;;;1491     while (!(SDIO->STA & (SDIO_FLAG_DBCKEND | SDIO_FLAG_TXUNDERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_STBITERR)))
;;;1492     {
;;;1493       if (SDIO_GetFlagStatus(SDIO_FLAG_TXFIFOHE) != RESET)
;;;1494       {
;;;1495         if ((512 - bytestransferred) < 32)
;;;1496         {
;;;1497           restwords = ((512 - bytestransferred) % 4 == 0) ? ((512 - bytestransferred) / 4) : (( 512 -  bytestransferred) / 4 + 1);
;;;1498           for (count = 0; count < restwords; count++, tempbuff++, bytestransferred += 4)
;;;1499           {
;;;1500             SDIO_WriteData(*tempbuff);
;;;1501           }
;;;1502         }
;;;1503         else
;;;1504         {
;;;1505           for (count = 0; count < 8; count++)
;;;1506           {
;;;1507             SDIO_WriteData(*(tempbuff + count));
;;;1508           }
;;;1509           tempbuff += 8;
;;;1510           bytestransferred += 32;
;;;1511         }
;;;1512       }
;;;1513     }
;;;1514     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1515     {
;;;1516       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1517       errorstatus = SD_DATA_TIMEOUT;
;;;1518       return(errorstatus);
;;;1519     }
;;;1520     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1521     {
;;;1522       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1523       errorstatus = SD_DATA_CRC_FAIL;
;;;1524       return(errorstatus);
;;;1525     }
;;;1526     else if (SDIO_GetFlagStatus(SDIO_FLAG_TXUNDERR) != RESET)
;;;1527     {
;;;1528       SDIO_ClearFlag(SDIO_FLAG_TXUNDERR);
;;;1529       errorstatus = SD_TX_UNDERRUN;
;;;1530       return(errorstatus);
;;;1531     }
;;;1532     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1533     {
;;;1534       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1535       errorstatus = SD_START_BIT_ERR;
;;;1536       return(errorstatus);
;;;1537     }
;;;1538   #elif defined (SD_DMA_MODE)
;;;1539     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1540     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, BlockSize);
;;;1541     SDIO_DMACmd(ENABLE);
;;;1542   #endif
;;;1543   
;;;1544     return(errorstatus);
;;;1545   }
000054  e8bd81f0          POP      {r4-r8,pc}
                  |L40.88|
000058  481e              LDR      r0,|L40.212|
00005a  6005              STR      r5,[r0,#0]            ;1467  ; SDIO_CmdInitStructure
00005c  2018              MOVS     r0,#0x18              ;1468
00005e  491d              LDR      r1,|L40.212|
000060  6048              STR      r0,[r1,#4]            ;1468  ; SDIO_CmdInitStructure
000062  2040              MOVS     r0,#0x40              ;1469
000064  6088              STR      r0,[r1,#8]            ;1469  ; SDIO_CmdInitStructure
000066  2000              MOVS     r0,#0                 ;1470
000068  60c8              STR      r0,[r1,#0xc]          ;1470  ; SDIO_CmdInitStructure
00006a  f44f6080          MOV      r0,#0x400             ;1471
00006e  6108              STR      r0,[r1,#0x10]         ;1471  ; SDIO_CmdInitStructure
000070  4608              MOV      r0,r1                 ;1472
000072  f7fffffe          BL       SDIO_SendCommand
000076  2018              MOVS     r0,#0x18              ;1474
000078  f7fffffe          BL       CmdResp1Error
00007c  4606              MOV      r6,r0                 ;1474
00007e  b10e              CBZ      r6,|L40.132|
000080  4630              MOV      r0,r6                 ;1478
000082  e7e7              B        |L40.84|
                  |L40.132|
000084  f04f30ff          MOV      r0,#0xffffffff        ;1481
000088  4913              LDR      r1,|L40.216|
00008a  6008              STR      r0,[r1,#0]            ;1481  ; SDIO_DataInitStructure
00008c  4608              MOV      r0,r1                 ;1482
00008e  6044              STR      r4,[r0,#4]            ;1482  ; SDIO_DataInitStructure
000090  2090              MOVS     r0,#0x90              ;1483
000092  6088              STR      r0,[r1,#8]            ;1483  ; SDIO_DataInitStructure
000094  2000              MOVS     r0,#0                 ;1484
000096  60c8              STR      r0,[r1,#0xc]          ;1484  ; SDIO_DataInitStructure
000098  6108              STR      r0,[r1,#0x10]         ;1485  ; SDIO_DataInitStructure
00009a  2001              MOVS     r0,#1                 ;1486
00009c  6148              STR      r0,[r1,#0x14]         ;1486  ; SDIO_DataInitStructure
00009e  4608              MOV      r0,r1                 ;1487
0000a0  f7fffffe          BL       SDIO_DataConfig
0000a4  2101              MOVS     r1,#1                 ;1539
0000a6  f240302a          MOV      r0,#0x32a             ;1539
0000aa  f7fffffe          BL       SDIO_ITConfig
0000ae  4621              MOV      r1,r4                 ;1540
0000b0  4638              MOV      r0,r7                 ;1540
0000b2  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
0000b6  2001              MOVS     r0,#1                 ;1541
0000b8  f7fffffe          BL       SDIO_DMACmd
0000bc  4630              MOV      r0,r6                 ;1544
0000be  e7c9              B        |L40.84|
;;;1546   
                          ENDP

                  |L40.192|
                          DCD      TransferError
                  |L40.196|
                          DCD      TransferEnd
                  |L40.200|
                          DCD      StopCondition
                  |L40.204|
                          DCD      0x40012c2c
                  |L40.208|
                          DCD      CardType
                  |L40.212|
                          DCD      SDIO_CmdInitStructure
                  |L40.216|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_WriteMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_WriteMultiBlocks PROC
;;;1561     */
;;;1562   SD_Error SD_WriteMultiBlocks(uint8_t *writebuff, uint32_t WriteAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1563   {
000004  4680              MOV      r8,r0
000006  460f              MOV      r7,r1
000008  4615              MOV      r5,r2
00000a  461e              MOV      r6,r3
;;;1564     SD_Error errorstatus = SD_OK;
00000c  2400              MOVS     r4,#0
;;;1565   
;;;1566     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  4945              LDR      r1,|L41.296|
000012  7008              STRB     r0,[r1,#0]
;;;1567     TransferEnd = 0;
000014  4945              LDR      r1,|L41.300|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1568     StopCondition = 1;
000018  2001              MOVS     r0,#1
00001a  4945              LDR      r1,|L41.304|
00001c  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1569   
;;;1570     SDIO->DCTRL = 0x0;
00001e  2000              MOVS     r0,#0
000020  4944              LDR      r1,|L41.308|
000022  6008              STR      r0,[r1,#0]
;;;1571   
;;;1572     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000024  4844              LDR      r0,|L41.312|
000026  6800              LDR      r0,[r0,#0]  ; CardType
000028  2802              CMP      r0,#2
00002a  d101              BNE      |L41.48|
;;;1573     {
;;;1574       BlockSize = 512;
00002c  0205              LSLS     r5,r0,#8
;;;1575       WriteAddr /= 512;
00002e  0a7f              LSRS     r7,r7,#9
                  |L41.48|
;;;1576     }
;;;1577   
;;;1578     /* Set Block Size for Card */
;;;1579     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000030  4842              LDR      r0,|L41.316|
000032  6005              STR      r5,[r0,#0]  ; SDIO_CmdInitStructure
;;;1580     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000034  2010              MOVS     r0,#0x10
000036  4941              LDR      r1,|L41.316|
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1581     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00003a  2040              MOVS     r0,#0x40
00003c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1582     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003e  2000              MOVS     r0,#0
000040  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1583     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000042  f44f6080          MOV      r0,#0x400
000046  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1584     SDIO_SendCommand(&SDIO_CmdInitStructure);
000048  4608              MOV      r0,r1
00004a  f7fffffe          BL       SDIO_SendCommand
;;;1585   
;;;1586     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00004e  2010              MOVS     r0,#0x10
000050  f7fffffe          BL       CmdResp1Error
000054  4604              MOV      r4,r0
;;;1587   
;;;1588     if (SD_OK != errorstatus)
000056  b114              CBZ      r4,|L41.94|
;;;1589     {
;;;1590       return(errorstatus);
000058  4620              MOV      r0,r4
                  |L41.90|
;;;1591     }
;;;1592   
;;;1593     /*!< To improve performance */
;;;1594     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) (RCA << 16);
;;;1595     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1596     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1597     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1598     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1599     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1600   
;;;1601   
;;;1602     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1603   
;;;1604     if (errorstatus != SD_OK)
;;;1605     {
;;;1606       return(errorstatus);
;;;1607     }
;;;1608     /*!< To improve performance */
;;;1609     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)NumberOfBlocks;
;;;1610     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCK_COUNT;
;;;1611     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1612     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1613     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1614     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1615   
;;;1616     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCK_COUNT);
;;;1617   
;;;1618     if (errorstatus != SD_OK)
;;;1619     {
;;;1620       return(errorstatus);
;;;1621     }
;;;1622   
;;;1623   
;;;1624     /*!< Send CMD25 WRITE_MULT_BLOCK with argument data address */
;;;1625     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)WriteAddr;
;;;1626     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_MULT_BLOCK;
;;;1627     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1628     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1629     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1630     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1631   
;;;1632     errorstatus = CmdResp1Error(SD_CMD_WRITE_MULT_BLOCK);
;;;1633   
;;;1634     if (SD_OK != errorstatus)
;;;1635     {
;;;1636       return(errorstatus);
;;;1637     }
;;;1638   
;;;1639     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1640     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1641     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1642     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1643     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1644     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1645     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1646   
;;;1647     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1648     SDIO_DMACmd(ENABLE);
;;;1649     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, (NumberOfBlocks * BlockSize));
;;;1650   
;;;1651     return(errorstatus);
;;;1652   }
00005a  e8bd81f0          POP      {r4-r8,pc}
                  |L41.94|
00005e  4838              LDR      r0,|L41.320|
000060  8800              LDRH     r0,[r0,#0]            ;1594  ; RCA
000062  0400              LSLS     r0,r0,#16             ;1594
000064  4935              LDR      r1,|L41.316|
000066  6008              STR      r0,[r1,#0]            ;1594  ; SDIO_CmdInitStructure
000068  2037              MOVS     r0,#0x37              ;1595
00006a  6048              STR      r0,[r1,#4]            ;1595  ; SDIO_CmdInitStructure
00006c  2040              MOVS     r0,#0x40              ;1596
00006e  6088              STR      r0,[r1,#8]            ;1596  ; SDIO_CmdInitStructure
000070  2000              MOVS     r0,#0                 ;1597
000072  60c8              STR      r0,[r1,#0xc]          ;1597  ; SDIO_CmdInitStructure
000074  f44f6080          MOV      r0,#0x400             ;1598
000078  6108              STR      r0,[r1,#0x10]         ;1598  ; SDIO_CmdInitStructure
00007a  4608              MOV      r0,r1                 ;1599
00007c  f7fffffe          BL       SDIO_SendCommand
000080  2037              MOVS     r0,#0x37              ;1602
000082  f7fffffe          BL       CmdResp1Error
000086  4604              MOV      r4,r0                 ;1602
000088  b10c              CBZ      r4,|L41.142|
00008a  4620              MOV      r0,r4                 ;1606
00008c  e7e5              B        |L41.90|
                  |L41.142|
00008e  482b              LDR      r0,|L41.316|
000090  6006              STR      r6,[r0,#0]            ;1609  ; SDIO_CmdInitStructure
000092  2017              MOVS     r0,#0x17              ;1610
000094  4929              LDR      r1,|L41.316|
000096  6048              STR      r0,[r1,#4]            ;1610  ; SDIO_CmdInitStructure
000098  2040              MOVS     r0,#0x40              ;1611
00009a  6088              STR      r0,[r1,#8]            ;1611  ; SDIO_CmdInitStructure
00009c  2000              MOVS     r0,#0                 ;1612
00009e  60c8              STR      r0,[r1,#0xc]          ;1612  ; SDIO_CmdInitStructure
0000a0  f44f6080          MOV      r0,#0x400             ;1613
0000a4  6108              STR      r0,[r1,#0x10]         ;1613  ; SDIO_CmdInitStructure
0000a6  4608              MOV      r0,r1                 ;1614
0000a8  f7fffffe          BL       SDIO_SendCommand
0000ac  2017              MOVS     r0,#0x17              ;1616
0000ae  f7fffffe          BL       CmdResp1Error
0000b2  4604              MOV      r4,r0                 ;1616
0000b4  b10c              CBZ      r4,|L41.186|
0000b6  4620              MOV      r0,r4                 ;1620
0000b8  e7cf              B        |L41.90|
                  |L41.186|
0000ba  4820              LDR      r0,|L41.316|
0000bc  6007              STR      r7,[r0,#0]            ;1625  ; SDIO_CmdInitStructure
0000be  2019              MOVS     r0,#0x19              ;1626
0000c0  491e              LDR      r1,|L41.316|
0000c2  6048              STR      r0,[r1,#4]            ;1626  ; SDIO_CmdInitStructure
0000c4  2040              MOVS     r0,#0x40              ;1627
0000c6  6088              STR      r0,[r1,#8]            ;1627  ; SDIO_CmdInitStructure
0000c8  2000              MOVS     r0,#0                 ;1628
0000ca  60c8              STR      r0,[r1,#0xc]          ;1628  ; SDIO_CmdInitStructure
0000cc  f44f6080          MOV      r0,#0x400             ;1629
0000d0  6108              STR      r0,[r1,#0x10]         ;1629  ; SDIO_CmdInitStructure
0000d2  4608              MOV      r0,r1                 ;1630
0000d4  f7fffffe          BL       SDIO_SendCommand
0000d8  2019              MOVS     r0,#0x19              ;1632
0000da  f7fffffe          BL       CmdResp1Error
0000de  4604              MOV      r4,r0                 ;1632
0000e0  b10c              CBZ      r4,|L41.230|
0000e2  4620              MOV      r0,r4                 ;1636
0000e4  e7b9              B        |L41.90|
                  |L41.230|
0000e6  f04f30ff          MOV      r0,#0xffffffff        ;1639
0000ea  4916              LDR      r1,|L41.324|
0000ec  6008              STR      r0,[r1,#0]            ;1639  ; SDIO_DataInitStructure
0000ee  fb06f005          MUL      r0,r6,r5              ;1640
0000f2  6048              STR      r0,[r1,#4]            ;1640  ; SDIO_DataInitStructure
0000f4  2090              MOVS     r0,#0x90              ;1641
0000f6  6088              STR      r0,[r1,#8]            ;1641  ; SDIO_DataInitStructure
0000f8  2000              MOVS     r0,#0                 ;1642
0000fa  60c8              STR      r0,[r1,#0xc]          ;1642  ; SDIO_DataInitStructure
0000fc  6108              STR      r0,[r1,#0x10]         ;1643  ; SDIO_DataInitStructure
0000fe  2001              MOVS     r0,#1                 ;1644
000100  6148              STR      r0,[r1,#0x14]         ;1644  ; SDIO_DataInitStructure
000102  4608              MOV      r0,r1                 ;1645
000104  f7fffffe          BL       SDIO_DataConfig
000108  2101              MOVS     r1,#1                 ;1647
00010a  f240302a          MOV      r0,#0x32a             ;1647
00010e  f7fffffe          BL       SDIO_ITConfig
000112  2001              MOVS     r0,#1                 ;1648
000114  f7fffffe          BL       SDIO_DMACmd
000118  fb06f105          MUL      r1,r6,r5              ;1649
00011c  4640              MOV      r0,r8                 ;1649
00011e  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
000122  4620              MOV      r0,r4                 ;1651
000124  e799              B        |L41.90|
;;;1653   
                          ENDP

000126  0000              DCW      0x0000
                  |L41.296|
                          DCD      TransferError
                  |L41.300|
                          DCD      TransferEnd
                  |L41.304|
                          DCD      StopCondition
                  |L41.308|
                          DCD      0x40012c2c
                  |L41.312|
                          DCD      CardType
                  |L41.316|
                          DCD      SDIO_CmdInitStructure
                  |L41.320|
                          DCD      ||RCA||
                  |L41.324|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.convert_from_bytes_to_power_of_two||, CODE, READONLY, ALIGN=1

                  convert_from_bytes_to_power_of_two PROC
;;;2790     */
;;;2791   uint8_t convert_from_bytes_to_power_of_two(uint16_t NumberOfBytes)
000000  4601              MOV      r1,r0
;;;2792   {
;;;2793     uint8_t count = 0;
000002  2000              MOVS     r0,#0
;;;2794   
;;;2795     while (NumberOfBytes != 1)
000004  e002              B        |L42.12|
                  |L42.6|
;;;2796     {
;;;2797       NumberOfBytes >>= 1;
000006  1049              ASRS     r1,r1,#1
;;;2798       count++;
000008  1c42              ADDS     r2,r0,#1
00000a  b2d0              UXTB     r0,r2
                  |L42.12|
00000c  2901              CMP      r1,#1                 ;2795
00000e  d1fa              BNE      |L42.6|
;;;2799     }
;;;2800     return(count);
;;;2801   }
000010  4770              BX       lr
;;;2802   
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  CSD_Tab
                          %        16
                  CID_Tab
                          %        16
                  SDSTATUS_Tab
                          %        16
                  SDCardInfo
                          %        88
                  SDIO_InitStructure
                          %        24
                  SDIO_CmdInitStructure
                          %        20
                  SDIO_DataInitStructure
                          %        24

                          AREA ||.data||, DATA, ALIGN=2

                  CardType
                          DCD      0x00000000
                  ||RCA||
                          DCD      0x00000000
                  StopCondition
                          DCD      0x00000000
                  TransferError
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  TransferEnd
                          DCD      0x00000000
                  DMAEndOfTransfer
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\..\\User\\bsp_stm32f4xx\\src\\bsp_sdio_sd.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REV16|
#line 129 "..\\..\\Libraries\\CMSIS\\Include\\core_cmInstr.h"
|__asm___13_bsp_sdio_sd_c_70335e9e____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REVSH|
#line 144
|__asm___13_bsp_sdio_sd_c_70335e9e____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
